<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2015-10-27 Tue 02:02 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>Lectures</title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Kevin Sullivan" />
<meta  name="description" content="A book on the foundations and performance of computer programming."
 />
<meta  name="keywords" content="computation, programming, logic, software, recursion, data, processes, fun" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/hideshow.css"/>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/bigblow.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/hideshow.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.min.js"></script>

<script type="text/javascript" src="org-info.js">
/**
 *
 * @source: org-info.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in org-info.js.
 *
 * Copyright (C) 2012-2013 Free Software Foundation, Inc.
 *
 *
 * The JavaScript code in this tag is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 *
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in org-info.js.
 *
 */
</script>

<script type="text/javascript">

/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/

<!--/*--><![CDATA[/*><!--*/
org_html_manager.set("TOC_DEPTH", "3");
org_html_manager.set("LINK_HOME", "");
org_html_manager.set("LINK_UP", "");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "0");
org_html_manager.set("VIEW", "info");
org_html_manager.setup();  // activate after the parameters are set
/*]]>*///-->
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">Lectures</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline12">1. Welcome</a>
<ul>
<li><a href="#orgheadline1">1.1. Welcome</a></li>
<li><a href="#orgheadline2">1.2. Software</a></li>
<li><a href="#orgheadline3">1.3. Videos</a></li>
<li><a href="#orgheadline4">1.4. Get to know each other</a></li>
<li><a href="#orgheadline5">1.5. Crank up VMs</a></li>
<li><a href="#orgheadline6">1.6. Introduce terminal</a></li>
<li><a href="#orgheadline7">1.7. Crank up emacs</a></li>
<li><a href="#orgheadline8">1.8. Write Python program</a></li>
<li><a href="#orgheadline9">1.9. Run it in emacs</a></li>
<li><a href="#orgheadline10">1.10. Close emacs</a></li>
<li><a href="#orgheadline11">1.11. Brief Q/A</a></li>
</ul>
</li>
<li><a href="#orgheadline23">2. Software Tools</a>
<ul>
<li><a href="#orgheadline15">2.1. A tiny bit of Linux</a>
<ul>
<li><a href="#orgheadline13">2.1.1. foreground/background, running/stopped</a></li>
<li><a href="#orgheadline14">2.1.2. what to do</a></li>
</ul>
</li>
<li><a href="#orgheadline22">2.2. Concept of software evolution</a>
<ul>
<li><a href="#orgheadline16">2.2.1. Change management</a></li>
<li><a href="#orgheadline17">2.2.2. Git</a></li>
<li><a href="#orgheadline18">2.2.3. GitHub</a></li>
<li><a href="#orgheadline19">2.2.4. Get Set Up</a></li>
<li><a href="#orgheadline20">2.2.5. Demo of adding to repo</a></li>
<li><a href="#orgheadline21">2.2.6. More GitHub</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline24">3. Assisted Quiz</a></li>
<li><a href="#orgheadline86">4. Computations and Effects</a>
<ul>
<li><a href="#orgheadline27">4.1. Sensors are cheap and amazing</a></li>
<li><a href="#orgheadline29">4.2. Computation in the world</a>
<ul>
<li><a href="#orgheadline28">4.2.1. Computation in the physical world</a></li>
</ul>
</li>
<li><a href="#orgheadline34">4.3. Computation</a>
<ul>
<li><a href="#orgheadline30">4.3.1. Data have types</a></li>
<li><a href="#orgheadline31">4.3.2. Data have interpretations</a></li>
<li><a href="#orgheadline32">4.3.3. Functions transform data</a></li>
<li><a href="#orgheadline33">4.3.4. Functions have types</a></li>
</ul>
</li>
<li><a href="#orgheadline39">4.4. Pure Functions</a>
<ul>
<li><a href="#orgheadline35">4.4.1. Focus on Pure Functions</a></li>
<li><a href="#orgheadline36">4.4.2. Mostly Ignore Effects for Now</a></li>
<li><a href="#orgheadline37">4.4.3. Let's Generalized our Picture</a></li>
<li><a href="#orgheadline38">4.4.4. Function Application and Reduction</a></li>
</ul>
</li>
<li><a href="#orgheadline80">4.5. Examples</a>
<ul>
<li><a href="#orgheadline40">4.5.1. Example</a></li>
<li><a href="#orgheadline41">4.5.2. Example</a></li>
<li><a href="#orgheadline42">4.5.3. Example</a></li>
<li><a href="#orgheadline43">4.5.4. Example</a></li>
<li><a href="#orgheadline44">4.5.5. Example</a></li>
<li><a href="#orgheadline45">4.5.6. Example</a></li>
<li><a href="#orgheadline46">4.5.7. Example</a></li>
<li><a href="#orgheadline47">4.5.8. Example</a></li>
<li><a href="#orgheadline48">4.5.9. Example</a></li>
<li><a href="#orgheadline49">4.5.10. Example</a></li>
<li><a href="#orgheadline50">4.5.11. Example</a></li>
<li><a href="#orgheadline51">4.5.12. Example</a></li>
<li><a href="#orgheadline52">4.5.13. Example</a></li>
<li><a href="#orgheadline53">4.5.14. Example</a></li>
<li><a href="#orgheadline54">4.5.15. Example</a></li>
<li><a href="#orgheadline55">4.5.16. Example</a></li>
<li><a href="#orgheadline56">4.5.17. Example</a></li>
<li><a href="#orgheadline57">4.5.18. Example</a></li>
<li><a href="#orgheadline58">4.5.19. Example</a></li>
<li><a href="#orgheadline59">4.5.20. Example</a></li>
<li><a href="#orgheadline60">4.5.21. Example</a></li>
<li><a href="#orgheadline61">4.5.22. Example</a></li>
<li><a href="#orgheadline62">4.5.23. Example</a></li>
<li><a href="#orgheadline63">4.5.24. Example</a></li>
<li><a href="#orgheadline64">4.5.25. Example</a></li>
<li><a href="#orgheadline65">4.5.26. Example</a></li>
<li><a href="#orgheadline66">4.5.27. Example</a></li>
<li><a href="#orgheadline67">4.5.28. Example</a></li>
<li><a href="#orgheadline68">4.5.29. Example</a></li>
<li><a href="#orgheadline69">4.5.30. Example</a></li>
<li><a href="#orgheadline70">4.5.31. Example</a></li>
<li><a href="#orgheadline71">4.5.32. Example</a></li>
<li><a href="#orgheadline72">4.5.33. Example</a></li>
<li><a href="#orgheadline73">4.5.34. Example</a></li>
<li><a href="#orgheadline74">4.5.35. Example</a></li>
<li><a href="#orgheadline75">4.5.36. Example</a></li>
<li><a href="#orgheadline76">4.5.37. Example</a></li>
<li><a href="#orgheadline77">4.5.38. Example</a></li>
<li><a href="#orgheadline78">4.5.39. Example</a></li>
<li><a href="#orgheadline79">4.5.40. Example</a></li>
</ul>
</li>
<li><a href="#orgheadline81">4.6. Summary</a></li>
<li><a href="#orgheadline84">4.7. REPLs</a>
<ul>
<li><a href="#orgheadline82">4.7.1. The picture makes sense</a></li>
<li><a href="#orgheadline83">4.7.2. Let's try Python REPL</a></li>
</ul>
</li>
<li><a href="#orgheadline85">4.8. A thought experiment</a></li>
</ul>
</li>
<li><a href="#orgheadline93">5. Abstract data types</a>
<ul>
<li><a href="#orgheadline89">5.1. bool</a>
<ul>
<li><a href="#orgheadline87">5.1.1. Abstract data types</a></li>
<li><a href="#orgheadline88">5.1.2. A few notes on Idris</a></li>
</ul>
</li>
<li><a href="#orgheadline90">5.2. unit</a></li>
<li><a href="#orgheadline91">5.3. Summary</a></li>
<li><a href="#orgheadline92">5.4. Exercises</a></li>
</ul>
</li>
<li><a href="#orgheadline103">6. Pattern Matching</a>
<ul>
<li><a href="#orgheadline96">6.1. A more concise definition of bool</a>
<ul>
<li><a href="#orgheadline94">6.1.1. Pattern matching</a></li>
<li><a href="#orgheadline95">6.1.2. Matching without naming</a></li>
</ul>
</li>
<li><a href="#orgheadline101">6.2. Destructuring of terms</a>
<ul>
<li><a href="#orgheadline97">6.2.1. module definition</a></li>
<li><a href="#orgheadline98">6.2.2. module import</a></li>
<li><a href="#orgheadline99">6.2.3. parameterized constructor</a></li>
<li><a href="#orgheadline100">6.2.4. destructuring of values during pattern matching</a></li>
</ul>
</li>
<li><a href="#orgheadline102">6.3. Practice</a></li>
</ul>
</li>
<li><a href="#orgheadline104">7. Polymorphism</a></li>
<li><a href="#orgheadline112">8. Interpretation</a>
<ul>
<li><a href="#orgheadline109">8.1. Boolean Algebra</a>
<ul>
<li><a href="#orgheadline105">8.1.1. An introduction to Boolean algebra</a></li>
<li><a href="#orgheadline106">8.1.2. Logical representation</a></li>
<li><a href="#orgheadline107">8.1.3. Programming as representation</a></li>
<li><a href="#orgheadline108">8.1.4. Fluency in reading and writing code</a></li>
</ul>
</li>
<li><a href="#orgheadline110">8.2. What does the type <i>pair a b</i> represent?</a></li>
<li><a href="#orgheadline111">8.3. Practice</a></li>
</ul>
</li>
<li><a href="#orgheadline113">9. Modeling, Abstractions, Code</a></li>
<li><a href="#orgheadline114">10. Inductive Definitions</a></li>
<li><a href="#orgheadline126">11. Recursive Functions</a>
<ul>
<li><a href="#orgheadline115">11.1. An example: the factorial function</a></li>
<li><a href="#orgheadline125">11.2. next</a>
<ul>
<li><a href="#orgheadline116">11.2.1. successor</a></li>
<li><a href="#orgheadline117">11.2.2. isZero</a></li>
<li><a href="#orgheadline118">11.2.3. predecessor</a></li>
<li><a href="#orgheadline122">11.2.4. addition</a></li>
<li><a href="#orgheadline123">11.2.5. equality</a></li>
<li><a href="#orgheadline124">11.2.6. Exercises</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline132">12. A little more Linux</a>
<ul>
<li><a href="#orgheadline128">12.1. running commands as super-user</a>
<ul>
<li><a href="#orgheadline127">12.1.1. sudo</a></li>
</ul>
</li>
<li><a href="#orgheadline131">12.2. installing and managing Linix packages</a>
<ul>
<li><a href="#orgheadline129">12.2.1. apt-get</a></li>
<li><a href="#orgheadline130">12.2.2. dpkg</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline187">13. Exam 1 Study Guide</a>
<ul>
<li><a href="#orgheadline133">13.1. Basic Linux Commands</a></li>
<li><a href="#orgheadline162">13.2. ADTs</a>
<ul>
<li><a href="#orgheadline136">13.2.1. unit</a></li>
<li><a href="#orgheadline141">13.2.2. bool</a></li>
<li><a href="#orgheadline144">13.2.3. Box a</a></li>
<li><a href="#orgheadline146">13.2.4. option a</a></li>
<li><a href="#orgheadline151">13.2.5. pair a b</a></li>
<li><a href="#orgheadline156">13.2.6. nat</a></li>
<li><a href="#orgheadline161">13.2.7. list a</a></li>
</ul>
</li>
<li><a href="#orgheadline186">13.3. Mechanisms</a>
<ul>
<li><a href="#orgheadline165">13.3.1. types and values</a></li>
<li><a href="#orgheadline174">13.3.2. inductive data type definitions</a></li>
<li><a href="#orgheadline177">13.3.3. binding of names to values</a></li>
<li><a href="#orgheadline180">13.3.4. pattern matching &amp; unification</a></li>
<li><a href="#orgheadline185">13.3.5. expression evaluation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline197">14. Partial Evaluation</a>
<ul>
<li><a href="#orgheadline188">14.1. Review of unary Boolean functions</a></li>
<li><a href="#orgheadline194">14.2. Review of binary Boolean functions</a>
<ul>
<li><a href="#orgheadline189">14.2.1. Number of binary Boolean functions</a></li>
<li><a href="#orgheadline193">14.2.2. Truth tables for most important ones</a></li>
</ul>
</li>
<li><a href="#orgheadline196">14.3. Formulating binary operations in a new way</a>
<ul>
<li><a href="#orgheadline195">14.3.1. Exercises</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline206">15. Type Inference</a>
<ul>
<li><a href="#orgheadline198">15.1. Inferring implicit types</a></li>
<li><a href="#orgheadline204">15.2. When type inference fails</a>
<ul>
<li><a href="#orgheadline201">15.2.1. A polymorphic list abstract data type</a></li>
<li><a href="#orgheadline202">15.2.2. Insufficient context for type inference</a></li>
<li><a href="#orgheadline203">15.2.3. The solution to the problem: making implicit arguments explicit</a></li>
</ul>
</li>
<li><a href="#orgheadline205">15.3. Summary</a></li>
</ul>
</li>
<li><a href="#orgheadline211">16. Infix Operators</a>
<ul>
<li><a href="#orgheadline207">16.1. Prefix and Infix Operator</a></li>
<li><a href="#orgheadline208">16.2. Associativity</a></li>
<li><a href="#orgheadline209">16.3. Precedence</a></li>
<li><a href="#orgheadline210">16.4. Infix operators in Idris</a></li>
</ul>
</li>
<li><a href="#orgheadline216">17. Record Notation</a>
<ul>
<li><a href="#orgheadline212">17.1. We Use Records to Represent Objects</a></li>
<li><a href="#orgheadline213">17.2. Projection Functions Get Field Values</a></li>
<li><a href="#orgheadline214">17.3. Field Override Functions Set Field Values</a></li>
<li><a href="#orgheadline215">17.4. Record Notation</a></li>
</ul>
</li>
<li><a href="#orgheadline220">18. Tuples and Relations</a>
<ul>
<li><a href="#orgheadline217">18.1. Tabular Representation of a Relation</a></li>
<li><a href="#orgheadline218">18.2. Representing Relations as Lists of Records</a></li>
<li><a href="#orgheadline219">18.3. Conclusion</a></li>
</ul>
</li>
<li><a href="#orgheadline238">19. Higher-Order Functions</a>
<ul>
<li><a href="#orgheadline221">19.1. Map</a></li>
<li><a href="#orgheadline224">19.2. Filter</a>
<ul>
<li><a href="#orgheadline222">19.2.1. Decisions and Alternation</a></li>
<li><a href="#orgheadline223">19.2.2. A simpler example</a></li>
</ul>
</li>
<li><a href="#orgheadline225">19.3. Reduce (Fold)</a></li>
<li><a href="#orgheadline233">19.4. Relational Queries</a>
<ul>
<li><a href="#orgheadline226">19.4.1. Generalization</a></li>
<li><a href="#orgheadline227">19.4.2. Improved Argument Ordering</a></li>
<li><a href="#orgheadline228">19.4.3. Statistical Queries</a></li>
<li><a href="#orgheadline229">19.4.4. Count</a></li>
<li><a href="#orgheadline230">19.4.5. Sum</a></li>
<li><a href="#orgheadline231">19.4.6. Mean</a></li>
<li><a href="#orgheadline232">19.4.7. Summary</a></li>
</ul>
</li>
<li><a href="#orgheadline237">19.5. Exercises</a>
<ul>
<li><a href="#orgheadline234">19.5.1. DNA</a></li>
<li><a href="#orgheadline235">19.5.2. Create a relation module</a></li>
<li><a href="#orgheadline236">19.5.3. Demonstrate application in your domain</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline244">20. Specifications</a>
<ul>
<li><a href="#orgheadline239">20.1. Specifications</a></li>
<li><a href="#orgheadline240">20.2. Interpretations</a></li>
<li><a href="#orgheadline241">20.3. Implementations</a></li>
<li><a href="#orgheadline242">20.4. Separation of Concerns</a></li>
<li><a href="#orgheadline243">20.5. Example: A Set ADT</a></li>
</ul>
</li>
<li><a href="#orgheadline251">21. Representation</a>
<ul>
<li><a href="#orgheadline250">21.1. Representing sets as lists</a>
<ul>
<li><a href="#orgheadline245">21.1.1. Importing the Specification and Implementation Types</a></li>
<li><a href="#orgheadline246">21.1.2. Design Decisions and Tradeoffs</a></li>
<li><a href="#orgheadline247">21.1.3. Implementing the <i>set</i> Data Type</a></li>
<li><a href="#orgheadline248">21.1.4. Encapsulating the type constructor behind an initial value</a></li>
<li><a href="#orgheadline249">21.1.5. Implementing the insert operation (badly)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline252">22. Top-down Design</a></li>
<li><a href="#orgheadline257">23. Typeclasses</a>
<ul>
<li><a href="#orgheadline253">23.1. The Eq Typeclass</a></li>
<li><a href="#orgheadline254">23.2. Typeclass Instances</a></li>
<li><a href="#orgheadline255">23.3. Typeclass Constraints</a></li>
<li><a href="#orgheadline256">23.4. Exercises</a></li>
</ul>
</li>
<li><a href="#orgheadline259">24. Serialization</a>
<ul>
<li><a href="#orgheadline258">24.1. Exercises</a></li>
</ul>
</li>
<li><a href="#orgheadline277">25. Future (Tentative)</a>
<ul>
<li><a href="#orgheadline262">25.1. Processes (Termination, Coinduction)</a>
<ul>
<li><a href="#orgheadline260">25.1.1. Simulation</a></li>
<li><a href="#orgheadline261">25.1.2. Games</a></li>
</ul>
</li>
<li><a href="#orgheadline263">25.2. Effects (I/O and State)</a></li>
<li><a href="#orgheadline272">25.3. Procedural Programming</a>
<ul>
<li><a href="#orgheadline264">25.3.1. Environment</a></li>
<li><a href="#orgheadline269">25.3.2. Commands</a></li>
<li><a href="#orgheadline270">25.3.3. Procedures</a></li>
<li><a href="#orgheadline271">25.3.4. Classes</a></li>
</ul>
</li>
<li><a href="#orgheadline273">25.4. Libraries</a></li>
<li><a href="#orgheadline274">25.5. Algorithms</a></li>
<li><a href="#orgheadline275">25.6. Complexity</a></li>
<li><a href="#orgheadline276">25.7. Debugging</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline12" class="outline-2">
<h2 id="orgheadline12"><span class="section-number-2">1</span> Welcome</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-orgheadline1" class="outline-3">
<h3 id="orgheadline1"><span class="section-number-3">1.1</span> Welcome</h3>
</div>
<div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2"><span class="section-number-3">1.2</span> Software</h3>
<div class="outline-text-3" id="text-1-2">
<ul class="org-ul">
<li>interacts with world</li>
<li>easy to write software</li>
<li>hard to know it's right</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline3" class="outline-3">
<h3 id="orgheadline3"><span class="section-number-3">1.3</span> Videos</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li>TED talk, inverted pendulum drone</li>
<li>concept of feedback control</li>
<li>concept of embedded computation</li>
<li>Youtube video, Arianne 5 launch</li>
<li>how bad computations can affect real world</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline4" class="outline-3">
<h3 id="orgheadline4"><span class="section-number-3">1.4</span> Get to know each other</h3>
</div>
<div id="outline-container-orgheadline5" class="outline-3">
<h3 id="orgheadline5"><span class="section-number-3">1.5</span> Crank up VMs</h3>
<div class="outline-text-3" id="text-1-5">
<ul class="org-ul">
<li>Goal to make sure everyone's got a VM</li>
<li>And to help remaining few who don't</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6"><span class="section-number-3">1.6</span> Introduce terminal</h3>
<div class="outline-text-3" id="text-1-6">
<ul class="org-ul">
<li>how we interact with Linux kernel</li>
<li>the <i>ls</i> command</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7"><span class="section-number-3">1.7</span> Crank up emacs</h3>
<div class="outline-text-3" id="text-1-7">
<ul class="org-ul">
<li>how we create text files</li>
<li>C-x C-f to open file (f is for file)</li>
<li>type (using commands from emacs tutorial)</li>
<li>C-x C-s to save changes (s is for save)</li>
<li>C-x C-c to close emacs (c is for close)</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline8" class="outline-3">
<h3 id="orgheadline8"><span class="section-number-3">1.8</span> Write Python program</h3>
<div class="outline-text-3" id="text-1-8">
<ul class="org-ul">
<li>print("Hello CS1!")</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline9" class="outline-3">
<h3 id="orgheadline9"><span class="section-number-3">1.9</span> Run it in emacs</h3>
<div class="outline-text-3" id="text-1-9">
<ul class="org-ul">
<li>C-c C-c</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline10" class="outline-3">
<h3 id="orgheadline10"><span class="section-number-3">1.10</span> Close emacs</h3>
<div class="outline-text-3" id="text-1-10">
<ul class="org-ul">
<li>C-x C-c</li>
<li>note running process (Python REPL)</li>
<li>agree to "kill" it</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline11" class="outline-3">
<h3 id="orgheadline11"><span class="section-number-3">1.11</span> Brief Q/A</h3>
</div>
</div>

<div id="outline-container-orgheadline23" class="outline-2">
<h2 id="orgheadline23"><span class="section-number-2">2</span> Software Tools</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-orgheadline15" class="outline-3">
<h3 id="orgheadline15"><span class="section-number-3">2.1</span> A tiny bit of Linux</h3>
<div class="outline-text-3" id="text-2-1">
</div><div id="outline-container-orgheadline13" class="outline-4">
<h4 id="orgheadline13"><span class="section-number-4">2.1.1</span> foreground/background, running/stopped</h4>
<div class="outline-text-4" id="text-2-1-1">
<ul class="org-ul">
<li>some processes (like emacs) run for a while</li>
<li>an example is emacs; it runs while you edit</li>
<li>running it in your terminal <i>blocks</i> use of terminal</li>
<li>you want emacs to keep running, but in <i>background</i></li>
<li>so that you can continue to use your terminal</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline14" class="outline-4">
<h4 id="orgheadline14"><span class="section-number-4">2.1.2</span> what to do</h4>
<div class="outline-text-4" id="text-2-1-2">
<ul class="org-ul">
<li>to run command in background, use &amp;</li>
<li>try it with emacs: <i>emacs hello.py &amp;</i></li>
<li>now you can edit <i>and</i> use your terminal</li>
<li>the <i>jobs</i> command tells you what's in background</li>
<li>type it at your terminal: <i>jobs</i></li>
<li>you should see emacs <i>Running</i> in background</li>
<li>if you close emacs, that <i>job</i> will go away</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgheadline22" class="outline-3">
<h3 id="orgheadline22"><span class="section-number-3">2.2</span> Concept of software evolution</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>value of software is in changeability</li>
<li>make machines do new things w/o hardware upgrades</li>
<li>example - your cell phone and its apps</li>
<li>example - Tesla cars update themselves continually</li>
</ul>
</div>
<div id="outline-container-orgheadline16" class="outline-4">
<h4 id="orgheadline16"><span class="section-number-4">2.2.1</span> Change management</h4>
<div class="outline-text-4" id="text-2-2-1">
<ul class="org-ul">
<li>managing software change is really important</li>
<li>e.g., how to back out of a bad update?</li>
<li>doing so with multiple people involved is critical</li>
<li>state of art is <i>distributed version control</i></li>
<li>most common tool today is <i>git</i></li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline17" class="outline-4">
<h4 id="orgheadline17"><span class="section-number-4">2.2.2</span> Git</h4>
<div class="outline-text-4" id="text-2-2-2">
<ul class="org-ul">
<li>everyone has copy of entire project</li>
<li>copy of project called <i>repository</i></li>
<li>too many syllables, so we say <i>repo</i></li>
<li>make changes to your own local repo</li>
<li>send changes to, pull from, other repos</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline18" class="outline-4">
<h4 id="orgheadline18"><span class="section-number-4">2.2.3</span> GitHub</h4>
<div class="outline-text-4" id="text-2-2-3">
<ul class="org-ul">
<li>team designates shared repo</li>
<li>GitHub is web service for shared repos</li>
<li><i>clone</i> existing GitHub repo to get local copy</li>
<li>make and <i>commit</i> changes to local repo</li>
<li><i>push</i> changes to shared GitHub repo, or &#x2026;</li>
<li>&#x2026; request that your changes be <i>pulled</i></li>
<li>pull changes that others have pushed</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline19" class="outline-4">
<h4 id="orgheadline19"><span class="section-number-4">2.2.4</span> Get Set Up</h4>
<div class="outline-text-4" id="text-2-2-4">
<ul class="org-ul">
<li>edit ~/.gitconfig</li>
<li>cd ~/my/stuff</li>
<li>remove existing files/directories</li>
<li>browse to github.com</li>
<li>search for cs1-sullivan repo</li>
<li>select and copy repo https URL</li>
<li>in terminal, do <i>git clone &lt;paste URL&gt;</i></li>
<li>cd into ./cs1-sullivan</li>
<li>list files</li>
<li>browse to html file</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline20" class="outline-4">
<h4 id="orgheadline20"><span class="section-number-4">2.2.5</span> Demo of adding to repo</h4>
<div class="outline-text-4" id="text-2-2-5">
<ul class="org-ul">
<li>Do <i>not</i> copy my actions</li>
<li>create new directories</li>
<li>./code, ./code/lecture1</li>
<li>edit hello.py</li>
<li>test hello.py</li>
<li><i>git add .</i></li>
<li><i>git commit</i></li>
<li><i>git push</i></li>
<li>and now you! <i>git pull</i></li>
<li>have fun changing hello.py</li>
<li>you can't push to this repo</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline21" class="outline-4">
<h4 id="orgheadline21"><span class="section-number-4">2.2.6</span> More GitHub</h4>
<div class="outline-text-4" id="text-2-2-6">
<ul class="org-ul">
<li>we'll learn more git as we go</li>
<li>business model: free for public repos ("open source")</li>
<li>business model: charge for private repos</li>
<li>personal repos as <i>portfolios, resumes</i></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline24" class="outline-2">
<h2 id="orgheadline24"><span class="section-number-2">3</span> Assisted Quiz</h2>
<div class="outline-text-2" id="text-3">
<p>
This period is mostly dedicated to testing everyone's ability to get
around in Linux, edit files using emacs, and run simple programs using
<i>command-line</i> commands. For a little extra fun, it requires a little
bit of program debugging!
</p>
</div>
</div>
<div id="outline-container-orgheadline86" class="outline-2">
<h2 id="orgheadline86"><span class="section-number-2">4</span> Computations and Effects</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-orgheadline27" class="outline-3">
<h3 id="orgheadline27"><span class="section-number-3">4.1</span> Sensors are cheap and amazing</h3>
<div class="outline-text-3" id="text-4-1">
</div><ol class="org-ol"><li><a id="orgheadline25"></a>Sensor Kinetics app for IPhone, Android (2.5MB)<br  /></li>
<li><a id="orgheadline26"></a>Sensor Test app on Android (21KB)<br  /></li></ol>
</div>

<div id="outline-container-orgheadline29" class="outline-3">
<h3 id="orgheadline29"><span class="section-number-3">4.2</span> Computation in the world</h3>
<div class="outline-text-3" id="text-4-2">

<div id="orgparagraph1" class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (1 of 46).jpg" alt="DataAndFunctions (1 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 1:</span> Computation in the physical world</p>
</div>
</div>

<div id="outline-container-orgheadline28" class="outline-4">
<h4 id="orgheadline28"><span class="section-number-4">4.2.1</span> Computation in the physical world</h4>
<div class="outline-text-4" id="text-4-2-1">
<ul class="org-ul">
<li>A <i>sensor</i> converts a <i>physical</i> signal into logical <i>data</i></li>
<li>An 8-bit <i>binary numeral</i> representing the number \(50\)</li>
<li>This value, \(50\), is <i>interpreted</i> as a distance in meters</li>
<li>The orange arrow represents a <i>function</i></li>
<li>Functions transform given data into new data</li>
<li>Given data representing a number, this function &#x2026;</li>
<li>&#x2026; <i>returns</i> data representing a character <i>string</i></li>
<li>This data is interpreted as a <i>roughly true</i> statement!</li>
<li>An actuator displays the string on a physical screen</li>
<li>Why is the statement probably only roughly true?</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgheadline34" class="outline-3">
<h3 id="orgheadline34"><span class="section-number-3">4.3</span> Computation</h3>
<div class="outline-text-3" id="text-4-3">
</div><div id="outline-container-orgheadline30" class="outline-4">
<h4 id="orgheadline30"><span class="section-number-4">4.3.1</span> Data have types</h4>
<div class="outline-text-4" id="text-4-3-1">

<div id="orgparagraph2" class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (2 of 46).jpg" alt="DataAndFunctions (2 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 2:</span> "Data types &#x2013; e.g., integer"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline31" class="outline-4">
<h4 id="orgheadline31"><span class="section-number-4">4.3.2</span> Data have interpretations</h4>
<div class="outline-text-4" id="text-4-3-2">

<div id="orgparagraph3" class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (2 of 46)-Interp.jpg" alt="DataAndFunctions (2 of 46)-Interp.jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 3:</span> "Interpretation &#x2013; e.g., physical distance"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline32" class="outline-4">
<h4 id="orgheadline32"><span class="section-number-4">4.3.3</span> Functions transform data</h4>
<div class="outline-text-4" id="text-4-3-3">

<div id="orgparagraph4" class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (3 of 46).jpg" alt="DataAndFunctions (3 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 4:</span> "Data types &#x2013; e.g., string"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline33" class="outline-4">
<h4 id="orgheadline33"><span class="section-number-4">4.3.4</span> Functions have types</h4>
<div class="outline-text-4" id="text-4-3-4">

<div id="orgparagraph5" class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (4 of 46).jpg" alt="DataAndFunctions (4 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 5:</span> "And we interpret function applications as producing meaningful results."</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline39" class="outline-3">
<h3 id="orgheadline39"><span class="section-number-3">4.4</span> Pure Functions</h3>
<div class="outline-text-3" id="text-4-4">
</div><div id="outline-container-orgheadline35" class="outline-4">
<h4 id="orgheadline35"><span class="section-number-4">4.4.1</span> Focus on Pure Functions</h4>
<div class="outline-text-4" id="text-4-4-1">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (5 of 46).jpg" alt="DataAndFunctions (5 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 6:</span> "Pure functional computation"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline36" class="outline-4">
<h4 id="orgheadline36"><span class="section-number-4">4.4.2</span> Mostly Ignore Effects for Now</h4>
<div class="outline-text-4" id="text-4-4-2">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (6 of 46).jpg" alt="DataAndFunctions (6 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 7:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline37" class="outline-4">
<h4 id="orgheadline37"><span class="section-number-4">4.4.3</span> Let's Generalized our Picture</h4>
<div class="outline-text-4" id="text-4-4-3">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (7 of 46).jpg" alt="DataAndFunctions (7 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 8:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline38" class="outline-4">
<h4 id="orgheadline38"><span class="section-number-4">4.4.4</span> Function Application and Reduction</h4>
<div class="outline-text-4" id="text-4-4-4">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (8 of 46).jpg" alt="DataAndFunctions (8 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 9:</span> "An example"</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline80" class="outline-3">
<h3 id="orgheadline80"><span class="section-number-3">4.5</span> Examples</h3>
<div class="outline-text-3" id="text-4-5">
<ul class="org-ul">
<li>Let's look at a whole bunch of examples to build intuition</li>
<li>For each one, identify both the data types and function types</li>
<li>Talk about possible interpretations</li>
<li>Watch out for "type errors" (round peg in square hole)</li>
<li>Don't worry about using the right names for now</li>
</ul>
</div>

<div id="outline-container-orgheadline40" class="outline-4">
<h4 id="orgheadline40"><span class="section-number-4">4.5.1</span> Example</h4>
<div class="outline-text-4" id="text-4-5-1">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (9 of 46).jpg" alt="DataAndFunctions (9 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 10:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline41" class="outline-4">
<h4 id="orgheadline41"><span class="section-number-4">4.5.2</span> Example</h4>
<div class="outline-text-4" id="text-4-5-2">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (10 of 46).jpg" alt="DataAndFunctions (10 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 11:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline42" class="outline-4">
<h4 id="orgheadline42"><span class="section-number-4">4.5.3</span> Example</h4>
<div class="outline-text-4" id="text-4-5-3">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (11 of 46).jpg" alt="DataAndFunctions (11 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 12:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline43" class="outline-4">
<h4 id="orgheadline43"><span class="section-number-4">4.5.4</span> Example</h4>
<div class="outline-text-4" id="text-4-5-4">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (12 of 46).jpg" alt="DataAndFunctions (12 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 13:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline44" class="outline-4">
<h4 id="orgheadline44"><span class="section-number-4">4.5.5</span> Example</h4>
<div class="outline-text-4" id="text-4-5-5">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (13 of 46).jpg" alt="DataAndFunctions (13 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 14:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline45" class="outline-4">
<h4 id="orgheadline45"><span class="section-number-4">4.5.6</span> Example</h4>
<div class="outline-text-4" id="text-4-5-6">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (14 of 46).jpg" alt="DataAndFunctions (14 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 15:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline46" class="outline-4">
<h4 id="orgheadline46"><span class="section-number-4">4.5.7</span> Example</h4>
<div class="outline-text-4" id="text-4-5-7">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (15 of 46).jpg" alt="DataAndFunctions (15 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 16:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline47" class="outline-4">
<h4 id="orgheadline47"><span class="section-number-4">4.5.8</span> Example</h4>
<div class="outline-text-4" id="text-4-5-8">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (16 of 46).jpg" alt="DataAndFunctions (16 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 17:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline48" class="outline-4">
<h4 id="orgheadline48"><span class="section-number-4">4.5.9</span> Example</h4>
<div class="outline-text-4" id="text-4-5-9">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (17 of 46).jpg" alt="DataAndFunctions (17 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 18:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline49" class="outline-4">
<h4 id="orgheadline49"><span class="section-number-4">4.5.10</span> Example</h4>
<div class="outline-text-4" id="text-4-5-10">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (18 of 46).jpg" alt="DataAndFunctions (18 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 19:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline50" class="outline-4">
<h4 id="orgheadline50"><span class="section-number-4">4.5.11</span> Example</h4>
<div class="outline-text-4" id="text-4-5-11">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (19 of 46).jpg" alt="DataAndFunctions (19 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 20:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline51" class="outline-4">
<h4 id="orgheadline51"><span class="section-number-4">4.5.12</span> Example</h4>
<div class="outline-text-4" id="text-4-5-12">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (20 of 46).jpg" alt="DataAndFunctions (20 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 21:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline52" class="outline-4">
<h4 id="orgheadline52"><span class="section-number-4">4.5.13</span> Example</h4>
<div class="outline-text-4" id="text-4-5-13">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (21 of 46).jpg" alt="DataAndFunctions (21 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 22:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline53" class="outline-4">
<h4 id="orgheadline53"><span class="section-number-4">4.5.14</span> Example</h4>
<div class="outline-text-4" id="text-4-5-14">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (22 of 46).jpg" alt="DataAndFunctions (22 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 23:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline54" class="outline-4">
<h4 id="orgheadline54"><span class="section-number-4">4.5.15</span> Example</h4>
<div class="outline-text-4" id="text-4-5-15">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (23 of 46).jpg" alt="DataAndFunctions (23 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 24:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline55" class="outline-4">
<h4 id="orgheadline55"><span class="section-number-4">4.5.16</span> Example</h4>
<div class="outline-text-4" id="text-4-5-16">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (24 of 46).jpg" alt="DataAndFunctions (24 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 25:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline56" class="outline-4">
<h4 id="orgheadline56"><span class="section-number-4">4.5.17</span> Example</h4>
<div class="outline-text-4" id="text-4-5-17">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (25 of 46).jpg" alt="DataAndFunctions (25 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 26:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline57" class="outline-4">
<h4 id="orgheadline57"><span class="section-number-4">4.5.18</span> Example</h4>
<div class="outline-text-4" id="text-4-5-18">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (26 of 46).jpg" alt="DataAndFunctions (26 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 27:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline58" class="outline-4">
<h4 id="orgheadline58"><span class="section-number-4">4.5.19</span> Example</h4>
<div class="outline-text-4" id="text-4-5-19">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (27 of 46).jpg" alt="DataAndFunctions (27 of 46).jpg" width="600x" />
</p>
<p><span class="figure-number">Figure 28:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline59" class="outline-4">
<h4 id="orgheadline59"><span class="section-number-4">4.5.20</span> Example</h4>
<div class="outline-text-4" id="text-4-5-20">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (28 of 46).jpg" alt="DataAndFunctions (28 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 29:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline60" class="outline-4">
<h4 id="orgheadline60"><span class="section-number-4">4.5.21</span> Example</h4>
<div class="outline-text-4" id="text-4-5-21">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (29 of 46).jpg" alt="DataAndFunctions (29 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 30:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline61" class="outline-4">
<h4 id="orgheadline61"><span class="section-number-4">4.5.22</span> Example</h4>
<div class="outline-text-4" id="text-4-5-22">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (30 of 46).jpg" alt="DataAndFunctions (30 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 31:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline62" class="outline-4">
<h4 id="orgheadline62"><span class="section-number-4">4.5.23</span> Example</h4>
<div class="outline-text-4" id="text-4-5-23">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (31 of 46).jpg" alt="DataAndFunctions (31 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 32:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline63" class="outline-4">
<h4 id="orgheadline63"><span class="section-number-4">4.5.24</span> Example</h4>
<div class="outline-text-4" id="text-4-5-24">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (32 of 46).jpg" alt="DataAndFunctions (32 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 33:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline64" class="outline-4">
<h4 id="orgheadline64"><span class="section-number-4">4.5.25</span> Example</h4>
<div class="outline-text-4" id="text-4-5-25">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (33 of 46).jpg" alt="DataAndFunctions (33 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 34:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline65" class="outline-4">
<h4 id="orgheadline65"><span class="section-number-4">4.5.26</span> Example</h4>
<div class="outline-text-4" id="text-4-5-26">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (34 of 46).jpg" alt="DataAndFunctions (34 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 35:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline66" class="outline-4">
<h4 id="orgheadline66"><span class="section-number-4">4.5.27</span> Example</h4>
<div class="outline-text-4" id="text-4-5-27">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (35 of 46).jpg" alt="DataAndFunctions (35 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 36:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline67" class="outline-4">
<h4 id="orgheadline67"><span class="section-number-4">4.5.28</span> Example</h4>
<div class="outline-text-4" id="text-4-5-28">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (36 of 46).jpg" alt="DataAndFunctions (36 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 37:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline68" class="outline-4">
<h4 id="orgheadline68"><span class="section-number-4">4.5.29</span> Example</h4>
<div class="outline-text-4" id="text-4-5-29">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (37 of 46).jpg" alt="DataAndFunctions (37 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 38:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline69" class="outline-4">
<h4 id="orgheadline69"><span class="section-number-4">4.5.30</span> Example</h4>
<div class="outline-text-4" id="text-4-5-30">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (38 of 46).jpg" alt="DataAndFunctions (38 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 39:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline70" class="outline-4">
<h4 id="orgheadline70"><span class="section-number-4">4.5.31</span> Example</h4>
<div class="outline-text-4" id="text-4-5-31">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (30 of 46).jpg" alt="DataAndFunctions (30 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 40:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline71" class="outline-4">
<h4 id="orgheadline71"><span class="section-number-4">4.5.32</span> Example</h4>
<div class="outline-text-4" id="text-4-5-32">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (39 of 46).jpg" alt="DataAndFunctions (39 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 41:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline72" class="outline-4">
<h4 id="orgheadline72"><span class="section-number-4">4.5.33</span> Example</h4>
<div class="outline-text-4" id="text-4-5-33">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (40 of 46).jpg" alt="DataAndFunctions (40 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 42:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline73" class="outline-4">
<h4 id="orgheadline73"><span class="section-number-4">4.5.34</span> Example</h4>
<div class="outline-text-4" id="text-4-5-34">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (41 of 46).jpg" alt="DataAndFunctions (41 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 43:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline74" class="outline-4">
<h4 id="orgheadline74"><span class="section-number-4">4.5.35</span> Example</h4>
<div class="outline-text-4" id="text-4-5-35">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (42 of 46).jpg" alt="DataAndFunctions (42 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 44:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline75" class="outline-4">
<h4 id="orgheadline75"><span class="section-number-4">4.5.36</span> Example</h4>
<div class="outline-text-4" id="text-4-5-36">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (43 of 46).jpg" alt="DataAndFunctions (43 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 45:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline76" class="outline-4">
<h4 id="orgheadline76"><span class="section-number-4">4.5.37</span> Example</h4>
<div class="outline-text-4" id="text-4-5-37">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (44 of 46).jpg" alt="DataAndFunctions (44 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 46:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline77" class="outline-4">
<h4 id="orgheadline77"><span class="section-number-4">4.5.38</span> Example</h4>
<div class="outline-text-4" id="text-4-5-38">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (44 of 46).jpg" alt="DataAndFunctions (44 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 47:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline78" class="outline-4">
<h4 id="orgheadline78"><span class="section-number-4">4.5.39</span> Example</h4>
<div class="outline-text-4" id="text-4-5-39">

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (45 of 46).jpg" alt="DataAndFunctions (45 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 48:</span> "An example"</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline79" class="outline-4">
<h4 id="orgheadline79"><span class="section-number-4">4.5.40</span> Example</h4>
<div class="outline-text-4" id="text-4-5-40">
<p>
An alternative to viewing <i>increment list</i> as a type error
would be to define a different function for lists but with 
the same name as the one for numbers. We'll see later on that
this is a very sensible thing to do. The technical term for
this idea is  <i>overloading</i>. For now you don't need to know
this term.
</p>

<div class="figure">
<p><img src="./figures/FunctionsAndEffects/DataAndFunctions (46 of 46).jpg" alt="DataAndFunctions (46 of 46).jpg" width="900px" />
</p>
<p><span class="figure-number">Figure 49:</span> "An example"</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline81" class="outline-3">
<h3 id="orgheadline81"><span class="section-number-3">4.6</span> Summary</h3>
<div class="outline-text-3" id="text-4-6">
<ul class="org-ul">
<li><i>Types</i> define sets of <i>values</i></li>
<li>Function <i>application</i> converts data of one type into another</li>
<li>The type of a function is an <i>arrow</i> from <i>argument</i> to <i>result</i> type</li>
<li>The <i>argument</i> and <i>result</i> types can be but needn't be the same</li>
<li>We impose <i>interpretations</i> to give data and functions real meaning</li>
<li>Function definitions, expressions, and programs are data too</li>
<li>Functions that take/return other functions are called <i>higher order</i></li>
<li><i>Semantics</i> reduce programs/expressions to the results they represent</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline84" class="outline-3">
<h3 id="orgheadline84"><span class="section-number-3">4.7</span> REPLs</h3>
<div class="outline-text-3" id="text-4-7">
</div><div id="outline-container-orgheadline82" class="outline-4">
<h4 id="orgheadline82"><span class="section-number-4">4.7.1</span> The picture makes sense</h4>
<div class="outline-text-4" id="text-4-7-1">
<ul class="org-ul">
<li>Sensor: keyboard</li>
<li>Argument: expression</li>
<li>Function: semantics</li>
<li>Result: reduced value</li>
<li>Effect: display result</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline83" class="outline-4">
<h4 id="orgheadline83"><span class="section-number-4">4.7.2</span> Let's try Python REPL</h4>
</div>
</div>

<div id="outline-container-orgheadline85" class="outline-3">
<h3 id="orgheadline85"><span class="section-number-3">4.8</span> A thought experiment</h3>
<div class="outline-text-3" id="text-4-8">
<ul class="org-ul">
<li>Remember that a type defines a set of values</li>
<li>What is the simplest data types you can imagine defining?</li>
<li>What functions can one define using only that type?</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgheadline93" class="outline-2">
<h2 id="orgheadline93"><span class="section-number-2">5</span> Abstract data types</h2>
<div class="outline-text-2" id="text-5">
<p>
In this unit, we will make precise the informal ideas from last time,
about pure computation separate from effects. We will make these ideas
precise by casting them in the form of <i>code</i>. In particular, we will
see how to define simple data types and functions in the programming
language called Idris.
</p>
</div>

<div id="outline-container-orgheadline89" class="outline-3">
<h3 id="orgheadline89"><span class="section-number-3">5.1</span> bool</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Let's start with material we've already talked about informally: the
<i>bool</i> data type, and the function, <i>not</i>, of type \(bool \to bool\).
</p>

<p>
You will recall several facts from the last section. First, the <i>bool</i>
type has two values, <i>true</i> and <i>false</i>. Second, the <i>not</i> function
has type \(bool \to bool\). Finally, the <i>not</i> function is defined by
two equations: \(not\ true = false\) and \(not\ false = true\).  Here's
how we would say all of this in an exquisitely precise and concise
form in the Idris programming language.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">module</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>

<span style="color: #0000FF;">data</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">true</span> <span style="color: #BA36A5;">|</span> <span style="color: #333333; background-color: #FFFFFF;">false</span>

<span style="color: #333333; background-color: #FFFFFF;">not</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
<span style="color: #333333; background-color: #FFFFFF;">not</span> <span style="color: #333333; background-color: #FFFFFF;">true</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">false</span>
<span style="color: #333333; background-color: #FFFFFF;">not</span> <span style="color: #333333; background-color: #FFFFFF;">false</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">true</span>
</pre>
</div>

<p>
The first line indicates that we are defining a <i>module</i> (a coherent
unit of code) called <i>bool</i>. The second line defines a data type named
<i>bool</i> and states that it has two values, <i>true</i> and <i>false</i>. The
third line says that we're introducing a new function, <i>not</i>, of type
\(bool \to bool\). The last two lines present the equations that define
the behavior of this function. The first one says that the result of
applying <i>not</i> to the value <i>true</i> is the value <i>false</i>.  The second
says that applying <i>not</i> to <i>false</i> reduces to <i>true</i>. These equations
together define the behavior of <i>not</i> when applied to <i>any</i> value of
type <i>bool</i>.
</p>
</div>

<div id="outline-container-orgheadline87" class="outline-4">
<h4 id="orgheadline87"><span class="section-number-4">5.1.1</span> Abstract data types</h4>
<div class="outline-text-4" id="text-5-1-1">
<p>
This code clearly and concisely captures the intuition we developed in
the last class: of a data type and a set of associated functions that
operate on values of that type. We call such a combination&#x2014;of a type
and associated functions&#x2013;an <i>abstract data type</i>. Here we are here
defining what programmers would call a <i>Boolean abstract data type</i>.
</p>

<p>
We can usually define more than one function for a given data type. It
is interesting to ask how many such functions can one define? Think
about it for a moment. In how many different ways can map the values
<i>true</i> and <i>false</i> to themselves? The answer is four: we can map each
of the arguments to its opposite (the <i>not</i> function); we can map each
one to itself (what we call the identify function); we can map both to
<i>true</i> (the <i>constant true function</i>); and we can map both to <i>false</i>.
Here's the code.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #8D8D84; font-style: italic;">-- The identity function</span>
<span style="color: #333333; background-color: #FFFFFF;">id_bool</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
<span style="color: #333333; background-color: #FFFFFF;">id_bool</span> <span style="color: #333333; background-color: #FFFFFF;">true</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">true</span>
<span style="color: #333333; background-color: #FFFFFF;">id_bool</span> <span style="color: #333333; background-color: #FFFFFF;">false</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">false</span>

<span style="color: #8D8D84; font-style: italic;">-- The constant true function</span>
<span style="color: #333333; background-color: #FFFFFF;">const_true</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
<span style="color: #333333; background-color: #FFFFFF;">const_true</span> <span style="color: #333333; background-color: #FFFFFF;">true</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">true</span>
<span style="color: #333333; background-color: #FFFFFF;">const_true</span> <span style="color: #333333; background-color: #FFFFFF;">false</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">true</span>

<span style="color: #8D8D84; font-style: italic;">-- The constant false function</span>
<span style="color: #333333; background-color: #FFFFFF;">const_false</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
<span style="color: #333333; background-color: #FFFFFF;">const_false</span> <span style="color: #333333; background-color: #FFFFFF;">true</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">false</span>
<span style="color: #333333; background-color: #FFFFFF;">const_false</span> <span style="color: #333333; background-color: #FFFFFF;">false</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">false</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline88" class="outline-4">
<h4 id="orgheadline88"><span class="section-number-4">5.1.2</span> A few notes on Idris</h4>
<div class="outline-text-4" id="text-5-1-2">
<p>
The lines starting with two dashes are <i>comments</i>. They are there for
you, the human reader. They do not affect the computational meaning of
the code.
</p>

<p>
We also note that in Idris, by convention type names are capitalized.
What we mean when we say <i>by convention</i> is that this is rule that
most good programmers follow but that Idris does not enforce. It is
considered good form to follow the rule, and following it is believed
to produce that is more <i>readable</i> that it would otherwise be.
</p>

<p>
As you can see, we have broken the convention in our definition of the
<i>bool</i> type. The reason we have done this is that Idris already has a
<i>Bool</i> type (with a capital <i>B</i>), and we don't want our definition to
conflict with that of Idris. We thus break from convention here and
use a lower-case <i>b</i>. We'll do the same thing for the <i>unit</i> type in
the next sub-section, for the same reason.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline90" class="outline-3">
<h3 id="orgheadline90"><span class="section-number-3">5.2</span> unit</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Having learned about the Boolean data type, <i>bool</i>, one might wonder
whether there are even simpler types? The answer is yes. While <i>bool</i>
has two values, the type we will call <i>unit</i> is even simpler: it has
has only one, which we will call <i>mkUnit</i> (pronounced <i>make-unit</i>).
</p>

<p>
An interesting question to contemplate is how many functions are there
of type \(unit \to unit\). There is only one value that such a function
can take as an argument (namely <i>mkUnit</i>) and only one value that it
can return as a result (again <i>mkUnit</i>). So the answer is <i>just one</i>.
The only function of type \(unit \to unit\) is the <i>identity</i> function
for <i>unit</i>.  Here then is the code for the entire <i>unit</i> abstract data
type.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">module</span> <span style="color: #333333; background-color: #FFFFFF;">unit</span>

<span style="color: #0000FF;">data</span> <span style="color: #333333; background-color: #FFFFFF;">unit</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mkUnit</span>

<span style="color: #333333; background-color: #FFFFFF;">idUnit</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">unit</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">unit</span>
<span style="color: #333333; background-color: #FFFFFF;">idUnit</span> <span style="color: #333333; background-color: #FFFFFF;">mkUnit</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mkUnit</span>
</pre>
</div>

<p>
The first line states that we're defining a new module, <i>unit</i>. The
second line defines the <i>unit</i> data type, with one value, <i>mkUnit</i>.
The third line declares (<i>idUnit</i>) to be a function of type (\(unit \to
unit\)). The fourth line defines its behavior: given <i>mkUnit</i> as an
argument, it returns <i>mkUnit</i> as a result. That is all that can be, or
that needs to be, said about this function. This code thus gives the
complete definition of a <i>unit</i> abstract data type.
</p>

<p>
You are probably wondering whether there is any possible use for such
a minimal type. The answer is yes. It plays an important role in many
languages, from C and C++ to Java to Python and Idris. In particular,
it is the type of value that is returned by a program that exists not
to produce a useful value but only to have an effect on the world.
</p>

<p>
In Python, for example, the <i>print</i> command exists only produce output
on an output stream, not to compute and return a useful value. The
command <i>print("Hello CS1!")</i> for example produces such an output. If
you're really interested in seeing what value this command returns,
you can actually print it using the print command, like this:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">print</span>(<span style="color: #0000FF;">print</span>(<span style="color: #008000;">"Hello CS1!"</span>))
</pre>
</div>

<p>
Try it in your REPL. You will first see the output, <i>Hello CS1!</i>.
This output is the <i>effect</i> of the inner print command. The outer
print command then prints the <i>result</i> returned by the inner print
command. What is that result?  As you will see, it's called <i>None</i>.
This is Python's equivalent of <i>mkUnit</i>, the only value of Python's
unit type, which in Python is called <i>NoneType</i>.
</p>

<p>
The unit type is actually ubiquitous in imperative programming. It is
the type returned by functions that exist only for their effects, and
not to compute useful values. In the programming languages C, C++, and
Java, for example, the unit type is called <i>void</i>. You will often see
functions in these languages declared to return value of type <i>void</i>.
Here's the <i>Hello CS1!</i> program in Java, which exists only to have an
effect (outputting the <i>Hello</i> message), for example:
</p>

<div class="org-src-container">

<pre class="src src-java"><span style="color: #0000FF;">class</span> <span style="color: #6434A3;">Hello</span> {
  <span style="color: #0000FF;">public</span> <span style="color: #0000FF;">static</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">main</span>(<span style="color: #6434A3;">String</span>[] <span style="color: #BA36A5;">args</span>) { 
    System.out.println(<span style="color: #008000;">"Hello CS1!"</span>) }
}
</pre>
</div>

<p>
Here the <i>main</i> routine is declared to take a list of strings as an
argument and to return a value of type <i>void</i>.  Many programmers never
fully understand what that <i>void</i> means. Now you know! It just means
the <i>unit</i> type.
</p>
</div>
</div>

<div id="outline-container-orgheadline91" class="outline-3">
<h3 id="orgheadline91"><span class="section-number-3">5.3</span> Summary</h3>
<div class="outline-text-3" id="text-5-3">
<p>
In this chapter you have learned how to modular units of code called
abstract data types. An abstract data type combined a data type
definition with a set of functions that operate on values of that data
type. You have met the <i>unit</i> abstract data type, whose data type has
only one value. You have seen that there is only one function of type
\(unit \to unit\), namely the identity function on the unit type. 
</p>

<p>
You have also met the Boolean abstract data type (here called <i>bool</i>).
It is built on a data type with two values, <i>true</i> and <i>false</i>. You
have seen that it is possible to define four functions of type \(bool
\to bool\), namely negation, the identity function on this type, and
two constant functions.
</p>

<p>
Most important of all, you have seen that we can take the intuitive
concepts of data and function types and values and make them precise.
Moreover, making them precise in this way also makes it possible to
automate computations involving these concepts.
</p>
</div>
</div>

<div id="outline-container-orgheadline92" class="outline-3">
<h3 id="orgheadline92"><span class="section-number-3">5.4</span> Exercises</h3>
<div class="outline-text-3" id="text-5-4">
<ul class="org-ul">
<li>Load and compile the <i>bool.idr</i> and <i>unit.idr</i> files in the Idris</li>
</ul>
<p>
REPL. Use the <i>:t</i> query to ask about the types of all of the objects
in each of the files: the values, the functions, and also the types.
</p>

<ul class="org-ul">
<li>Use the REPL to evaluate function application expressions for each</li>
</ul>
<p>
of these abstract data types. For example, evaluated <i>not true</i>, <i>not
false</i>, <i>idUnit mkUnit</i>, and so forth. Check carefully to determine
whether the computed results are correct given your definitions.
</p>

<ul class="org-ul">
<li>Adapt the <i>bool</i> type to create a new type, called <i>days</i> with seven</li>
</ul>
<p>
values, one for each day of the week. Then define two functions of
type \(day \to day\), one that for any given day returns the next day,
and one that for any given day returns the next weekday.
</p>

<ul class="org-ul">
<li>Extra credit: How many functions of type \(day \to day\) are there?</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgheadline103" class="outline-2">
<h2 id="orgheadline103"><span class="section-number-2">6</span> Pattern Matching</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-orgheadline96" class="outline-3">
<h3 id="orgheadline96"><span class="section-number-3">6.1</span> A more concise definition of bool</h3>
<div class="outline-text-3" id="text-6-1">
<p>
Here we present a more concise but computationally equivalent
definition of the <i>bool</i> ADT.  We present it in parts in order to
discuss the mechanisms that we use to make a more compact
representation.
</p>

<p>
First, we start as before, by defining a <i>bool</i> module and the
usual <i>bool</i> data type.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">module</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>

<span style="color: #0000FF;">data</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">true</span> <span style="color: #BA36A5;">|</span> <span style="color: #333333; background-color: #FFFFFF;">false</span>
</pre>
</div>

<p>
As before, this code starts by declaring that the following
definitions are grouped in module called <i>bool</i>. The second line
defines a data type called <i>bool</i>. On the right hand side of the
equals sign in a list of <i>constructors</i> that, together, define the
<i>values</i> (or <i>terms</i>) of this type.  Here they are just <i>true</i> and
<i>false</i>. In the next subsection, we will see that it is possible for
one constructor to define more than one term of a given type.
</p>

<p>
Now let's return to the issue at hand: writing the functions in the
<i>bool</i> ADT more concisely. Let's start with the <i>id</i> function. As you
recall, this is the function that just returns its argument unchanged
as a result.
</p>

<p>
Previously we presented two rules to define the result of applying
this function to a value of type <i>bool</i>. That is, we presented rules
defining the values of the expressions, <i>id true</i> and <i>id false</i>. We
wrote <i>id true = true</i> and <i>id false = false</i>. 
</p>
</div>

<div id="outline-container-orgheadline94" class="outline-4">
<h4 id="orgheadline94"><span class="section-number-4">6.1.1</span> Pattern matching</h4>
<div class="outline-text-4" id="text-6-1-1">
<p>
The observation that leads to a simplification is that <i>id</i> returns
<i>whatever</i> value it is given. The idea is to give that value a <i>name</i>,
such as <i>b</i> or <i>x</i>, that <i>covers both cases</i> and then to use that name
in defining the result. One rule can then cover many cases. Suppose we
pick <i>b</i> as the name. Then we can write the <i>id</i> function as follows:
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">id</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
<span style="color: #333333; background-color: #FFFFFF;">id</span> <span style="color: #333333; background-color: #FFFFFF;">b</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">b</span>
</pre>
</div>

<p>
The first line is as before: it declares the identifier <i>id</i> to be
bound to a value of type \(bool \to bool\). I.e., <i>id</i> is a <i>function</i>
that when applied to a value of type <i>bool</i> returns (reduces to) a
value of type <i>bool</i>. 
</p>

<p>
The second line is where we see a difference. It defines how the <i>id</i>
function behaves for all (both) possible values of the argument. It
says that <i>id</i> applied to <i>any</i> value, call it <i>b</i>, reduced to <i>b</i>.
One rule covers both cases.
</p>

<p>
This rule illustrates the concept of <i>pattern matching</i>, also called
<i>unification</i>. Unification is at the heart of how Idris <i>evaluates</i>
function application expressions in which functions are applied to
values to produce results. Examples of such expressions include, such
as <i>id true</i> and <i>id false</i>. We expect that the expression <i>id true</i>
reduces to <i>true</i> and <i>id false</i>, to <i>false</i>. How does this work?
</p>

<p>
In effect, when Idris sees a function application expression, such as
<i>id false</i>, it starts by looking up the definition of <i>id</i>. It finds a
sequence of rules. Each rule has a <i>pattern</i>, possibly with variables,
to the left of an equals sign, and an expression that can use those
variables, defining the corresponding result, on the right. Idris goes
down the list of rules, trying to <i>match</i> the function application
against the <i>patterns</i>. When it finds a pattern that <i>matches</i>, it
<i>returns</i> the value given by the expression on the right.
</p>

<p>
Let's trace how this would work for the expression, <i>id false</i>. Let's
look at our first definition of this function first (the one with two
rules). The function application expression to be matched is <i>id
false</i>. The first rule has <i>id true</i> on the left of the equals sign,
so it doesn't match. The second rule has <i>id false</i> on the left. It
does match.  The value to which the expression <i>id false</i> is reduced
is thus given on the right side of this rule.  The result is thus just
<i>false</i>.
</p>

<p>
Now consider how the expression <i>id false</i> gets evaluated with our new
definition. Idris tries to match the expression <i>id false</i> with the
pattern <i>id b</i>. Here <i>b</i> is a variable: a name that can be bound to
any value of type <i>bool</i>. The pattern matches in this case as long as
<i>b</i> is <i>bound</i> to the value <i>false</i>. With this match made on the left,
the value on the right, <i>namely the value of b, as bound on the left</i>
is returned as the result. The result in this case is thus <i>false</i>.
</p>

<p>
The process of trying to match a pattern, containing variables, to a
term, such as <i>id false</i>, by binding those variables to parts of the
term (here by binding <i>b</i> to <i>false</i>), is called <i>unification</i>. This
concept is at the heart of function evaluation in Idris and many other
functional programming languages.
</p>

<p>
When Idris is asked to evaluate an application of a function <i>f</i> to an
argument <i>a</i>, it looks up the rules for <i>f</i>. It then tries to <i>unify</i>
the expression <i>f a</i> with the patterns on the left sides of the rules,
starting with the first rule and going down the list, in order, until
a match is found. When a pattern matches, it results in a temporary
binding of the variables in the pattern to the matching parts of the
given term.  Those variables can then be used on the right side of the
rule to define the result to which the function application is reduced.
</p>

<p>
In this case, Idris evaluates <i>id false</i> by looking up the one rule,
<i>id b = b</i>. The pattern <i>id b</i> matches (unifies with) the term <i>id
false</i>, namely with <i>b</i> bound to <i>false</i>. The right side of the rule
then states that the result is <i>b</i>. In this case, <i>b</i> means <i>false</i>.
The pattern <i>id b</i> would also unify with the term <i>id true</i>, but with
<i>b</i> bound to <i>true</i>, yielding <i>true</i> as the value to which <i>id true</i>
reduces.
</p>
</div>
</div>

<div id="outline-container-orgheadline95" class="outline-4">
<h4 id="orgheadline95"><span class="section-number-4">6.1.2</span> Matching without naming</h4>
<div class="outline-text-4" id="text-6-1-2">
<p>
In some cases we want to write a rule that matches on part of a term
but where we don't need to give a name to that part because we don't
use it in defining the result. 
</p>

<p>
Consider the function <i>constFalse</i>, as an example. We could write two
rules to define this function, one for the term, <i>constFalse true</i>,
and one for <i>constFalse false</i>, but the answer is the same in either
case: <i>false</i>. It doesn't matter whether we apply <i>constFalse</i> to
<i>true</i> or to <i>false</i>. We can thus write one rule that matches both
cases. In particular, <i>constFalse b = false</i> would work, but there's
really no need to introduce the name <i>b</i> in this case, as it's not
used to define the result. When we want to match on part of a term but
we don't need to <i>remember</i> it for use on the right side of a rule, we
can use an underscore, <i>_</i>, in a pattern to match and value of the
designated type.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">constFalse</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
<span style="color: #333333; background-color: #FFFFFF;">constFalse</span> <span style="color: #333333; background-color: #FFFFFF;">_</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">false</span>

<span style="color: #333333; background-color: #FFFFFF;">constTrue</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
<span style="color: #333333; background-color: #FFFFFF;">constTrue</span> <span style="color: #333333; background-color: #FFFFFF;">_</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">true</span>
</pre>
</div>

<p>
We note that we can use this mechanism to slightly shorten the
definition of <i>not</i>, as well. 
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">not</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
<span style="color: #333333; background-color: #FFFFFF;">not</span> <span style="color: #333333; background-color: #FFFFFF;">true</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">false</span>
<span style="color: #333333; background-color: #FFFFFF;">not</span> <span style="color: #333333; background-color: #FFFFFF;">_</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">true</span>
</pre>
</div>

<p>
The key to understanding why this code works is that Idris tries to
match terms with patterns <i>in the order in which the rules are
listed.</i> It's important that the first rule comes first. If we put the
second rule first, it would match both <i>not false</i> and <i>not true</i>,
yielding a result of true in either case.  
</p>

<p>
Writing the first rule first ensures that the term, <i>not true</i>, will
match the first rule, producing <i>false</i> as a result. The term <i>not
false</i> does <b>not</b> match the first rule, so Idris <i>falls through</i> to
the second rule. The pattern <i>not _ = true</i> does then match the term
<i>not false</i>, yielding <i>true</i> as a result. The underscore matches the
<i>false</i>, but no name needs to be (or is) bound to this value, as it
is not needed to define the result, <i>true</i>.
</p>

<p>
If we wrote the second rule first, the pattern in the first rule would
match both <i>not true</i> and <i>not false</i> and so both expressions would be
defined as reducing to <i>false</i>. The thing to remember is that Idris
tries to match function application terms to the patterns in the rules
that a define a function <i>in the order in which they are written</i> in
the function definition.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline101" class="outline-3">
<h3 id="orgheadline101"><span class="section-number-3">6.2</span> Destructuring of terms</h3>
<div class="outline-text-3" id="text-6-2">
<p>
Pattern matching can be used in deeper ways. In particular, when the
argument to a function is not just a simple value, such as <i>true</i> or
<i>false</i>, but a more complicated <i>object</i>, pattern matching can be used
to <i>look into</i> that object, and to unify with its parts. The names
that are bound to those parts can then be used in defining the result
of the function.
</p>

<p>
To illustrate, we now present a new abstract data type, which we will
call <i>Box</i>. The idea is that a value, <i>b</i>, of type Box, is like a box
that itself <i>contains</i> a value of type <i>bool</i>. Now such a Box would
not be very interesting or useful if we couldn't recover the <i>bool</i>
that it incorporates. So in addition to being able to <i>construct</i> Box
objects with <i>bool</i> values inside, we need a function, which we will
call <i>unbox</i>, that, given a <i>Box</i> returns the <i>bool</i> inside.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">module</span> <span style="color: #333333; background-color: #FFFFFF;">Box</span>

<span style="color: #0000FF;">import</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>

<span style="color: #0000FF;">data</span> <span style="color: #333333; background-color: #FFFFFF;">Box</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mkBox</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>

<span style="color: #333333; background-color: #FFFFFF;">unbox</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Box</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
<span style="color: #333333; background-color: #FFFFFF;">unbox</span> (<span style="color: #333333; background-color: #FFFFFF;">mkBox</span> <span style="color: #333333; background-color: #FFFFFF;">b</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">b</span>
</pre>
</div>
</div>

<div id="outline-container-orgheadline97" class="outline-4">
<h4 id="orgheadline97"><span class="section-number-4">6.2.1</span> module definition</h4>
<div class="outline-text-4" id="text-6-2-1">
<p>
The first line opens the definition of a module called <i>Box</i>. The
second line incorporates into this module all of the definitions in
the <i>bool</i> module (provided that the file bool.idr defining the <i>bool</i>
module is in the same directory as the current directory).  We need to
import these definitions because we want to define <i>Box</i> objects as 
incorporating <i>bool</i> values. So far, we haven't seen anything very
deep.
</p>
</div>
</div>

<div id="outline-container-orgheadline98" class="outline-4">
<h4 id="orgheadline98"><span class="section-number-4">6.2.2</span> module import</h4>
<div class="outline-text-4" id="text-6-2-2">
<p>
The second line tells Idris to incorporate into this module all the
definitions given in the <i>bool</i> module. To find the <i>bool</i> module,
Idris looks for a file named <i>bool.idr</i>, which it assumes will contain
the required definitions. The definitions of the <i>bool</i> type, its two
values, and the various <i>bool</i> functions, such as <i>not</i> and <i>id</i>, are
thus incorporated into this module.
</p>
</div>
</div>

<div id="outline-container-orgheadline99" class="outline-4">
<h4 id="orgheadline99"><span class="section-number-4">6.2.3</span> parameterized constructor</h4>
<div class="outline-text-4" id="text-6-2-3">
<p>
The real action starts in the third line. Here we see a new kind of
constructor. The constructor is <i>mkBox bool</i>. The way to read this is
that <i>mkBox</i> is the <i>name</i> of a constructor that can be used to create
values of type <i>Box</i>, but that, when used, it must be given an argument
of type <i>bool</i> as an argument.
</p>

<p>
The <i>mkBox</i> constructor is like a function: it takes an argument and
it returns a result. It takes an argument of type <i>bool</i>, and returns
a value of type <i>Box</i>. Constructors just "package up" their arguments
into terms labelled with the constructor names. There are two values
of type <i>bool</i>, so only two <i>terms</i> can be constructed using <i>mkBox</i>,
namely <i>mkBox true</i> and <i>mkBox false</i>.  These terms are considered as
values of type <i>mkBox.. Because there are no other constructors for
the /Box</i> type, these are also the <i>only</i> values of type <i>Box</i>.
</p>
</div>
</div>

<div id="outline-container-orgheadline100" class="outline-4">
<h4 id="orgheadline100"><span class="section-number-4">6.2.4</span> destructuring of values during pattern matching</h4>
<div class="outline-text-4" id="text-6-2-4">
<p>
The fourth and last lines of this module declare and define a function
called <i>unbox</i>. The fourth line declared that the name <i>unbox</i> will be
bound to a function of type \(Box \to bool\). Given any <i>Box</i> containing
a <i>bool</i> (remember there are only two possibilities), this function
must return a <i>bool</i>.
</p>

<p>
Here's the key idea. We want to <i>unbox</i> to do is not to return any
<i>bool</i> but to return the one inside the <i>Box</i> that is given as an
argument. In other words, we want the application of <i>unbox</i> to the
argument <i>mkBox true</i> to return true, and its application to <i>mkBox
false</i> to return false.
</p>

<p>
We could give two separate rules to define this function:
</p>
<ul class="org-ul">
<li>unbox (mkBox true) = true</li>
<li>unbox (mkBox false) = false</li>
</ul>

<p>
However, we observe that in both cases what is being returned is the
argument that was given to <i>mkBox</i> when hte argummment to <i>unbox</i> was
constructed. If we had a way, within a rule, to name that argument,
whatever it is, then we could replace this pair of rules with a single
rule that would work in both cases.
</p>

<p>
Put another way, an application of <i>unbox</i> to a <i>Box</i> has the general
form,  <i>unbox (mkBox b)</i>, where <i>b</i> is the <i>bool</i> inside the box; and
what we want <i>unbox</i> to return in this case is just (the value of) <i>b</i>.
In the code, as written above, you can see that we can use unification
(pattern matching) to define <i>unbox</i> using a single rule based on this
idea.
</p>

<ul class="org-ul">
<li>The pattern <i>unbox (mkBox b)</i> unifies with <i>unbox (mkBox true)</i> with  <i>b</i> bound to <i>true</i></li>
<li>The pattern <i>unbox (mkBox b)</i> unifies with <i>unbox (mkBox false)</i> with <i>b</i> bound to <i>false</i></li>
</ul>

<p>
In a sense, we are using pattern matching to <i>take apart</i> the argument
to <i>unbox</i> based on the manner in which it must have been constructed,
giving an arbitrary name (here <i>b</i> but we could have used <i>x</i> or <i>qq</i>)
to the <i>bool</i> that must have been passed to the <i>mkBox</i> constructor.
Given this binding, we can now use the name in an expression on the
<i>right</i> side of the equals sign to specify that it is <i>b</i>, the <i>bool</i>
inside the box, that is to be returned.
</p>

<p>
While pattern matching enabled us to reduce two rules to one in this
case, in general it enables the reduction of many cases to one rule.
It is particular important when there is an infinite number of values
to consider, because it is then not possible to <i>enumerate</i> separate
rules for each case.
</p>

<p>
To program effectively, we need to be able to formulate concise,
general-purpose rules that apply to many cases. Pattern matching makes
this possible. Pattern matching is fundamental in modern functional
programming. Be sure you are comfortable with this concept and that
you thoroughly understand the <i>Box</i> example before you go forward.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline102" class="outline-3">
<h3 id="orgheadline102"><span class="section-number-3">6.3</span> Practice</h3>
<div class="outline-text-3" id="text-6-3">
<ul class="org-ul">
<li>Review our definition of the <i>id_unit</i> function. Can you shorten it using pattern matching?</li>
<li>Write a function <i>notUnBox</i> that takes a <i>Box</i> containing a <i>bool</i>
and that returns the <i>negation</i> of the contained value. If the
argument to this function is <i>mkBox false</i>, for example, the
function should return <i>true</i>, and <i>vice versa</i>.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgheadline104" class="outline-2">
<h2 id="orgheadline104"><span class="section-number-2">7</span> Polymorphism</h2>
<div class="outline-text-2" id="text-7">
<p>
We have at this point defined the type <i>Box</i> as a type of value that
is like a box that contains a <i>bool</i>, and <i>pair</i> as being like a box
that contains two <i>bool</i> values. As one can imagine, it is useful to
generalize our <i>Box</i> and <i>pair</i> types from being containers only for
<i>bool</i> values to containers for values of <i>any</i> type, <i>a</i>. We might,
for example, want to have boxes that contain values of type <i>unit</i>,
or numbers, or names. 
</p>

<p>
One way to reach this goal would be first to rename our <i>Box</i> type to
<i>Box_bool</i>, to clarify that it's a box that can contain only a <i>bool</i>
value, and then make copies of and modifications to this type to
produce new types such as <i>Box_unit</i> and (assuming that we have a type
called <i>nat</i> to represent natural numbers) <i>Box_nat</i>.
</p>

<p>
We would need as many modified copies of our original <i>Box</i> type as we
had types that we wanted to put in boxes. This would lead to a lot of
repetition in our code. Such repetition creates lots of problems.  For
example, if we wanted to add one new function to our <i>Box a</i> type, we
would have to edit every file containing a copy of the original
code. Such modifications are costly, also error prone, and genuinely
impractical at scale.
</p>

<p>
What we want instead is a single module, <i>Box</i>, that <i>parameterized by
the type of value it is to contain</i>.  This generalization leads to the
types that we call <i>Box a</i>, where <i>a</i> isa <i>type parameter</i>. We call a
type such as this <i>Box a</i> type <i>polymorphic</i>. The word means "having
many forms." Now if we want a box with a bool inside, we make a box of
type <i>Box bool</i>. If we want a box with a unit inside, we make a box of
type <i>Box unit</i>. In general, given any type <i>a</i> we can construct a new
type, <i>Box a</i>: the type of boxes that contain values of type <i>a</i>.
</p>

<p>
Here's the code for a polymorphic version of our <i>Box</i> type. 
</p>


<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">module</span> <span style="color: #333333; background-color: #FFFFFF;">Box</span>

<span style="color: #0000FF;">data</span> <span style="color: #333333; background-color: #FFFFFF;">Box</span> <span style="color: #333333; background-color: #FFFFFF;">t</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mkBox</span> <span style="color: #333333; background-color: #FFFFFF;">t</span>

<span style="color: #333333; background-color: #FFFFFF;">unbox</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Box</span> <span style="color: #333333; background-color: #FFFFFF;">t</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">t</span>
<span style="color: #333333; background-color: #FFFFFF;">unbox</span> (<span style="color: #333333; background-color: #FFFFFF;">mkBox</span> <span style="color: #333333; background-color: #FFFFFF;">b</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">b</span>
</pre>
</div>

<p>
Compare this code carefully with the previous version of <i>Box</i>, which
was specialized to contain only values of type <i>bool</i>.  In the second
line, we see that not <i>Box</i> but <i>Box t</i> is declared to be a data type.
The <i>t</i> (which could have been any name) is understood to be a <i>type
parameter</i>, and <i>Box</i> is now understood to be a <i>type constructor</i>.
In other words, <i>Box</i> is now something like a function, but one that
takes a <i>type</i> rather than a value of a type as a parameter, and one
that returns a type, rather than a value of a type, as a result. 
</p>

<p>
On the right side of the equals sign, we see that the type <i>Box t</i> has
constructor, <i>mkBox t</i> that takes as a parameter a value not only of
type <i>bool</i>, but of the type <i>t</i>, whatever it was. For example, the
type <i>Box bool</i> has a constructor <i>mkBox bool</i> that takes a <i>bool</i> as
an argument, while the type <i>Box unit</i> has a constructor <i>mkBox unit</i>
that takes a value of type <i>unit</i> as an argument.
</p>

<p>
It is important to see that our polymorphic <i>Box</i> is no longer a type
all by itself. <i>Box bool</i> on the other hand is a type, as is <i>Box
unit</i>. We can think of these as types of boxes that contain <i>bool</i> and
<i>unit</i> values, respectively.  If we had a natural number type, <i>nat</i>,
then <i>Box nat</i> would be a type the values of which are likes boxes 
that contain numbers. 
</p>

<p>
We can similarly make our previous <i>pair</i> type polymorphic, changing
it from a type good only for storing pairs of <i>bool</i> values into one
good for storing pairs of values of <i>any</i> two types. Here's the new
version. Now <i>pair</i> is no longer a type, but <i>pair bool bool</i> is, and
so are <i>pair bool unit</i>, and <i>pair nat bool</i>. Values of these three
types would include <i>mkPair true false</i>, <i>mkPair false mkUnit</i>, and
<i>mkPair 5 false</i>. 
</p>

<p>
Here's the code for a polymorphic pair type. Comparing it to our
earlier bool-only version, we see two changes. First, we added two
type parameters to the left of the equals sigh in the data type
declaration.  Second we replaced every occurrence of <i>bool</i> with the
parameters <i>a</i> and <i>b</i> instead.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">module</span> <span style="color: #333333; background-color: #FFFFFF;">pair</span>

<span style="color: #0000FF;">data</span> <span style="color: #333333; background-color: #FFFFFF;">pair</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #333333; background-color: #FFFFFF;">b</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mkPair</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #333333; background-color: #FFFFFF;">b</span>

<span style="color: #333333; background-color: #FFFFFF;">fst</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">pair</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #333333; background-color: #FFFFFF;">b</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>
<span style="color: #333333; background-color: #FFFFFF;">fst</span> (<span style="color: #333333; background-color: #FFFFFF;">mkPair</span> <span style="color: #333333; background-color: #FFFFFF;">f</span> <span style="color: #333333; background-color: #FFFFFF;">s</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">f</span>

<span style="color: #333333; background-color: #FFFFFF;">snd</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">pair</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #333333; background-color: #FFFFFF;">b</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">b</span>
<span style="color: #333333; background-color: #FFFFFF;">snd</span> (<span style="color: #333333; background-color: #FFFFFF;">mkPair</span> <span style="color: #333333; background-color: #FFFFFF;">f</span> <span style="color: #333333; background-color: #FFFFFF;">s</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">s</span>
</pre>
</div>


<p>
We have already said that <i>Box</i> and <i>pair</i> are no longer types, per
se. What we now see is that they are actually a lot like functions,
except now they take <i>types</i>, such as <i>bool</i>, <i>unit</i>, and <i>nat</i>, as
parameters, and they also return <i>types</i> as results. We refer to such
things not as types but rather as <i>type constructors</i>. So <i>Box</i> and
<i>zpair</i> are now types constructor. You give them types as parameters
(such as <i>bool</i> and <i>unit</i>) and they give you back types, such as <i>Box
bool</i> and <i>pair bool unit</i>. These types, in turn, have constructors
(such as <i>mkBox t</i>) and other functions (such as <i>unbox</i>) specialized
to operate on values of the specified types.
</p>
</div>
</div>

<div id="outline-container-orgheadline112" class="outline-2">
<h2 id="orgheadline112"><span class="section-number-2">8</span> Interpretation</h2>
<div class="outline-text-2" id="text-8">
<p>
We now take a diversion to make explicit an important point that has
been implicit until now. The terms that encode Idris values (and in
general the values that computer programs manipulate) are like the
symbols of any language: they do not carry any meanings by themselves.
Rather, we impose <i>interpretations</i> on such symbols. We agree on what
they <i>represent</i>.
</p>

<p>
For example, when we see the sequence of letters, <i>b.u.n.n.y</i> (in
English), we understand it to <i>mean</i> a <i>furry animal</i>.  Logicians use
the word <i>interpretation</i> to refer to associations between <i>symbols</i>
and <i>meanings</i>, and so will we.
</p>
</div>

<div id="outline-container-orgheadline109" class="outline-3">
<h3 id="orgheadline109"><span class="section-number-3">8.1</span> Boolean Algebra</h3>
<div class="outline-text-3" id="text-8-1">
<p>
So how do these ideas relate to what we're doing? Well consider our
<i>bool</i> type. We have been quietly interpreting the <i>bool</i> type as
representing <i>Boolean algebra</i>, a simple algebra that George Boole
invented to reason about logical relationships among statements (<i>An
Investigation of the Laws of Thought</i> (1854)).
</p>
</div>

<div id="outline-container-orgheadline105" class="outline-4">
<h4 id="orgheadline105"><span class="section-number-4">8.1.1</span> An introduction to Boolean algebra</h4>
<div class="outline-text-4" id="text-8-1-1">
<p>
Mathematically speaking, Boolean algebra comprises a set of values,
<i>true</i> and <i>false</i>, often denoted as <i>1</i> and <i>0</i>, respectively, and a
set of operations these values. The operations include <i>negation</i>,
often called <i>not</i>; <i>conjunction</i>, often called <i>and</i>, and denoted by
<i>*</i>; <i>exclusive or</i>, often denoted by <i>+</i>; and <i>disjunction</i>, often
called <i>or</i>.
</p>

<p>
We can easily enumerate the rules that these operations follow. For
example, <i>not 0 = 1</i> and <i>not 1 = 0</i>. We can write one rule instead:
<i>not b = 1 - b</i>. By substituting \(1\) and then \(0\) for <i>b</i> you easily
see that this rule works.
</p>

<p>
In Boolean algebra, the conjunction of two propositions is deemed to
be true if and only if both propositions are true. The rules for <i>and</i>
encode this concept: \(0 * 0 = 0\), \(1 * 0 = 0\), \(0 * 1 = 0\), and \(1 * 1
= 1\). We can again write one rule for and, namely <i>and a b = a * b</i>.
Here the <i>*</i> is ordinary integer multiplication. Once again you should
confirm manually that the rule works in all four cases.
</p>

<p>
The <i>exclusive or</i> operation in Boolean algebra captures the idea that
a statement is true if one, but not both, of its parts are true. This
sense is often that which is meant when we say <i>or</i> in English. "You
may have a cookie <i>or</i> a candy." There is in this statement an implied
"but not both." We would thus say that the statement, "She ate a candy
<i>exclusive or</i> she ate a cookie" is true if she ate one or the other
but not both.
</p>

<p>
Exclusive or follows these rules: \(0 + 0 = 0\), \(0 + 1 = 1\), \(1 + 0 =
1\), and \(1 + 1 = 0\). That is, <i>a xor b</i> is true if and only if one but
not both of <i>a</i> and <i>b</i> are true.
</p>

<p>
This looks like a strange version of <i>+</i>. Since when is \(1 + 1 = 0\)?
The answer is that \(1 + 1 = 0\) in the arithmetic system known as the
<i>integers modulo 2</i>. This is a very simple example of what is often
called clock arithmetic. Here we have a clock with just two hours,
with \(0\) at the noon position and \(1\) at the bottom. On such a clock,
starting at \(1\) and adding one hour takes us back to \(0\) at the top of
the clock.
</p>

<p>
Boolean algebra as George Boole defined it does have some additional
operations, including disjunction (<i>or</i>). A proposition involving <i>or</i>
is deemed to be true if either one <i>or both</i> of its arguments is true.
The four possible cases are <i>or 0 0 = 0</i>, <i>or 0 1 = 1</i>, <i>or 1 0 = 1</i>,
and <i>or 1 1 = 1</i>. While it's not immediately obvious, a simple check
will confirm that in general, <i>or a b = /a + b - (a * b)</i>.
</p>

<p>
What we have so far is that Boolean algebra is a little mathematical
system comprising the set of Boolean truth values, \(\{ 0, 1 \}\) and
the operations, <i>*</i>, <i>+</i>, <i>or</i>, and <i>not</i>. There are other operations
as well. These include the identity function, the negation of the
conjunction of two values (often called <i>nand</i>), and more. There are
actually four <i>unary</i> operations taking one Boolean value (like <i>not</i>)
and sixteen <i>binary</i> operations taking two values (like <i>and</i>). 
</p>

<p>
At this point, we can now define Boolean algebra quite concisely.
Boolean algebra is the mathematical object, an <i>algebra</i>, comprising
the set of Boolean values and the set of unary and binary operations
on these values: \(\{ \{ 0, 1 \}, \{ *, +, id, not, or, nand, \ldots
\}\).
</p>

<p>
This simple little algebra <i>is</i> the Boolean <i>abstract data type</i> (ADT)
that we have started to design and <i>implement</i> in Idris.  It exists,
and has has been understood, for over a hundred and fifty years.  It
is independent of Idris and of programming in any other language, yet
<i>every</i> general-purpose programming language implements this ADT. It
is the basis for making <i>decisions</i> in code: if the battery is charged
<i>and</i> the button is pushed then turn on the phone.
</p>
</div>
</div>

<div id="outline-container-orgheadline106" class="outline-4">
<h4 id="orgheadline106"><span class="section-number-4">8.1.2</span> Logical representation</h4>
<div class="outline-text-4" id="text-8-1-2">
<p>
So we now arrive at the two main points of this chapter. First, when
we program, we start in a real or mathematical world outside the realm
of programming. We find a system (such as Boolean algebra, or friends
in a social network) that we want to represent and manipulate in a
computer (a <i>machine</i>).  Next we <i>design</i> a set of logical symbols and
definitions that we intend to use to <i>represent</i> that world. We then
<i>interpret</i> those symbols as representing things (such as objects and
functions and activities) in that world.  Moreover, when we use the
machine to compute with these symbols, if we have been careful, then
we can legitimately interpret the results as having intended meanings
back in the real world. 
</p>

<p>
This is the real "magic" of computing. We map from the real world to
logical symbols; we carry out computations involving this logic; and
then we can interpret the results as valid in the world. To compute
\(764 * 1933\), for example, we first represent these numbers as logical
terms in a machine, then we apply a machine function to those terms to
produce a new term; and finally we interpret this term as a <i>correct</i>
answer for the given problem.
</p>

<p>
This is essentially what we are doing with Boolean algebra and Idris.
What we have done so far in Idris is to <i>design</i> and <i>implement</i> a
module that represents, and that we <i>interpret</i> as <i>representing</i>, the
values and functions of Boolean algebra. What we have ended up with is
a machine with which we can carry out what amount to computations in
Boolean algebra. In a deep sense, the machine <i>faithfully simulates</i>
real-world Boolean algebra, and so we are justified in mapping back
and forth between the real and the machine worlds.
</p>

<p>
To further clarify these ideas, let's consider another
example. Suppose we want to compute the value of \(not 1\) in Boolean
algebra. We first translate the Boolean value \(1\) to its machine
representation, i.e., to the Idris term, <i>true</i>. Having previously
represented the Boolean operation of negation as the Idris function,
<i>not</i>, we next apply this machine-level function to the machine-level
data item, <i>true</i>, yielding the machine-level result, <i>false</i>.
Finally, we <i>interpret</i> this machine-level result as having <i>meaning</i>,
namely \(0\), and indeed as giving us the right answer to the original
question, "back in the real world of Boolean algebra." 
</p>
</div>
</div>

<div id="outline-container-orgheadline107" class="outline-4">
<h4 id="orgheadline107"><span class="section-number-4">8.1.3</span> Programming as representation</h4>
<div class="outline-text-4" id="text-8-1-3">
<p>
The art of programming is the art of representing "real" worlds in
terms of logical data and functions so that computations that are done
on logical <i>symbols</i> are still meaningful in the world outside of the
computing machine. Programming is not only a way to solve problems but
also a way to <i>see and represent the world</i> so that one can reason
logically about it. To write software for a domain such as healthcare,
you have to see how to represent it in the logical terms provided by a
programming system such as Idris or Python, in a way that will ensure
that results produced by symbolic logic computations are meaningful in
that that world.
</p>
</div>
</div>

<div id="outline-container-orgheadline108" class="outline-4">
<h4 id="orgheadline108"><span class="section-number-4">8.1.4</span> Fluency in reading and writing code</h4>
<div class="outline-text-4" id="text-8-1-4">
<p>
We also see arising a notion of fluent reading and writing of code. As
intelligent humans, we learn to <i>internalize</i> interpretations. When we
read a word, phrase, or sentence, i.e., a symbolic marcking, we tend
to interpret it with almost no conscious effort, mentally substituting
real-world meanings for the otherwise arbitrary symbolic markings on
the page. Similarly, as programmers, when we see an Idris term, such
as <i>true</i>, with practice we see <i>instead</i> the intended meaning. We
read the Idris term, <i>true</i>, <b>as</b> a Boolean truth value, namely \(1\).
</p>

<p>
In general this kind of fluent reading and writing of code is a "good
thing." Getting to this point is one of the main goals of this class.
On the other hand, it can be problematical if we assume incorrectly
that a simple interpretation is valid when it's not. Later in the
course we will see examples of cases where machine-level terms do not
necessarily have exactly the meaning that they would seem to have. In
such cases, one must take great care not to misinterpret such terms.
Doing so can lead to disasters.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline110" class="outline-3">
<h3 id="orgheadline110"><span class="section-number-3">8.2</span> What does the type <i>pair a b</i> represent?</h3>
<div class="outline-text-3" id="text-8-2">
<p>
What is our intended interpretation of the type <i>pair a b</i>? As we
stated when we introduced it, we mean to interpret this type as the
set of <i>ordered pairs</i> of values of types <i>a</i> and <i>b</i>, respectively.
In mathematical language, we call such a set of ordered pairs the
<i>product</i> of the sets (represented by the types) <i>a</i> and <i>b</i>. 
</p>

<p>
If, for example, <i>a</i> is a data type that we interpret as representing
the set, \(\{ dog, cat, bird \}\) and <i>b</i> as representing the set \(\{ x,
y \}\) then then we interpret the type <i>pair a b</i> as representing the
<i>set product</i> of <i>a</i> and <i>b</i>: namely, the set containing all ordered
pairs of elements drawn from <i>a</i> and <i>b</i> respectively as its elements:
namely, \(\{ (dog, x), (dog, y), (cat, x), (cat, y), (bird, x), (bird,
y) \}\).
</p>

<p>
As a program designer, we choose to represent the mathematical pair,
\((dog, y)\) as the Idris term <i>mkPair dog x</i>. But as a fluent reader
and writer of code, what we think when we see this logical term is the
mathematical concept, \((dog, x)\). The ability to think computationally
rests on the the ability to mentally cross back and forth between the
real world that is being represented and the world of logical terms
being used to represent it.
</p>

<p>
One cannot expect to be fluent in this way right away. It takes many
examples and a good deal of practice. One of the key challenges it to
know when to see terms conceretely, and when to see them for what they
represent. While it is often useful to "read through" concrete terms
to their intended meanings, there are situations where one must treat
them as concrete, logical objects. One such place is when writing
functions that operate on terms. The reason is that pattern matching
involves matching on the logical structures of terms. We don't match
on interpreted meanings but on the actual concrete logical structures
of arguments.
</p>
</div>
</div>

<div id="outline-container-orgheadline111" class="outline-3">
<h3 id="orgheadline111"><span class="section-number-3">8.3</span> Practice</h3>
<div class="outline-text-3" id="text-8-3">
<ol class="org-ol">
<li>Define a type the values of which are days paired with Boolean  values.</li>

<li>Design and implement an abstract data type with one data type and
one function. The data type represents the set of people, $\{ mary,
maurice \}.$ You should name your constructors accordingly. The one
function tells us who loves whom. Sadly, while mary loves maurice,
maurice loves only himself.</li>

<li>Pick a simple, real-world example. Keep it very simple. Design and
implement an abstract data type to represent it. Your ADT should
define both a data type and at least one function.</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orgheadline113" class="outline-2">
<h2 id="orgheadline113"><span class="section-number-2">9</span> Modeling, Abstractions, Code</h2>
<div class="outline-text-2" id="text-9">
<p>
Software is ultimately about the real world, but it's connection to
the real world is made through multiple levels of representation. To
understand programming, one must first understand that it's not only
(or arguably even mainly) about writing code
</p>

<p>
So if programming isn't only about code,then what is it about? In this
chapter, we present a tri-partite model of programming. Programming is
about reality, abstractions, and implementations (code).
</p>

<p>
First, programming is about reality. You begin by deciding what it is
in the real world that you want to represent and manipulate.  Second,
you choose or design <i>logical-mathematical abstractions</i> to represent
the relevant real-world things and processes. Finally, you write code
to implement those abstractions. 
</p>

<p>
You can often use pre-existing implementations of general abstractions
to avoid the need to write most of the required code from scratch. In
today's class, we will go through the process of first thinking about
reality, then identifying some fundamental abstractions to use in the
process of representing it. Finally we will write supporting code to
implement these abstractions.
</p>

<p>
In the lab this week, we will continue this exercise in the domain of
color spaces for digital imaging and printing.
</p>

<p>
Perhaps the most important message of this chapter is that programming
starts with a careful and rigorous analysis of the real-world <i>domain</i>
for which code is to be written.
</p>
</div>
</div>

<div id="outline-container-orgheadline114" class="outline-2">
<h2 id="orgheadline114"><span class="section-number-2">10</span> Inductive Definitions</h2>
<div class="outline-text-2" id="text-10">
<p>
In this chapter we ask and answer the question, how can we define
types that comprise infinite sets of values?
</p>

<p>
The elementary school concept of the counting numbers, also called the
<i>natural numbers</i>, is a great example. The natural numbers start at
zero and go up by ones from there, ad infinitum.  In other words,
using <i>nat</i> as a shorthand name for the natural numbers, \(nat = \{ 0,
1, 2, \ldots \}\). The elipsis here means <i>and so on, ad infinitum</i>.
</p>

<p>
So how can we write a data type definition that expresses this set of
values?  We know how specify types with a finite number of values. The
<i>unit</i>, <i>bool</i>, and <i>color</i> types are great examples. We <i>enumerated</i>
the elements of these sets. E.g., <i>data bool = true | false</i>.  
</p>

<p>
Clearly this won't work for <i>nat</i>.  <i>data nat = zero | one | two |
three | &#x2026;</i> We could never finish the enumeration. The challenge is
to find a finite-length representations for types with infinite sets
of values.
</p>

<p>
The solution is found in what we call <i>inductive definitions</i>. By
<i>inductive</i>, we mean a definition of a type of values that includes
one or mode rules that explains how bigger values of the type can be
constructed from smaller values of the same type. Such a definition is
completed by giving at least one <i>small</i> value directly. 
</p>

<p>
Again, the natural numbers provide a great example. The inductive
rules says that if you have any natural number, \(n\), you can construct
a one-larger natural number called <i>the successor of n</i> (or \(S n\) for
short). The starting point for the induction is the second rule, which
simply says that <i>zero</i> (let's denote is as \(O\)) is a natural number.
Because \(O\) is, so is \(S O\). Now because \(S O\) is, so is \(S (S O)\).
And so on, <i>ad infinitum.</i>
</p>

<p>
Inductive types have several important properties First, the process
of constructing larger values from smaller ones can be carried any
<i>finite</i> number of times. From this restriction, we can deduce that
every value of an inductive type is finite. For example, every natural
number is finite. 
</p>

<p>
Second, a larger value actually embeds the smaller values from which
it was constructed, much as a larger Russian doll actually contains
the smaller doll from which it was "constructed." For example, the
natural number \(7\) can be understood as <i>the successor of the natural
number 6</i>. That is, \(7\) <i>is</i> really just \((S 6)\). The \(6\) is in a
strong sense <i>nested</i> inside the term, <i>S 6</i>, that constitutes the
number \(7\).
</p>

<p>
So, third, what this means is that whenver one is given a larger value
of an inductive type, one can take it apart (or <i>destructure</i>) it, in
order to obtain the parts from which it was constructed. In our small
example, the natural number \(7\) is destructured into the application
of <i>S</i> to the value \(6\). The value \(6\) is similarly constructed, so we
can take it apart. Crucially, one can repeat such a <i>destructuring</i>
process only a finite number of times before reaching the starting
point of the induction. In this example, that will be zero.
</p>


<p>
Technically speaking, the set of values of the data type is then
defined as the smallest set of values that can be constructed by any
<i>finite</i> number of applications of the constructors of the type. All
that this means is (1) all such finitely constructed values <i>are</i> in
the set, and (2) no other values are allowed to <i>creep in</i>.
</p>

<p>
We can now more precisely define the natural numbers inductively, The
rules are known as Peano's axioms. (1) if \(n\) is any natural number,
then the successor of \(n\), denoted \(S n\), is also a natural number;
(2) \(O\) is a natural number; (3) \(O\) is not the successor of any
natural number; and (4) for any natural numbers, \(n\) and \(m\), \(n = m\)
if and only if \(S n = S m\). 
</p>

<p>
Rules (1) and (2) allow one to build natural numbers by applying \(S\)
to \(O\) any number of times. Rule (3) says that the successor operation
never <i>loops around to \(O\)</i>. Finally, rule (4) basically says that the
successors of different numbers are themselves different numbers, as
are the predecessors of different non-zero natural numbers.
</p>

<p>
So here, finally, is the one line of code that captures all of these 
ideas. It's a remarkably short definition that really says a lot!
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">data</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">O</span> <span style="color: #BA36A5;">|</span> <span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
</pre>
</div>

<p>
This definition introduces a new data type called <i>nat</i> with two
constructors. The first constructor makes \(O\) a value of type <i>nat</i>,
taking care of rule (2) above, and giving us a starting point for
induction.
</p>

<p>
The second constructor, <i>S nat</i>, defines what amounts to a <i>function</i>
for constructing larger <i>nat</i> values from smaller ones. (We already
have one, namely \(O\), to start with.) That is if \(n\) is any value of
type <i>nat</i>, this <i>S</i> constructor can be applied, using the expression
<i>S n</i>, to construct a one-larger value <i>of type nat</i>.  <i>S</i> takes care
of rule (1) above, and gives us the ability to construct arbitrarily
large values of type <i>nat</i> by <i>iterating the application of S to O</i>.
</p>

<p>
The resulting terms are \(O, S O, S (S O), S (S (S O)), \ldots\). It is
also easy to see that a term for \(S n\) incorporates the term for \(n\).
By destructuring \(S n\) and stripping one \(S\) we obtain the embedded
term \(n\), from which \(S n\) was constructed.  Taking apart inductively
defined values into their parts is critically important when it comes
to defining functions that operate on values of such types.
</p>

<p>
Finally, it should be clear that given any natural number \(n\), either
it is \(O\) or it can be destructured into smaller terms, but this can
be done only a finite number of times before reaching \(O\) (because
only a finite number of iterations of S could have occurred). Thus any
process of destructuring an inductively defined value must terminate
after some possibly large but alwasy finite number of steps.
</p>

<p>
The concept of inductive definitions is truly fundamental in computer
science. Many, many crucial data types, including the Peano natural
numbers, lists, trees, file systems, etc., are defined inductively.
For that matter, so is the syntax of most programming languages. In
other words, programs themselves are values of inductively defined
types! We will run into this idea again shortly.
</p>
</div>
</div>

<div id="outline-container-orgheadline126" class="outline-2">
<h2 id="orgheadline126"><span class="section-number-2">11</span> Recursive Functions</h2>
<div class="outline-text-2" id="text-11">
<p>
Having introduced the <i>nat</i> data type, we now need to define a set of
common functions taking <i>nat</i> arguments in order to complete a simple
abstract data type for natural number arithmetic. Examples include
natural number addition, multiplication, exponentiation, subtraction,
and Boolean-valued comparison operators, such as less-than-or-equal,
greater-than, equals, greater than, and less than.
</p>

<p>
The problem we face is that our <i>nat</i> data type defines an infinite
set of values of type <i>nat</i>, and we can't possibly write function
definitions (e.g., for addition) by giving rulesfor every possible
value or pair of vaues of of type <i>nat</i>. We once again need to find a
concise way to give one rule or a small set of rules that cover an
infinity of special cases.
</p>

<p>
A solution is found in the concept of recursive function definitions.
By a <i>recursive function</i> we mean a function that is defined, directly
or indirectly, in terms of itself. An good example is the <i>factorial</i>
function. For any natural number, \(n\) such that \(n>0\), \(factorial(n) =
n * factorial(n-1)\).  The function is defined by an expression that
uses the function itself! Completing the definition is a <i>base case</i>:
\(factorial(0) = 1\).
</p>

<p>
Try it: compute \(factorial(5)\) by repeatedly substituting the right
hand side of the definition of the left hand side until a value is
obtained.  Here it goes: \(factorial(5) = \\ 5 * factorial(4) = \\ 5 *
(4 * factorial(3)) = \\ 5 * (4 * (3 * factorial(2))) = \\ 5 * (4 *
(3 * (2 * factorial(1)))) = \\ 5 * (4 * (3 * (2 * (1 *
factorial(0))))) = \\ 5 * (4 * (3 * (2 * (1 * 1)))) = \\ 5 * 4 * 3 *
2 * 1 = 120\).
</p>

<p>
Just as many familiar data types, such as <i>nat</i>, are defined
inductively, so many familiar functions are defined recursively. This
chapter providesboth concrete examples of, and general approaches to
designing and implementing, recursive functions. You will learn that
most ordinary functions of arithmetic have recursive definitions, and
that we can translate them straightforwardly into recursive functions
in Idris. Doing so will enable us to compute with these functions.
</p>

<p>
Among other things, we will see how recursive function definitions can
follow closely from the inductive structures of the values that they
take as arguments. It makes sense! Performing an operation a larger
value of an inductively defined object often involves performing the
same operation on the smaller values embedded inside of it! Examples
below will make this point clear.
</p>
</div>

<div id="outline-container-orgheadline115" class="outline-3">
<h3 id="orgheadline115"><span class="section-number-3">11.1</span> An example: the factorial function</h3>
<div class="outline-text-3" id="text-11-1">
<p>
We begin this chapter on recursive functions with a simple example:
that of the the factorial function. It is often written as \(!\). This
function takes a natural number, \(n\), as an argument and returns a
natural number, namely \(n!\), as a result. In particular, \(n!\) is the
product of all the natural numbers from \(1\) to \(n\). The factorial of
\(5\), for example, or \(5!\), is \(5 * 4 * 3 * 2 * 1 = 120\).
</p>

<p>
A careful examination of that sequence of multiplications reveals a
beautiful recursive structuring. One just needs to place parenthesis
around the expression after the \(5\). The re-written equation looks
like this: \(5!  = 5 * (4 * 3 * 2 * 1)\). At this point, you should emit
a large "ah ha." We can rewrite \((4 * 3 * 2 * 1)\) as \(4!\). We can thus
write the whole equation as \(5! = 5 * 4!\). Moreover, you can see that
the same trick will work for any \(n > 0\).  That is, for \(n > 0, n! =
n * (n-1)!\). When \(n = 0\) we already have an answer: \(0! = 1\).
</p>

<p>
We thus arrive at a recursive definition of the function.  For <i>any</i>
natural number, \(n\), if \(n = 0\) then \(n! = 1\) otherwise \(n!  = n *
(n-1)!\). That's it. The hard part of programming recursive functions
is simply knowing how to formulate a recursive definition, as we've
done here. Once you have such a definition, translating it into code
is relatively straightforward. The intellectual hard work is in first
seeing the recursion and then using the insight to write a recursive
mathematical definition of the function at hand.
</p>
</div>
</div>

<div id="outline-container-orgheadline125" class="outline-3">
<h3 id="orgheadline125"><span class="section-number-3">11.2</span> next</h3>
<div class="outline-text-3" id="text-11-2">
<p>
To write a recursive function for factorial in Idris, we need a
function for multiplication. As you might suspect, we can define
multiplication using recursion and addition. Moreover, we can define
addition using recursion and incrementing. We're going to see that
most ordinary arithmetic operation on natural numbers have recursive
definitions, that we can translate directly into code.
</p>

<p>
So now the <i>bigger picture</i> becomes clear. Our task is to design and
implement a natural number abstract data type, including a <i>nat</i> data
type and a set of functions as listed above; and we will use recursion
implement several of these functions.
</p>

<p>
The functions include both <i>unary</i> and <i>binary</i> functions. Unary
functions take one natural number as an argument. These functions
include successor, predecessor, a test for being zero (returning a
Boolean value), the factorial function, and a function for computing
the \(n'th\) Fibonacci number. Binary functions take two natural numbers
as arguments. They include addition, subtraction, multiplication,
exponentiation, and Boolean comparison operators, less-than-or-equals,
greater than, and so forth (which return Boolean values).
</p>

<p>
So let's get started. The first few functions don't require any use
of recursion.
</p>
</div>

<div id="outline-container-orgheadline116" class="outline-4">
<h4 id="orgheadline116"><span class="section-number-4">11.2.1</span> successor</h4>
<div class="outline-text-4" id="text-11-2-1">
<p>
Given any value of type <i>nat</i>, our successor function, \(succ: nat \to
nat\), computes and returns its successor. To do so it just applies the
<i>S</i> constructor to \(n\).
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">succ</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">succ</span> <span style="color: #333333; background-color: #FFFFFF;">n</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">n</span>
</pre>
</div>

<p>
The one rule in this case allows us to evaluate any application of
<i>succ</i> to any natural number, call it <i>n</i>.  The rule indicates that in
any such case, the result to be returned is obtained by evaluating the
expressions <i>S n</i>.
</p>
</div>
</div>

<div id="outline-container-orgheadline117" class="outline-4">
<h4 id="orgheadline117"><span class="section-number-4">11.2.2</span> isZero</h4>
<div class="outline-text-4" id="text-11-2-2">
<p>
Given any natural number, <i>n</i>, the <i>isZero</i> function returns <i>true</i> if
\(n=O\) and <i>false</i> otherwise. No recursion is needed or used here.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">isZero</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
<span style="color: #333333; background-color: #FFFFFF;">isZero</span> <span style="color: #333333; background-color: #FFFFFF;">O</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">true</span>
<span style="color: #333333; background-color: #FFFFFF;">isZero</span> <span style="color: #333333; background-color: #FFFFFF;">_</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">false</span>
</pre>
</div>

<p>
This function implementation has two rules, one for each possible
<i>form</i> of the argument: either zero (\(O\)) or <i>other</i>. The first rule
assures than any function application of the form <i>isZero O</i> reduces
to <i>true</i>. The second rule matches an application of <i>isZero</i> to any
other value, and assures the result is <i>false</i>. No recursion is either
needed or used here.
</p>
</div>
</div>

<div id="outline-container-orgheadline118" class="outline-4">
<h4 id="orgheadline118"><span class="section-number-4">11.2.3</span> predecessor</h4>
<div class="outline-text-4" id="text-11-2-3">
<p>
Given any natural number, \(n\), <i>pred n</i> returns its predecessor.  For
the time being, we define <i>pred O</i> to be <i>O</i>. The interesting case is
when the argument, \(n\), is non-zero. Because \(n\) is non-zero in this
case, \(n\) must be the successor of some one-smaller number. Lets call
it \(n'\). Thus <i>n = S n'.</i> In this case, we define the predecessor of
\(n\) to be \(n'\).  
</p>

<p>
For example, to compute the <i>predecessor of 7</i>, we view it as the
<i>predecessor of (the successor of 6)</i>, and \(6\) is then the desired
result. Here's the code.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">pred</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">pred</span> <span style="color: #333333; background-color: #FFFFFF;">O</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>
<span style="color: #333333; background-color: #FFFFFF;">pred</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">n</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">n</span>
</pre>
</div>

<p>
The crucial point to take away from this example is that the pattern
matching on the left side of the second rule has the effect of, in
some sense, <i>tearing apart</i> the argument to the function. It breaks
off the leading <i>S</i> and binds the name <i>n</i> the value to which <i>S</i> was
applied to contruct the original argument/. That smaller <i>nat</i> that
was embedded in the argument is then returned as the result of the
function.  We say that pattern matching <i>destructures</i> the argument,
giving us both access to and names for the values (in this case just
one value) from which it was constructed.
</p>
</div>
</div>

<div id="outline-container-orgheadline122" class="outline-4">
<h4 id="orgheadline122"><span class="section-number-4">11.2.4</span> addition</h4>
<div class="outline-text-4" id="text-11-2-4">
<p>
We now come to a new kind of function: natural number addition. First,
it is at a mathematical level a <i>binary</i> function: one that takes two
natural number arguments and that returns a third as a result. Second,
it is defined recursively.
</p>
</div>

<ol class="org-ol"><li><a id="orgheadline119"></a>Implementing binary functions using the pair type<br  /><div class="outline-text-5" id="text-11-2-4-1">
<p>
Before we get to recursion, we need to address the problem that this
is a binary function, but to date we have only learned how to write
unary functions: functions that take one argument. Here we will not
continue with this pattern by defining an Idris function that takes a
<i>pair</i> of natural numbers (values of type <i>nat</i>) as a single argument.
</p>

<p>
It is here that now find a genuine use for our polymorphic pair type!
We will use the same trick with the rest of the binary functions in
this chapter. To remind ourselves that this function takes a pair, we
will call it <i>addp</i> (where <i>p</i> indicates <i>pair</i>). We can now specify
the name and type of our function:
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">addp</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">pair</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
</pre>
</div>
</div></li>

<li><a id="orgheadline121"></a>Designing and implementing our first recursive function<br  /><div class="outline-text-5" id="text-11-2-4-2">
<p>
Recursion is a tricky concept at first. It is not always easy to see
how to write recursive functions. We strongly recommend adopting a
structured problem solving approach. Use several steps to arrive at a
set of rules for evaluating function applications.
</p>

<p>
First, come up with a set of possible forms that the argument to the
function could take. Each case becomes a rule in the definition of the
function. Second, understand the mathematics of the recursion before
trying to write detailed code for the individual cases. Finally, write
the code.
</p>
</div>

<ol class="org-ol"><li><a id="orgheadline120"></a>Case analysis<br  /><div class="outline-text-6" id="text-11-2-4-2-1">
<p>
We are considering the addition of pairs of numbers; let's call them
\(n\) and \(m\). So the general form of an application of <i>addp</i> will look
like this: <i>addp (mkPair n m)</i>. The question is how can we break this
up into cases, with at least one base case and one recursive case. 
</p>

<p>
It takes practice. For now we will just give a good answer: we will
decompose the general case into two sub-cases, one for each of the two
<i>constructors</i> by which \(n\) could have been built. That is, we will
consider the case where where \(n\) is zero (\(O\)), and the case where
\(n\) is /S n'/ for some one-smaller natural number, \(n'\). 
</p>

<p>
In other words, we're considering one case where \(n\) is zero and one
case where \(n\) is positive. Iin the second case we are also giving a
name to the one-smaller value, \(n'\), from which the positive value,
\(n\), must have been constructed (by an application of <i>S</i>). 
</p>

<p>
Let's look at some concrete cases. Read these examples carefully, and
notice how solutions to the <i>larger</i> problems rely on solutions to the
<i>next smaller problems down</i>. 
</p>

<p>
\( O + m          = m \\
 (S O) + m       = S (O + m)  = S m \\
 (S (S O)) + m   = S ((S O) + m) = S (S m) \\ 
 (S (S (S O) + m = S ((S (S O)) + m) = S (S (S m))\)
</p>

<p>
Look at the last example, in particular.
It says that we can compute the result of adding \(3\) to \(m\) by taking
the successor of the result of adding \(2\) to \(m\). The preceding line
similarly gives a way of computing the result of adding \(2\) to \(m\).
This process continues all the way down to the base case.
</p>

<p>
From these concrete examples we can now infer the general case of the
recursive rule: <i>S n + m = S (n + m).</i> The crucial idea is that we
have converted the big problem of adding a larger number, <i>S n</i>, to
\(m\) into two smaller problems: first, adding the smaller value \(n\), to
\(m\), and second, taking the successor of the result of that operation.
</p>

<p>
So now, without having even <i>considered</i> writing code, we have the
two rules that we need. It is now straightforward to represent them
in Idris.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">addp</span> (<span style="color: #333333; background-color: #FFFFFF;">mkPair</span>   <span style="color: #333333; background-color: #FFFFFF;">O</span>   <span style="color: #333333; background-color: #FFFFFF;">m</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">m</span>
<span style="color: #333333; background-color: #FFFFFF;">addp</span> (<span style="color: #333333; background-color: #FFFFFF;">mkPair</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">n</span>) <span style="color: #333333; background-color: #FFFFFF;">m</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">addp</span> (<span style="color: #333333; background-color: #FFFFFF;">mkPair</span> <span style="color: #333333; background-color: #FFFFFF;">n</span> <span style="color: #333333; background-color: #FFFFFF;">m</span>))
</pre>
</div>

<p>
The first rule says that we can evaluate any expression of the form
<i>addp O m</i> by returning the result of evaluating the expression, \(m\).
That's the base case. An answer can be given directly, without solving
any subproblems recursively.
</p>

<p>
The second rule is a little more complicated, but can also be
understood in the same way. Let's see how it gives us a result for
the problem, \(2 + 3\). To compute an answer we evaluate the function
application expression, <i>addp (mkPair (S (S O)) (S (S (S O))))</i>.
Let's trace exactly what happens.
</p>

<p>
The expression does not match the left hand side of the first rule,
but it does match with the second, and the process of matching binds
\(n\) to <i>(S O)</i> (one smaller than \(n\)) and \(m\) to <i>S (S (S O))</i>. The
result of the function application is then obtained by evaluating the
right hand side of the rule <i>in the context of these bindings</i>.
</p>

<p>
The right hand side thus becomes <i>S (addp (mkPair (S O) (S (S (S
O)))))</i>.  Again, the overall result is obtained by evaluating this
expression.  But evaluating this expressions requires evaluation of
<i>addp</i> funtion applied to an argument pair with a one-smaller first
element. You can see that this process will continue, and that it will
stop only if a base case is reached. Here's the complete sequence of
intermediate steps.
</p>

<ul class="org-ul">
<li><i>addp (mkPair (S (S O)) (S (S (S O))))</i>    [function application]</li>
<li><i>S (addp (mkPair (S O)  (S (S (S O)))))</i>   [recursive case]</li>
<li><i>S (S (addp (mkPair O   (S (S (S O))))))</i>  [recursive case]</li>
<li><i>S (S                  (S (S (S O))))</i>   [base case; answer!]</li>
</ul>
</div></li></ol></li></ol>
</div>

<div id="outline-container-orgheadline123" class="outline-4">
<h4 id="orgheadline123"><span class="section-number-4">11.2.5</span> equality</h4>
<div class="outline-text-4" id="text-11-2-5">
<p>
We will find it important to be able to compare natural numbers to see
whether one is less than, less than or equal to, equal to, greater
than or equal to, or greather than another. Each of these comparison
operations in a binary operator, taking two natural numbers and
returning a Boolean value indicating whether or not the given property
holds for that pair of numbers. 
</p>

<p>
Here we develop a function for comparing natural numbers for equality.
This function provides a model for developing functions for the less 
than or equal operator. With these two operators in hand, along with 
Boolean operators, the remaining comparison operators can be defined.
</p>

<p>
Being a binary operator, equality comparison takes two natural numbers
as arguments. Each number can be either zero or the successor of some
other natural number. There are thus four cases to consider: both
zero, zero and non-zero, non-zero and zero, and two non-zero numbers
that, in general, are not the same.
</p>

<p>
The first three cases are easy. If both numbers are zero, the result
is true. If one is zero and the other is the successor of some other
number, then the result is false, as zero is not the successor of any
number. 
</p>

<p>
Finally we get to the fourth case, of two numbers, each the successor
of some other number. Let's call these numbers <i>(S n)</i> and <i>(S m)</i>.
The critical observation is that these numbers are equal if and only
if \(m\) and \(n\) are themselves equal! We can thus get an answer to the
original question by resolving this simpler question.
</p>

<p>
We thus now have our set of <i>recursive</i> rules, which we can direclty
translate to Idris.
</p>

<p>
#+BEGIN_SRC idris :exports code
eqp: pair nat nat -&gt; bool
eqp O O = true
eqp O (S n) = false
eqp (S n) O = false
eqp (S n) (S m) = eqp n m
#END_SRC
</p>
</div>
</div>

<div id="outline-container-orgheadline124" class="outline-4">
<h4 id="orgheadline124"><span class="section-number-4">11.2.6</span> Exercises</h4>
<div class="outline-text-4" id="text-11-2-6">
<ul class="org-ul">
<li>Design and implement an Idris function, <i>multp: pair nat nat -&gt; nat</i> that multiplies pairs of natural numbers. Hint: \(O * m = O\) and \((1+n) * m = m + (n * m)\).</li>
<li>Design and implement an Idris function, <i>expp: pair nat nat -&gt; nat</i>  that when given a pair, \((x, n)\) returns \(x^n\).</li>
<li>Design and implement a function for subtraction.</li>
<li>Design and implement a function to compute the n'th Fibonacci number, where (fib O) = O and (fib 1) = 1.</li>
<li>Design and implement the rest of the standard Boolean comparison operators on natural numbers.</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline132" class="outline-2">
<h2 id="orgheadline132"><span class="section-number-2">12</span> A little more Linux</h2>
<div class="outline-text-2" id="text-12">
</div><div id="outline-container-orgheadline128" class="outline-3">
<h3 id="orgheadline128"><span class="section-number-3">12.1</span> running commands as super-user</h3>
<div class="outline-text-3" id="text-12-1">
</div><div id="outline-container-orgheadline127" class="outline-4">
<h4 id="orgheadline127"><span class="section-number-4">12.1.1</span> sudo</h4>
</div>
</div>
<div id="outline-container-orgheadline131" class="outline-3">
<h3 id="orgheadline131"><span class="section-number-3">12.2</span> installing and managing Linix packages</h3>
<div class="outline-text-3" id="text-12-2">
</div><div id="outline-container-orgheadline129" class="outline-4">
<h4 id="orgheadline129"><span class="section-number-4">12.2.1</span> apt-get</h4>
</div>
<div id="outline-container-orgheadline130" class="outline-4">
<h4 id="orgheadline130"><span class="section-number-4">12.2.2</span> dpkg</h4>
</div>
</div>
</div>
<div id="outline-container-orgheadline187" class="outline-2">
<h2 id="orgheadline187"><span class="section-number-2">13</span> Exam 1 Study Guide</h2>
<div class="outline-text-2" id="text-13">
</div><div id="outline-container-orgheadline133" class="outline-3">
<h3 id="orgheadline133"><span class="section-number-3">13.1</span> Basic Linux Commands</h3>
<div class="outline-text-3" id="text-13-1">
<ul class="org-ul">
<li>pwd</li>
<li>mkdir</li>
<li>rmdir</li>
<li>cd</li>
<li>ls</li>
<li>rm</li>
<li>mv</li>
<li>git pull</li>
<li>cat</li>
<li>less</li>
<li>sudo</li>
<li>apt-get install</li>
<li>pipes and filters</li>
<li>I/O redirection</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline162" class="outline-3">
<h3 id="orgheadline162"><span class="section-number-3">13.2</span> ADTs</h3>
<div class="outline-text-3" id="text-13-2">
</div><div id="outline-container-orgheadline136" class="outline-4">
<h4 id="orgheadline136"><span class="section-number-4">13.2.1</span> unit</h4>
<div class="outline-text-4" id="text-13-2-1">
</div><ol class="org-ol"><li><a id="orgheadline134"></a>data type<br  /><div class="outline-text-5" id="text-13-2-1-1">
<p>
data unit = mkUnit
</p>
</div></li>
<li><a id="orgheadline135"></a>functions<br  /><div class="outline-text-5" id="text-13-2-1-2">
<ul class="org-ul">
<li>id_unit: unit -&gt; unit</li>
</ul>
</div></li></ol>
</div>
<div id="outline-container-orgheadline141" class="outline-4">
<h4 id="orgheadline141"><span class="section-number-4">13.2.2</span> bool</h4>
<div class="outline-text-4" id="text-13-2-2">
</div><ol class="org-ol"><li><a id="orgheadline137"></a>data type<br  /><div class="outline-text-5" id="text-13-2-2-1">
<p>
data bool = true | false
</p>
</div></li>
<li><a id="orgheadline140"></a>functions<br  /><ol class="org-ol"><li><a id="orgheadline138"></a>unary<br  /><div class="outline-text-6" id="text-13-2-2-2-1">
<ul class="org-ul">
<li>id_bool: bool -&gt; bool</li>
<li>not: bool -&gt; bool</li>
<li>constFalse: bool -&gt; bool</li>
<li>constTrue: bool -&gt; bool</li>
</ul>
</div></li>
<li><a id="orgheadline139"></a>binary<br  /><div class="outline-text-6" id="text-13-2-2-2-2">
<ul class="org-ul">
<li>andp: pair bool bool -&gt; bool</li>
<li>orp: pair bool bool -&gt; bool</li>
<li>xorp: pair bool bool -&gt; bool</li>
<li>nandp: pair bool bool -&gt; bool</li>
</ul>
</div></li></ol></li></ol>
</div>
<div id="outline-container-orgheadline144" class="outline-4">
<h4 id="orgheadline144"><span class="section-number-4">13.2.3</span> Box a</h4>
<div class="outline-text-4" id="text-13-2-3">
</div><ol class="org-ol"><li><a id="orgheadline142"></a>data type<br  /><div class="outline-text-5" id="text-13-2-3-1">
<p>
data Box a = mkBox a
</p>
</div></li>
<li><a id="orgheadline143"></a>functions<br  /><div class="outline-text-5" id="text-13-2-3-2">
<ul class="org-ul">
<li>unBox: Box a -&gt; a</li>
</ul>
</div></li></ol>
</div>
<div id="outline-container-orgheadline146" class="outline-4">
<h4 id="orgheadline146"><span class="section-number-4">13.2.4</span> option a</h4>
<div class="outline-text-4" id="text-13-2-4">
</div><ol class="org-ol"><li><a id="orgheadline145"></a>data type<br  /><div class="outline-text-5" id="text-13-2-4-1">
<p>
data option a = some a | none
</p>
</div></li></ol>
</div>
<div id="outline-container-orgheadline151" class="outline-4">
<h4 id="orgheadline151"><span class="section-number-4">13.2.5</span> pair a b</h4>
<div class="outline-text-4" id="text-13-2-5">
</div><ol class="org-ol"><li><a id="orgheadline147"></a>data type<br  /><div class="outline-text-5" id="text-13-2-5-1">
<p>
data pair a b = mkPair a b
</p>
</div></li>
<li><a id="orgheadline150"></a>functions<br  /><ol class="org-ol"><li><a id="orgheadline148"></a>fst: pair a b -&gt; a<br  /></li>
<li><a id="orgheadline149"></a>snd: pair a b -&gt; b<br  /></li></ol></li></ol>
</div>
<div id="outline-container-orgheadline156" class="outline-4">
<h4 id="orgheadline156"><span class="section-number-4">13.2.6</span> nat</h4>
<div class="outline-text-4" id="text-13-2-6">
</div><ol class="org-ol"><li><a id="orgheadline152"></a>data type<br  /><div class="outline-text-5" id="text-13-2-6-1">
<p>
data nat = O | S nat
</p>
</div></li>
<li><a id="orgheadline155"></a>functions<br  /><ol class="org-ol"><li><a id="orgheadline153"></a>unary<br  /><div class="outline-text-6" id="text-13-2-6-2-1">
<ul class="org-ul">
<li>isZero: nat -&gt; bool</li>
<li>succ: nat -&gt; nat</li>
<li>pred: nat -&gt; nat</li>
<li>evenb: nat -&gt; bool</li>
<li>oddb: nat -&gt; bool</li>
<li>factorial: nat -&gt; nat</li>
<li>fibonacci: nat -&gt; nat</li>
</ul>
</div></li>
<li><a id="orgheadline154"></a>binary<br  /><div class="outline-text-6" id="text-13-2-6-2-2">
<ul class="org-ul">
<li>addp: pair nat nat -&gt; nat</li>
<li>multp: pair nat nat -&gt; nat</li>
<li>expp: pair nat nat -&gt; nat</li>
</ul>
</div></li></ol></li></ol>
</div>
<div id="outline-container-orgheadline161" class="outline-4">
<h4 id="orgheadline161"><span class="section-number-4">13.2.7</span> list a</h4>
<div class="outline-text-4" id="text-13-2-7">
</div><ol class="org-ol"><li><a id="orgheadline157"></a>data type<br  /><div class="outline-text-5" id="text-13-2-7-1">
<p>
data list_nat = nil | cons nat list_nat
</p>
</div></li>
<li><a id="orgheadline160"></a>functions<br  /><ol class="org-ol"><li><a id="orgheadline158"></a>unary<br  /><div class="outline-text-6" id="text-13-2-7-2-1">
<ul class="org-ul">
<li>isEmpty: list_nat -&gt; bool</li>
<li>length: list_nat -&gt; nat</li>
</ul>
</div></li>
<li><a id="orgheadline159"></a>binary<br  /><div class="outline-text-6" id="text-13-2-7-2-2">
<ul class="org-ul">
<li>append: pair list_nat list_nat -&gt; list_nat</li>
</ul>
</div></li></ol></li></ol>
</div>
</div>

<div id="outline-container-orgheadline186" class="outline-3">
<h3 id="orgheadline186"><span class="section-number-3">13.3</span> Mechanisms</h3>
<div class="outline-text-3" id="text-13-3">
</div><div id="outline-container-orgheadline165" class="outline-4">
<h4 id="orgheadline165"><span class="section-number-4">13.3.1</span> types and values</h4>
<div class="outline-text-4" id="text-13-3-1">
</div><ol class="org-ol"><li><a id="orgheadline163"></a>data types and values<br  /></li>
<li><a id="orgheadline164"></a>function types and values<br  /></li></ol>
</div>
<div id="outline-container-orgheadline174" class="outline-4">
<h4 id="orgheadline174"><span class="section-number-4">13.3.2</span> inductive data type definitions</h4>
<div class="outline-text-4" id="text-13-3-2">
</div><ol class="org-ol"><li><a id="orgheadline166"></a>declaring data types<br  /></li>
<li><a id="orgheadline169"></a>defining value constructors<br  /><ol class="org-ol"><li><a id="orgheadline167"></a>without parameters<br  /></li>
<li><a id="orgheadline168"></a>with parameters<br  /></li></ol></li>
<li><a id="orgheadline173"></a>polymorphic data type definitions<br  /><ol class="org-ol"><li><a id="orgheadline170"></a>declaring type parameters<br  /></li>
<li><a id="orgheadline171"></a>defining polymorphic value constructors<br  /></li>
<li><a id="orgheadline172"></a>the concept of "type constructors"<br  /></li></ol></li></ol>
</div>
<div id="outline-container-orgheadline177" class="outline-4">
<h4 id="orgheadline177"><span class="section-number-4">13.3.3</span> binding of names to values</h4>
<div class="outline-text-4" id="text-13-3-3">
</div><ol class="org-ol"><li><a id="orgheadline175"></a>type declarations<br  /><div class="outline-text-5" id="text-13-3-3-1">
<ul class="org-ul">
<li>e.g., x: nat</li>
</ul>
</div></li>
<li><a id="orgheadline176"></a>value definitions<br  /><div class="outline-text-5" id="text-13-3-3-2">
<ul class="org-ul">
<li>e.g., x = (S O)</li>
</ul>
</div></li></ol>
</div>
<div id="outline-container-orgheadline180" class="outline-4">
<h4 id="orgheadline180"><span class="section-number-4">13.3.4</span> pattern matching &amp; unification</h4>
<div class="outline-text-4" id="text-13-3-4">
</div><ol class="org-ol"><li><a id="orgheadline178"></a>non-recursive function definitions<br  /></li>
<li><a id="orgheadline179"></a>recursive function definitions<br  /></li></ol>
</div>
<div id="outline-container-orgheadline185" class="outline-4">
<h4 id="orgheadline185"><span class="section-number-4">13.3.5</span> expression evaluation</h4>
<div class="outline-text-4" id="text-13-3-5">
</div><ol class="org-ol"><li><a id="orgheadline181"></a>literal expressions<br  /></li>
<li><a id="orgheadline182"></a>variable expressions<br  /></li>
<li><a id="orgheadline183"></a>function application expressions<br  /></li>
<li><a id="orgheadline184"></a>recursive function evaluation, in particular<br  /><div class="outline-text-5" id="text-13-3-5-4">
<p>
O
</p>


<p>
<code>==</code>
</p>
</div></li></ol>
</div>
</div>
</div>
<div id="outline-container-orgheadline197" class="outline-2">
<h2 id="orgheadline197"><span class="section-number-2">14</span> Partial Evaluation</h2>
<div class="outline-text-2" id="text-14">
</div><div id="outline-container-orgheadline188" class="outline-3">
<h3 id="orgheadline188"><span class="section-number-3">14.1</span> Review of unary Boolean functions</h3>
<div class="outline-text-3" id="text-14-1">
<p>
A unary operator takes one argument of a given type, computes with it,
and returns a result. When the argument type is Boolean, there are
only two possible argument values: true and false. To completely
specify a unary Boolean function, it therefore suffices to specify
what value is returned for each of these two argument values. 
</p>

<p>
One can depict Boolean functions graphically as two-by-two <i>truth
tables</i>. The two possible argument values, <i>true</i> and <i>false</i>, are
listed in the first column (labelled <i>b1</i> here).  The results are
listed to the right. 
</p>

<p>
When the result type is also Boolean, there are only four possible
ways to fill in the result column: 
</p>
<ul class="org-ul">
<li><i>true true</i></li>
<li><i>true false</i></li>
<li><i>false true</i></li>
<li><i>false false</i></li>
</ul>

<p>
We have implemented these functions with the names, <i>constTrue</i>,
<i>id_bool</i>, <i>not</i>, and <i>constFalse</i>, respectively. Here's a truth table
for the <i>not</i> function, for example, with the argument values in the
<i>b1</i> column and the corresponding results to the right.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">b1</th>
<th scope="col" class="org-left">result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">T</td>
<td class="org-left">F</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">F</td>
<td class="org-left">T</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline194" class="outline-3">
<h3 id="orgheadline194"><span class="section-number-3">14.2</span> Review of binary Boolean functions</h3>
<div class="outline-text-3" id="text-14-2">
</div><div id="outline-container-orgheadline189" class="outline-4">
<h4 id="orgheadline189"><span class="section-number-4">14.2.1</span> Number of binary Boolean functions</h4>
<div class="outline-text-4" id="text-14-2-1">
<p>
A binary function takes two arguments and returns a result. We have
implemented some, but not all, of the binary Boolean functions. 
</p>

<p>
As with unary functions, the binary Boolean functions can also be
depicted graphically using truth tables. In the first column are the
two possible values for the first argument. In the second column are
the possible values of the second argument, repeated for each possible
value of the first argument. The four rows thus give all four possible
pairs of values for the two arguments. The right column gives results.
Here, for example, is the <i>truth table</i> for the <i>and</i> function.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">b1</th>
<th scope="col" class="org-left">b2</th>
<th scope="col" class="org-left">result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">T</td>
<td class="org-left">T</td>
<td class="org-left">T</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">T</td>
<td class="org-left">F</td>
<td class="org-left">F</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">F</td>
<td class="org-left">T</td>
<td class="org-left">F</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">F</td>
<td class="org-left">F</td>
<td class="org-left">F</td>
</tr>
</tbody>
</table>

<p>
One such table specifies a single binary Boolean function. How many
different ways are there to fill in the four Boolean values in the
result column in the truth table for a Boolean function?
</p>
</div>
</div>

<div id="outline-container-orgheadline193" class="outline-4">
<h4 id="orgheadline193"><span class="section-number-4">14.2.2</span> Truth tables for most important ones</h4>
<div class="outline-text-4" id="text-14-2-2">
<p>
The
remainder of this page gives correct truth tables for <i>or</i>, <i>xor</i>, and
<i>nand</i>. Be sure to save your work.
</p>
</div>

<ol class="org-ol"><li><a id="orgheadline190"></a>or<br  /><div class="outline-text-5" id="text-14-2-2-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">b1</th>
<th scope="col" class="org-left">b2</th>
<th scope="col" class="org-left">result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">T</td>
<td class="org-left">T</td>
<td class="org-left">T</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">T</td>
<td class="org-left">F</td>
<td class="org-left">T</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">F</td>
<td class="org-left">T</td>
<td class="org-left">T</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">F</td>
<td class="org-left">F</td>
<td class="org-left">F</td>
</tr>
</tbody>
</table>
</div></li>

<li><a id="orgheadline191"></a>xor (exclusive or)<br  /><div class="outline-text-5" id="text-14-2-2-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">b1</th>
<th scope="col" class="org-left">b2</th>
<th scope="col" class="org-left">result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">T</td>
<td class="org-left">T</td>
<td class="org-left">F</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">T</td>
<td class="org-left">F</td>
<td class="org-left">T</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">F</td>
<td class="org-left">T</td>
<td class="org-left">T</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">F</td>
<td class="org-left">F</td>
<td class="org-left">F</td>
</tr>
</tbody>
</table>
</div></li>

<li><a id="orgheadline192"></a><i>nand</i> (not and)<br  /><div class="outline-text-5" id="text-14-2-2-3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">b1</th>
<th scope="col" class="org-left">b2</th>
<th scope="col" class="org-left">result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">T</td>
<td class="org-left">T</td>
<td class="org-left">F</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">T</td>
<td class="org-left">F</td>
<td class="org-left">T</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">F</td>
<td class="org-left">T</td>
<td class="org-left">T</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">F</td>
<td class="org-left">F</td>
<td class="org-left">T</td>
</tr>
</tbody>
</table>
</div></li></ol>
</div>
</div>

<div id="outline-container-orgheadline196" class="outline-3">
<h3 id="orgheadline196"><span class="section-number-3">14.3</span> Formulating binary operations in a new way</h3>
<div class="outline-text-3" id="text-14-3">
<p>
Write the truth table for the <i>and</i> operation on a piece of paper.
Note how it breaks in half horizontally. The top half indicates the
behavior of the function when the first argument, <i>b1</i>, is <i>true</i>.
Make a dark line to separate the top and bottom halves to better see
what's going on. The bottom half indicates the behavior of the
function when <i>b1</i> argument is <i>false</i>.
</p>

<p>
Now look at the top half only. You can now break it into two parts
vertically. The first column indicates the choice of <i>true</i> for the
first parameter. The rest of the table to the right&#x2014;the <i>b2</i> and
<i>result</i> columns&#x2014;can now be seen as a truth table for one of the
<i>unary</i> functions! Make a dark line indicating this separation. Now
look at the smaller truth table in the upper right! Can you see what
unary function it is? That's right, it's the <i>id</i> function! Here's
the truth table you should be seeing. 
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">b2</th>
<th scope="col" class="org-left">result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">T</td>
<td class="org-left">T</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">F</td>
<td class="org-left">F</td>
</tr>
</tbody>
</table>

<p>
In other words, when the first argument is to the binary <i>and</i> is
<i>true</i> you can apply the unary <i>id_bool</i> function to the second
argument to compute the correct result for <i>and</i>.
</p>

<p>
Similarly, if you look at the bottom half of the truth table for
<i>and</i>, you will find that it splits in the same way. In the <i>b1</i>
column, we have a choice of <i>false</i> for the first parameter, and to
the right&#x2014;in the <i>b2</i> and <i>result</i> columns&#x2014;we see a truth table
for a different <i>unary</i> function. Which one is it? Right:
<i>constFalse</i>!  In other words, when the first argument to <i>and</i> is
<i>false</i> you can apply the unary <i>constFalse</i> function to the second
argument to compute the correct result for <i>and</i>.
</p>

<p>
This observation leads to a new way of seeing the binary functions: as
<i>unary</i> functions that take a Boolean value, <i>b1</i>, as an argument and
that return an associated unary function, of type \(bool \to bool\), as
a result! For the <i>and</i> function, when <i>b1</i> is <i>true</i>, the result is
<i>id_bool</i>, and when <i>b1</i> is false, the result is <i>constFalse</i>. Here's
a table representing the <i>and</i> function represented in this way. We'll
call this function <i>pand</i> (short for <i>partial and</i>, in that it gets us
only part way to an answer).
</p>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">b1</th>
<th scope="col" class="org-left">result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">T</td>
<td class="org-left">id_bool</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">F</td>
<td class="org-left">constFalse</td>
</tr>
</tbody>
</table>

<p>
Note again, <i>pand</i> does not return a Boolean, but rather a function
from Boolean to Boolean. The signature of <i>pand</i> is thus \(bool \to
(bool \to bool)\). That is, it takes a <i>bool</i> and returns a (unary)
function of type <i>bool -&gt; bool</i>.  In Idris and most similar languages,
the \(\to\) operator (on types) is what we call <i>right associative</i>, so
\(bool \to (bool \to bool)\) can be written as \(bool \to bool \to bool\).
</p>

<p>
Again, make sure that you see it: applying <i>pand</i> to, say, <i>true</i>,
returns a <i>function</i>. So, for example, the expression <i>pand true</i>
returns the \(id_bool\) function.  This returned function can then be
applied to another Boolean value to compute a final Boolean result.
This expression, <i>(pand true) false</i>, would thus evaluate <i>pand true</i>
to obtain <i>id_bool</i> which would then be applied to <i>false</i> to yield
<i>false</i>, which is the right answer.
</p>

<p>
Try it out in your REPL. Note also that in Idris and most similar
languages, function application is <i>left</i> associative, so <i>(pand true)
false</i> can be written more simply as <i>pand true false</i>. It beats
having to type in all those <i>mkPairs</i>!
</p>
</div>

<div id="outline-container-orgheadline195" class="outline-4">
<h4 id="orgheadline195"><span class="section-number-4">14.3.1</span> Exercises</h4>
<div class="outline-text-4" id="text-14-3-1">
<p>
<b>Problem #1:</b> Open your bool.idr file in an editor and verify the
names, and the correctness, of your unary Boolean functions. Verify
correctness by carefully inspecting your code. You may test it as
well, if you wish, in the REPL.
</p>

<p>
<b>Problem #2:</b> Add a statement in a comment block in your bool.idr 
file stating, "Exam Problem #2: There are <span class="underline">__</span> possible ways to fill
in the result column for a truth table for a binary Boolean function,
and there are thus exactly <span class="underline">__</span> such functions, and no more." Fill in
the right answer(s) in the blanks, of course.
</p>

<p>
<b>Problem #3:</b> Carefully verify the correctness of your implementations
of the binary Boolean functions that we've implemented. Correct your
code if necessary. We've given the truth table for <i>and</i> above. 
</p>

<p>
<b>Problem #4a:</b> At the end of your bool.idr file, implement this <i>pand</i>
function as specified in the preceding table. What, you ask? Can a
function really return another function as a result? The answer is
yes.  Just return the required unary operations by name.
</p>

<p>
<b>Problem #4b,c,d:</b> Analyze the <i>or</i>, <i>xor</i>, and <i>nand</i> functions in the
same way, and provide Idris implementations of these functions in this
style, as well. Call the new functions <i>por</i>, <i>pxor</i>, and <i>pnand</i>.
Note: the types of these functions will all be \(bool \to bool \to
bool\).
</p>

<p>
Verify correctness of your new functions
</p>

<p>
<b>Problem #5:</b> Edit your boolTest.idr file. Add four tests for each new
function, one test for each pair of Boolean values.  In your REPL
verify that you are getting results consistent with those that you
should be getting from your previous (and possibly corrected)
implementations of <i>andp</i>, <i>orp</i>, <i>xorp</i>, and <i>nandp</i>.
</p>

<p>
Each test should look like this:
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">pand_t_t</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
<span style="color: #333333; background-color: #FFFFFF;">pand_t_t</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">pand</span> <span style="color: #333333; background-color: #FFFFFF;">true</span> <span style="color: #333333; background-color: #FFFFFF;">true</span>
<span style="color: #8D8D84; font-style: italic;">-- expect true</span>
</pre>
</div>

<p>
[NOTE: The preceding code sometimes renders incorrectly in HTML. There
should be underscores before each <i>t</i> after <i>pand</i> in both the first
and second line of code.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline206" class="outline-2">
<h2 id="orgheadline206"><span class="section-number-2">15</span> Type Inference</h2>
<div class="outline-text-2" id="text-15">
<p>
As we have already seen, Idris supports polymorphic types.  Examples
of such types so far include <i>Box a</i>, <i>option a</i>, and <i>pair a b</i>. You
will recall <i>Box, option</i> and <i>pair</i> are known as <i>type constructors</i>.
Each takes one or more types as arguments and in turn yields a type as
a result. 
</p>

<p>
Consider our polymorphic <i>Box</i> abstract data type as an example.
Here's the code. 
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">module</span> <span style="color: #333333; background-color: #FFFFFF;">Box</span>

<span style="color: #8D8D84;">|||</span><span style="color: #036A07;"> a polymorphic box type</span>
<span style="color: #0000FF;">data</span> <span style="color: #333333; background-color: #FFFFFF;">Box</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mkBox</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>

<span style="color: #8D8D84;">|||</span><span style="color: #036A07;"> return the value in a given box</span>
<span style="color: #333333; background-color: #FFFFFF;">unbox</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Box</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>
<span style="color: #333333; background-color: #FFFFFF;">unbox</span> (<span style="color: #333333; background-color: #FFFFFF;">mkBox</span> <span style="color: #333333; background-color: #FFFFFF;">v</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">v</span>
</pre>
</div>

<p>
This code defines <i>Box</i> as a type constructor that takes one <i>type</i>,
such as <i>nat</i> or <i>bool</i>, as an argument, <i>a</i>. The result of applying
<i>Box</i> to any type, such as <i>nat</i>, is then a <i>type</i>, in this case <i>Box
nat</i>. As you will recall, the type of <i>Box</i> itself is thus \(Type \to
Type\).
</p>

<p>
The <i>Box</i> type constructor provides one <i>value constructor</i>, namely
<i>mkBox a</i>. It takes as a parameter a <i>value</i> of type <i>a</i> and yields a
term of type <i>Box a</i>. The following code gives an example in which a
name, <i>x</i>, is bound to a value of type <i>Box nat</i>, specifically to the
value <i>mkBox (S O)</i>. We think of this as a box containing a one.
</p>


<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">x</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Box</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">x</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mkBox</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>)
</pre>
</div>
</div>

<div id="outline-container-orgheadline198" class="outline-3">
<h3 id="orgheadline198"><span class="section-number-3">15.1</span> Inferring implicit types</h3>
<div class="outline-text-3" id="text-15-1">
<p>
The interesting and important point of this chapter is, that in most
cases, Idris is able to <i>infer</i> the type <i>a</i> in expressions involving
polymorphic types. Consider the term, <i>mkBox (S O)</i>. What is its type?
Idris knows that <i>mkBox</i> takes a value of type <i>a</i> for some type, <i>a</i>,
but what is <i>a</i> in this case? Idris determines <i>a</i> by looking at the
argument, <i>(S O)</i>. It is of type <i>nat</i>, so Idris <i>infers</i> that <i>a</i>
must be <i>nat</i> and the type of the term, <i>mkBox (S O)</i>, must therefore
be <i>Box nat</i>. We say that the value of the the type argument to <i>Box</i>,
is <i>implicit</i> in the term, <i>mkBox (S O)</i>, and that Idris uses <i>type
inference</i> to determine that <i>a = nat</i>.  Similarly, if the term had
been <i>mkBox false</i>, then Idris would have inferred that <i>a = bool</i> and
that the type of the term is <i>Box bool</i>. In this case, of course, the
term would not typecheck as a value for <i>x</i>.
</p>
</div>
</div>

<div id="outline-container-orgheadline204" class="outline-3">
<h3 id="orgheadline204"><span class="section-number-3">15.2</span> When type inference fails</h3>
<div class="outline-text-3" id="text-15-2">
<p>
There are cases where Idris does not have enough <i>context</i> to infer
what the value of a type parameter is. A simple example occurs when
Idris tries to determine the type of an empty list. This brings us to
the next fundamental abstract data type that we study in this book:
namely polymorphic lists. 
</p>

<p>
Examples of lists include lists of natural numbers, such as \([1, 2,
3]\), \([]\) (an empty list of natural numbrs), and lists of Boolean
values, such as \([true,false]\) and \([]\) (the empty list of Boolean
values). You can already see the problem: it is easy to see that
\([true,false]\) is a list of Booleans, but what is the type of \([]\)?
</p>
</div>

<div id="outline-container-orgheadline201" class="outline-4">
<h4 id="orgheadline201"><span class="section-number-4">15.2.1</span> A polymorphic list abstract data type</h4>
<div class="outline-text-4" id="text-15-2-1">
<p>
To make the point precise, we now introduce code for a polymorphic
list type.
</p>


<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">module</span> <span style="color: #333333; background-color: #FFFFFF;">list</span>

<span style="color: #8D8D84;">|||</span><span style="color: #036A07;"> a polymorphic list data type</span>
<span style="color: #0000FF;">data</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span> <span style="color: #BA36A5;">|</span> <span style="color: #333333; background-color: #FFFFFF;">cons</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> (<span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>)

<span style="color: #8D8D84;">|||</span><span style="color: #036A07;"> return the length of a given list</span>
<span style="color: #333333; background-color: #FFFFFF;">length</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">length</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>
<span style="color: #333333; background-color: #FFFFFF;">length</span> (<span style="color: #333333; background-color: #FFFFFF;">cons</span> <span style="color: #333333; background-color: #FFFFFF;">head</span> <span style="color: #333333; background-color: #FFFFFF;">tail</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">length</span> <span style="color: #333333; background-color: #FFFFFF;">tail</span>)
</pre>
</div>
</div>

<ol class="org-ol"><li><a id="orgheadline199"></a>The polymorphic list data type<br  /><div class="outline-text-5" id="text-15-2-1-1">
<p>
This code defines <i>list</i> as a type constructor. It takes with one type
argument, <i>a</i>, representing the type of elements in a list. With such
a type constructor, we can thus define types such as <i>list nat</i> and
<i>list bool</i>, the type of lists of natural numbers and the type of
lists of Boolean values, respectively. 
</p>

<p>
The definition also provides defines two value constructors. The
first, <i>nil</i>, constructs the term <i>nil</i>, which we will interpret as
representing the empty list of values of type <i>a</i>. We can thus bind
names to an empty list of <i>bool</i> and an empty list of <i>nat</i> like this:
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">lb</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
<span style="color: #333333; background-color: #FFFFFF;">lb</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span>

<span style="color: #333333; background-color: #FFFFFF;">ln</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">ln</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span>
</pre>
</div>

<p>
Idris has no problem disambiguating the types of the two different
<i>nil</i> expressions here, because there's enough context to indicate
what the values of <i>a</i> must be. For example, <i>lb</i> is declared to be
bound to a list of <i>bool</i>, so the first nil <i>must</i> be of type <i>list
bool</i>. That is, <i>a = bool</i> in the first case. Similarly, it must be
the case that <i>a = nat</i> in the second case.
</p>

<p>
The second value constructor, simply called <i>cons</i>, requires a little
more mental effort to fully appreciate. It enables one to construct a
new term of type <i>list a</i> by applying <i>cons</i> to two arguments: first, 
a <i>value</i> of type <i>a</i>, which we interpret as the <i>head</i> (or leftmost)
element of the new list, and second, a <i>value</i> of type <i>list a</i>, which
we interpret as being the list constituting the tail, or the rest, of
the new list. The tail, being of type <i>list a</i>, can itself be either
<i>nil</i>, or a non-empty list constructed in the same way as the larger
list, using <i>cons</i>, and thus having an element of type <i>a</i> along with
an even smaller list as a tail.
</p>

<p>
We have already seen exampels of empty lists constructed using <i>nil</i>.
Here are examples showing how one can construct longer lists (in this
case of natural numbers).
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #8D8D84; font-style: italic;">-- empty list of nat</span>
<span style="color: #333333; background-color: #FFFFFF;">l0</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">l0</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span>

<span style="color: #8D8D84; font-style: italic;">-- the list [0]</span>
<span style="color: #333333; background-color: #FFFFFF;">l1</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">l1</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">cons</span> <span style="color: #333333; background-color: #FFFFFF;">O</span> <span style="color: #333333; background-color: #FFFFFF;">l0</span>

<span style="color: #8D8D84; font-style: italic;">-- the list [0, 1]</span>
<span style="color: #333333; background-color: #FFFFFF;">l2</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">l2</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">cons</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>) <span style="color: #333333; background-color: #FFFFFF;">l1</span>

<span style="color: #8D8D84; font-style: italic;">-- the list [0, 1, 2]</span>
<span style="color: #333333; background-color: #FFFFFF;">l3</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">l3</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">cons</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>)) <span style="color: #333333; background-color: #FFFFFF;">l2</span>

<span style="color: #8D8D84; font-style: italic;">-- the same list, [0, 1, 2]</span>
<span style="color: #333333; background-color: #FFFFFF;">l3'</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">l3'</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">cons</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>)) (<span style="color: #333333; background-color: #FFFFFF;">cons</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>) (<span style="color: #333333; background-color: #FFFFFF;">cons</span> <span style="color: #333333; background-color: #FFFFFF;">O</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span>))
</pre>
</div>
</div></li>

<li><a id="orgheadline200"></a>A polymorphic list length function<br  /><div class="outline-text-5" id="text-15-2-1-2">
<p>
Finally, our simple list data type defines a function for computing
the length of any give value of type <i>list a</i>, for any type, <i>a</i>. The
function is itself polymorphic in that it can handle values of type
<i>list nat</i>, <i>list bool</i>, <i>list (list nat)</i>, or lists of any other type
whatsoever.
</p>

<p>
The function is defined recursively. There is one rule for each of the
two ways that a list can be constructed: i.e., using either the <i>nil</i>
or <i>cons</i> constructor. There are no other possibilities. The first
rule states that the length of an empty list, <i>nil</i>, is zero. The type
argument, <i>a</i>, is implicit. The second rule defines the length of a
non-empty list, <i>cons head tail</i>, where <i>head</i> is a list element (of
type <i>a</i>) and <i>tail</i> is the rest of the list (of type <i>list a</i>). It
states that the length of such a list is one more than the length of
the tail.
</p>

<p>
To see how these definitions work, you should do a stepwise evaluation
of a few function application expressions using <i>length</i>. To start,
consider <i>length l0</i>. The first step is to evaluate <i>l0</i>. This step
reduces the expression to <i>length nil</i>, with <i>a = nat</i> implicit. The
function application term now matches the first rule and reduces to
<i>O</i>. 
</p>

<p>
Now consider <i>length l1</i>. Evaluating <i>l1</i> reduces the expression to
<i>length cons O l0</i>. This matches the second rule with <i>head = O</i> and
<i>tail = l0</i>. The expression thus reduces to <i>S (length l0)</i>. The next
step is to reduce the expression <i>length l0</i>, which we We have already
seen reduces to <i>O</i> by matching with the first rule (the base case of
the recursion). So the overall expression evalutes to <i>S O</i>, i.e., to
one, which is the length of list, <i>l1</i>.
</p>

<p>
Similarly <i>length l2</i> first reduces to <i>length (cons (S O) l1</i>. This
expression unifies with the second rule with <i>h = (S O)</i> and <i>tail =
l1</i>. It then reduces to <i>S (length l1)</i>. The term <i>length l1</i> reduces
by recursive application of <i>length</i> to (S O), so the overall result
is <i>S (S O))</i>.
</p>

<p>
Finally, to drive the point home, consider the evaluation of the
function application <i>length l3'/. First /l3'/ is replaced by its
value, /cons (S (S )) (cons (S O) (cons O nil))</i>. We then evaluate
<i>length cons (S (S )) (cons (S O) (cons O nil))</i>. This expression
mathes the second rule with <i>head = (S (S O))</i> and <i>tail = (cons (S O)
(cons O nil))</i>. Be absolutely sure that you understand how this
pattern matching is working! 
</p>

<p>
The result thus reduces to <i>S (length (cons (S O) (cons O nil)))</i>.
The recursive application of <i>length</i> again matches the second rule,
but now with <i>head = (S O)</i> and <i>tail = (cons O nil)</i>. It reduces to
<i>S (length (cons O nil))</i> and so the whole expression is reduced to <i>S
(S (length (cons O nil)))</i>. The inner length expression once again
matches the second rule, now with <i>head = O</i> and <i>tail = nil</i>, and
thus reduces to <i>S (length nil)</i>. The entire expression has thus now
reduced to <i>S (S (S (length nil)))</i>. Finally the inner length
expression reduces to <i>O</i>, as we have seen, so the orginaly expression
is finally reduced to <i>S (S (S O))</i>, which is to say to three, which
is the length of the list. Note that as we do not use the value of
<i>head</i> on the right side of the rule, we could have used underscore in
place of <i>head</i>, leading to slightly more readable code.
</p>
</div></li></ol>
</div>

<div id="outline-container-orgheadline202" class="outline-4">
<h4 id="orgheadline202"><span class="section-number-4">15.2.2</span> Insufficient context for type inference</h4>
<div class="outline-text-4" id="text-15-2-2">
<p>
We are now at the point where we can write Idris code that exhibits
the problem that we saw informally at the beginning of this chapter.
Consider this:
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">n</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">n</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">length</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span>
</pre>
</div>

<p>
What type of list is <i>nil</i> in this example? It is an empty list of
<i>bool</i>? An empty list of <i>nat</i>? An empty list of some other type?  The
point is that Idris simply does not have enought context to be able to
infer the value of the implicit type parameter <i>a</i>, and so it cannot
determine what the type of <i>nil</i> must be. In this case, Idris will
issue an error indicating this situation.
</p>
</div>
</div>

<div id="outline-container-orgheadline203" class="outline-4">
<h4 id="orgheadline203"><span class="section-number-4">15.2.3</span> The solution to the problem: making implicit arguments explicit</h4>
<div class="outline-text-4" id="text-15-2-3">
<p>
In such cases, which do arise in practice, albeit usually pretty
rarely, it is necessary to provide Idris with the information that it
needs. That is done using what we might call a type hint. A type hint
is enclosed in curly braces and explicitly binds a type to the name
whose type value cannot otherwise be inferred. Here's the code.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">n</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">n</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">length</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span> { <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span> }
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline205" class="outline-3">
<h3 id="orgheadline205"><span class="section-number-3">15.3</span> Summary</h3>
<div class="outline-text-3" id="text-15-3">
<p>
In this chapter, we further explored the nature and uses of
polymorphic types. In particular, we explored the concept of type
inference. We saw that it usually works without our having to think
much about it, but that in some cases, the compiler lacks sufficient
context to determine the values of implicit type arguments. In such
cases, we must provide them explicitly.
</p>

<p>
As an example to make clear where and how such problems can arise, we
introduced our next fundamental abstract data type, and one of the
most important of all data types, the polymorphic <i>list</i> type. We saw
how the type is defined inductively, and we saw how we can define
recursive functions to process values of this type with just two
rules, one for each of the two possible forms of a list.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline211" class="outline-2">
<h2 id="orgheadline211"><span class="section-number-2">16</span> Infix Operators</h2>
<div class="outline-text-2" id="text-16">
<p>
In this chapter we introduce the first of two notational mechanisms
that make it easier to write code. We introduce <i>infix</i> operators. In
particular, we will see a way to write lists like this <i>0::1::2::nil</i>,
rather than like this <i>cons 0 (cons 1 (cons 2 nil))</i>. We will also see
how to use <i>++</i> as a list append operator, so that we can write
<i>(0::1::2::3::nil) ++ (4::5::nil)</i> instead of writing <i>append</i> before
the two list arguments. Infix operators sometimes make code easier to
write as well as to read.
</p>
</div>

<div id="outline-container-orgheadline207" class="outline-3">
<h3 id="orgheadline207"><span class="section-number-3">16.1</span> Prefix and Infix Operator</h3>
<div class="outline-text-3" id="text-16-1">
<p>
So far we have always used what we call <i>prefix</i> notation when
applying binary functions to their arguments. That is, we write the
operators <i>before</i> writing their operands (thus <i>pre</i>)   For example,
to compute the sum of one and two using our <i>nat</i> data type, we would
write <i>(plus (S O) (S (S O)))</i>. The operator (function), <i>plus</i>, is
written before the operands (arguments), <i>(S O)</i> (one) and <i>S (S O)</i>
(two).
</p>

<p>
By contrast, in elemenary school we learned arithmetic using what we
call <i>infix</i> notation, in which we write binary operators in between
their operands. Using infix notation, we would write the sum of one
and two as <i>1 plus 2</i>, or using a more conventional notation for the
name of the <i>plus</i> function, simply <i>1 + 2</i>. 
</p>

<p>
The choice between prefix and infix notation doesn't change the
meanings of. Both <i>plus (S O) (S (S O))</i> and <i>1 + 2</i> mean the same
thing: application of the addition function to values, one and two.
</p>

<p>
In one important respect, however, the use of infix notations presents
several complications. Consider the following two expressions, written
using ordinary arithmetic notation: \(7 - 4 - 3\) and (5 + 2 * 3). 
</p>
</div>
</div>

<div id="outline-container-orgheadline208" class="outline-3">
<h3 id="orgheadline208"><span class="section-number-3">16.2</span> Associativity</h3>
<div class="outline-text-3" id="text-16-2">
<p>
If we parse the first expression as \(7 - (4 - 3)\) then the meaning of
the expression is \(6\). If we read it as \((7 - 4) - 3\), the meaning is
\(0\). So, which is it? Unless we agree on whether to group (associate)
elements from the left or from the right, the meaning is ambiguous.
</p>

<p>
Note that no ambiguity arises when we use prefix notation. The first
expression above is <i>minus 7 (minus 4 3)</i>. The second is <i>minus (minus
7 4) 3</i>. The two expressions are completely distinct and there can be
no confusion as to meanings.
</p>

<p>
To resolve the ambiguity with prefix notation, we have to agree on a
convention&#x2014;a shared understanding. The convention in arithmetic is
to group expressions involving plus, minus, times, and divide from the
left, and exponentiation, from the right associative. Thus \(2^2^2^2\)
does not mean \(((2^2)^2)^2)\), or $16^2 = \(256\), but \(2^(2^(2^2))\), or
\(2^16 = 65536\).
</p>

<p>
We say that the usual four arithmetic operators, (\(+, *, -, /\)), are
<i>left associative</i> (by convention).  Exponentiation, by contrast, is
<i>right associative</i>.
</p>
</div>
</div>

<div id="outline-container-orgheadline209" class="outline-3">
<h3 id="orgheadline209"><span class="section-number-3">16.3</span> Precedence</h3>
<div class="outline-text-3" id="text-16-3">
<p>
What about the second expression? What does \(5 + 2 * 3\) mean?  If we
group from the left we get $(5 + 2) * 3*, which is \(21\). But of course
we know that that is wrong. The usual rules for <i>order of operations</i>
dictates that we perform multiplications before additions. We say that
multiplication has higher <i>precedence</i> than addition. What this means
is that, unless otherwise indicated by parenthesis, we reduce products
before reducing sums. The expression is thus properly interpreted as
\(5 + (2 * 3)\), or \(11\).
</p>
</div>
</div>

<div id="outline-container-orgheadline210" class="outline-3">
<h3 id="orgheadline210"><span class="section-number-3">16.4</span> Infix operators in Idris</h3>
<div class="outline-text-3" id="text-16-4">
<p>
When specifying an infix operator, we need to specify its name as well
as its associativity and precedence characteristics. And whereas we
often use words, such as <i>plus</i>, in prefix notation, we often use
mathematical symbols, such as <i>+</i>, <i>++</i>, <i>::</i>, and the like, as names
for functions when we intend to use infix notation. 
</p>

<p>
As an example, here is a modified definition of our polymorphic list
type, using an infix <i>::</i> operator instead of a prefix <i>cons</i> operator
as the second list constructor.
</p>


<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">module</span> <span style="color: #333333; background-color: #FFFFFF;">list</span>

<span style="color: #0000FF;">infixr</span> 7 (<span style="color: #BA36A5;">::</span>)

<span style="color: #8D8D84;">|||</span><span style="color: #036A07;"> a polymorphic list data type</span>
<span style="color: #0000FF;">data</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span> <span style="color: #BA36A5;">|</span> (<span style="color: #BA36A5;">::</span>) <span style="color: #333333; background-color: #FFFFFF;">a</span> (<span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>)

<span style="color: #8D8D84;">|||</span><span style="color: #036A07;"> return the length of a given list</span>
<span style="color: #333333; background-color: #FFFFFF;">length</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">length</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>
<span style="color: #333333; background-color: #FFFFFF;">length</span> (<span style="color: #333333; background-color: #FFFFFF;">head</span><span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">tail</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">length</span> <span style="color: #333333; background-color: #FFFFFF;">tail</span>)
</pre>
</div>

<p>
The line <i>infixr 7 (::)</i> indicates that we are going to define a
symbol that will be use in infix position (thus <i>infix</i>), that it will
associate to the right (thus the <i>r</i> in <i>infixr</i>), that it will have
precedence <i>7</i> (which will be meaningful if an when it is used in an
expression with operators having other precedence levels), and that
the name of the operator will be <i>::</i>.
</p>

<p>
With these rules established <i>::</i>, we now use <i>::</i> in place of <i>cons.</i>
The first place this happens is in the constructor, where the <i>::</i> is
still used in <i>prefix</i> position. In the remainder of the code, it is
used in infix position. In particular, the second rule for <i>length</i>
matches <i>head::tail</i> instead of <i>cons head tail</i>. It's essential to
understand that these expressions have exactly the same meaning. They
are just written differently.
</p>

<p>
The benefit is that we can now write lists without so much verbosity.
Here we write the same list examples as above, but using the infix
<i>::</i> operator intead of the prefix <i>cons</i>. The benefits are clearest
in the last example. When using the Idris <i>Nat</i> type, the benefit is
clearer yet: we would just write <i>2::1::0::nil</i> as the value of /l3'/.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #8D8D84; font-style: italic;">-- empty list of nat</span>
<span style="color: #333333; background-color: #FFFFFF;">l0</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">l0</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span>

<span style="color: #8D8D84; font-style: italic;">-- the list [0]</span>
<span style="color: #333333; background-color: #FFFFFF;">l1</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">l1</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">O</span><span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">l0</span>

<span style="color: #8D8D84; font-style: italic;">-- the list [0, 1]</span>
<span style="color: #333333; background-color: #FFFFFF;">l2</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">l2</span> <span style="color: #BA36A5;">=</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>)<span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">l1</span>

<span style="color: #8D8D84; font-style: italic;">-- the list [0, 1, 2]</span>
<span style="color: #333333; background-color: #FFFFFF;">l3</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">l3</span> <span style="color: #BA36A5;">=</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>))<span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">l2</span>

<span style="color: #8D8D84; font-style: italic;">-- the same list, [0, 1, 2]</span>
<span style="color: #333333; background-color: #FFFFFF;">l3'</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">l3'</span> <span style="color: #BA36A5;">=</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>))<span style="color: #BA36A5;">::</span>(<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>)<span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">O</span><span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">nil</span>
</pre>
</div>

<p>
Note. Function application has higher precedence than <i>::</i>. For this
reason we write the pattern in the second rule for <i>length</i> as <i>length
(head::tail)</i> rather than as <i>length head:: tail</i>. The latter would
otherwise be parsed as <i>(length head)::tail</i>, which is not desired or
allowed in this context.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline216" class="outline-2">
<h2 id="orgheadline216"><span class="section-number-2">17</span> Record Notation</h2>
<div class="outline-text-2" id="text-17">
<p>
In this chapter we introduce <i>record</i> notation for defining tuple
types (also called <i>product</i> or <i>record</i> types).  As with infix
operators, record notations really just make it easier to write and to
read code of the kind that we have already been writing. In
particular, records (1) give names to the fields of records, (2) bind
these names to projection functions for those fields, so that we don't
have to write projection functions ourselves, and (3) provide a more
conventient way to write field override functions.
</p>
</div>

<div id="outline-container-orgheadline212" class="outline-3">
<h3 id="orgheadline212"><span class="section-number-3">17.1</span> We Use Records to Represent Objects</h3>
<div class="outline-text-3" id="text-17-1">
<p>
As programmers we routinely write implementations of abstract data
types whose values we use to represent objects and operations in a
domain of interest.  If an application involves people, for example,
we might write code that implements a <i>Person</i> abstract data type. The
code would include <i>data type</i> called <i>Person</i>, with a constructor
that takes arguments representing the attributes of a person, and and
a set of functions for performing useful operations on values of this
type.
</p>

<p>
It would be typical in such cases to define an application-specific
<i>tuple</i>, or <i>record</i>, type, with one constructor that takes arguments
representing the <i>attributes</i> of the domain objects of interest. For
example, such a data type might have a constructor, <i>mkPerson</i> taking
four values: a <i>String</i> representing a person's name, a <i>nat</i> for the
person's age in years, a <i>nat</i> for his or her height in inches, and a
<i>bool</i> representing his or her gender, with <i>true</i> signifying <i>female</i>
and <i>false</i>, male.
</p>

<p>
Such a type is commonly called a <i>record</i> type. It has one constructor
that simply aggregates a set of attribute values into a value of the
given type. As an example, here's an Idris implementation of a simple
record type for representing people. (Note that in this code we have
quietly shifted from the use of our own <i>nat</i> type for Peano numbers
to the version of Peano numbers provided by Idris, namely <i>Nat</i> with a
capital <i>N</i>. Using Idris's version allows us to enter natural numbers
not using iterated applications of <i>S</i>, but using ordinary numerals.) 
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">module</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span>

<span style="color: #0000FF;">import</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>

<span style="color: #8D8D84;">|||</span><span style="color: #036A07;"> A Person has an age in years, a height in inches, </span>
<span style="color: #8D8D84;">|||</span><span style="color: #036A07;"> and a gender, true=female, false=male.</span>
<span style="color: #0000FF;">data</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mkPerson</span> <span style="color: #333333; background-color: #FFFFFF;">String</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
<span style="color: #BA36A5;">#</span><span style="color: #333333; background-color: #FFFFFF;">END_SRC</span>

<span style="color: #333333; background-color: #FFFFFF;">Having</span> <span style="color: #333333; background-color: #FFFFFF;">written</span> <span style="color: #333333; background-color: #FFFFFF;">such</span> <span style="color: #333333; background-color: #FFFFFF;">an</span> <span style="color: #333333; background-color: #FFFFFF;">implementation</span>, <span style="color: #333333; background-color: #FFFFFF;">we</span> <span style="color: #333333; background-color: #FFFFFF;">can</span> <span style="color: #333333; background-color: #FFFFFF;">now</span> <span style="color: #333333; background-color: #FFFFFF;">create</span> <span style="color: #333333; background-color: #FFFFFF;">values</span> <span style="color: #0000FF;">of</span>
<span style="color: #333333; background-color: #FFFFFF;">this</span> <span style="color: #333333; background-color: #FFFFFF;">type</span> <span style="color: #333333; background-color: #FFFFFF;">to</span> <span style="color: #333333; background-color: #FFFFFF;">represent</span> <span style="color: #333333; background-color: #FFFFFF;">several</span> <span style="color: #333333; background-color: #FFFFFF;">different</span> <span style="color: #333333; background-color: #FFFFFF;">people</span><span style="color: #BA36A5;">.</span>

<span style="color: #BA36A5;">#+</span><span style="color: #333333; background-color: #FFFFFF;">BEGIN_SRC</span> <span style="color: #333333; background-color: #FFFFFF;">idris</span>
<span style="color: #333333; background-color: #FFFFFF;">tom</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span>
<span style="color: #333333; background-color: #FFFFFF;">tom</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mkPerson</span> <span style="color: #008000;">"Tom"</span> 18 72 <span style="color: #333333; background-color: #FFFFFF;">false</span>

<span style="color: #333333; background-color: #FFFFFF;">mary</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span>
<span style="color: #333333; background-color: #FFFFFF;">mary</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mkPerson</span> <span style="color: #008000;">"Mary"</span> 21 68 <span style="color: #333333; background-color: #FFFFFF;">true</span>
</pre>
</div>

<p>
We now consider what are the functions that would be needed to make
sure a type useful. We consider two kinds of functions: <i>projection
functions</i>, which are often called <i>getters</i>, and <i>field update</i>
functions, which are often called <i>setters</i>.
</p>
</div>
</div>

<div id="outline-container-orgheadline213" class="outline-3">
<h3 id="orgheadline213"><span class="section-number-3">17.2</span> Projection Functions Get Field Values</h3>
<div class="outline-text-3" id="text-17-2">
<p>
 Given a value of type <i>Person</i>, a <i>projection</i> function returns the
value of one of its attributes. We need one such projection function
per attribute. We will name these functions after the fields whose
values they return: <i>getAge</i>, <i>getHeight</i> and <i>getGender</i>.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">getName</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">String</span>
<span style="color: #333333; background-color: #FFFFFF;">getName</span> (<span style="color: #333333; background-color: #FFFFFF;">mkPerson</span> <span style="color: #333333; background-color: #FFFFFF;">name</span> <span style="color: #333333; background-color: #FFFFFF;">age</span> <span style="color: #333333; background-color: #FFFFFF;">height</span> <span style="color: #333333; background-color: #FFFFFF;">gender</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">name</span>

<span style="color: #333333; background-color: #FFFFFF;">getAge</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">getAge</span> (<span style="color: #333333; background-color: #FFFFFF;">mkPerson</span> <span style="color: #333333; background-color: #FFFFFF;">name</span> <span style="color: #333333; background-color: #FFFFFF;">age</span> <span style="color: #333333; background-color: #FFFFFF;">height</span> <span style="color: #333333; background-color: #FFFFFF;">gender</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">age</span>

<span style="color: #333333; background-color: #FFFFFF;">getHeight</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">getHeight</span> (<span style="color: #333333; background-color: #FFFFFF;">mkPerson</span> <span style="color: #333333; background-color: #FFFFFF;">name</span> <span style="color: #333333; background-color: #FFFFFF;">age</span> <span style="color: #333333; background-color: #FFFFFF;">height</span> <span style="color: #333333; background-color: #FFFFFF;">gender</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">height</span>

<span style="color: #333333; background-color: #FFFFFF;">getGender</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
<span style="color: #333333; background-color: #FFFFFF;">getGender</span> (<span style="color: #333333; background-color: #FFFFFF;">mkPerson</span> <span style="color: #333333; background-color: #FFFFFF;">name</span> <span style="color: #333333; background-color: #FFFFFF;">age</span> <span style="color: #333333; background-color: #FFFFFF;">height</span> <span style="color: #333333; background-color: #FFFFFF;">gender</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">gender</span>
<span style="color: #BA36A5;">#</span><span style="color: #333333; background-color: #FFFFFF;">END_SRC</span>

<span style="color: #333333; background-color: #FFFFFF;">Having</span> <span style="color: #333333; background-color: #FFFFFF;">written</span> <span style="color: #333333; background-color: #FFFFFF;">such</span> <span style="color: #333333; background-color: #FFFFFF;">projection</span> <span style="color: #333333; background-color: #FFFFFF;">functions</span>, <span style="color: #333333; background-color: #FFFFFF;">we</span> <span style="color: #333333; background-color: #FFFFFF;">can</span> <span style="color: #333333; background-color: #FFFFFF;">now</span> <span style="color: #333333; background-color: #FFFFFF;">recover</span> <span style="color: #333333; background-color: #FFFFFF;">the</span> <span style="color: #333333; background-color: #FFFFFF;">field</span>
<span style="color: #333333; background-color: #FFFFFF;">values</span> <span style="color: #0000FF;">of</span> <span style="color: #333333; background-color: #FFFFFF;">given</span> <span style="color: #BA36A5;">/</span><span style="color: #333333; background-color: #FFFFFF;">Person</span><span style="color: #BA36A5;">/</span> <span style="color: #333333; background-color: #FFFFFF;">records</span><span style="color: #BA36A5;">.</span> <span style="color: #333333; background-color: #FFFFFF;">Here</span>, <span style="color: #333333; background-color: #FFFFFF;">for</span> <span style="color: #333333; background-color: #FFFFFF;">example</span>, <span style="color: #333333; background-color: #FFFFFF;">we</span> <span style="color: #333333; background-color: #FFFFFF;">find</span> <span style="color: #333333; background-color: #FFFFFF;">Tom's</span>
<span style="color: #333333; background-color: #FFFFFF;">age</span><span style="color: #BA36A5;">.</span>

<span style="color: #BA36A5;">#+</span><span style="color: #333333; background-color: #FFFFFF;">BEGIN_SRC</span> <span style="color: #333333; background-color: #FFFFFF;">idris</span>
<span style="color: #333333; background-color: #FFFFFF;">tomsAge</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span> 
<span style="color: #333333; background-color: #FFFFFF;">tomsAge</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">getAge</span> <span style="color: #333333; background-color: #FFFFFF;">tom</span>
</pre>
</div>

<p>
The result will be an age, which is of type <i>Nat</i>. We retrieve the
<i>age</i> field from the <i>tom</i> record by applying the <i>getAge</i> projection
function to the record.
</p>
</div>
</div>

<div id="outline-container-orgheadline214" class="outline-3">
<h3 id="orgheadline214"><span class="section-number-3">17.3</span> Field Override Functions Set Field Values</h3>
<div class="outline-text-3" id="text-17-3">
<p>
In many applications, we use records to represent the <i>state</i> of
objects. When the state of ab object changes, we need an updated
record to reflect the new state. It's often the case that the new
record should have the same values for all of it fields but one.
</p>

<p>
As an example, suppose that someone wishes to change his or her name.
Doing so will not change his age, height or gender. A new record for
the person should thus have the same values for these fields as the
old record, with only the name field being <i>overridden</i>.
</p>

<p>
We can understand and implement field override operations as simple
functions. Here's an example: a function that overrides the name in
a <i>Person</i> record while leaving all of the other fields unchanged. 
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">setName</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">String</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span>
<span style="color: #333333; background-color: #FFFFFF;">setName</span> (<span style="color: #333333; background-color: #FFFFFF;">mkPerson</span> <span style="color: #333333; background-color: #FFFFFF;">n</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #333333; background-color: #FFFFFF;">h</span> <span style="color: #333333; background-color: #FFFFFF;">g</span>) <span style="color: #333333; background-color: #FFFFFF;">n'</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mkPerson</span> <span style="color: #333333; background-color: #FFFFFF;">n'</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #333333; background-color: #FFFFFF;">h</span> <span style="color: #333333; background-color: #FFFFFF;">g</span>
</pre>
</div>

<p>
This field override function takes a Person (record) and a new name (a
String) as its arguments, and it returns a <i>new</i> Person record. It
uses pattern matching to destructure the original record, in order to
get at its field values, and it then creates and returns a new record.
It builds the new record using all of the field values from the old
one <i>except</i> for the name field. For that field, it just substitutes
the new name that was given as an argument. 
</p>

<p>
A moment's thought should make it clear that one can define similar
field override functions (<i>setters</i>) for all of the fields of a given
record type, and that they will follow the same pattern.
</p>


<p>
Having defined a field override function, we can use it as exemplified
in the following code. Here we apply <i>setName</i> to the <i>tom</i> record and
we provide a new name, John. The result is a record that is just like
<i>tom</i> except that the value of the <i>name</i> field is now "John". You can
confirm using the REPL that this code works as described here.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">tom'</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span>
<span style="color: #333333; background-color: #FFFFFF;">tom'</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">setName</span> <span style="color: #333333; background-color: #FFFFFF;">tom</span> <span style="color: #008000;">"John"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline215" class="outline-3">
<h3 id="orgheadline215"><span class="section-number-3">17.4</span> Record Notation</h3>
<div class="outline-text-3" id="text-17-4">
<p>
Our preceding presentation of record types and projection and field
override functions introduced no new programming mechanisms. We simply
described a standard, useful way to use the mechanisms that we have
already learned about.
</p>

<p>
There are a few problems with the approach we described.  First, the
only way to document the intended interpretation of the arguments to
the record constructor is in comments. It would be good if we could
give the fields names.  Second, the getter and setter code is highly
repetitive. It would be good if the programming language relieved us
of the need to write so much repetitive code. 
</p>

<p>
Record notation addresses these problems. It does not provide us with
greater expressive power. It just makes it easier to write, read, and
understand the kind of code that wrote in the preceding sections of
this chapter. Here's a new version of that code using record notation.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">record</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span> <span style="color: #0000FF;">where</span>
  <span style="color: #0000FF;">constructor</span> <span style="color: #333333; background-color: #FFFFFF;">mkPerson</span>
  <span style="color: #333333; background-color: #FFFFFF;">name</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">String</span>
  <span style="color: #333333; background-color: #FFFFFF;">age</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
  <span style="color: #333333; background-color: #FFFFFF;">height</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
  <span style="color: #333333; background-color: #FFFFFF;">gender</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>

<span style="color: #333333; background-color: #FFFFFF;">setName</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">String</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span>
<span style="color: #333333; background-color: #FFFFFF;">setName</span> <span style="color: #333333; background-color: #FFFFFF;">p</span> <span style="color: #333333; background-color: #FFFFFF;">n</span> <span style="color: #BA36A5;">=</span> <span style="color: #0000FF;">record</span> { <span style="color: #333333; background-color: #FFFFFF;">name</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">n</span> } <span style="color: #333333; background-color: #FFFFFF;">p</span>
</pre>
</div>

<p>
The code starts with the Idris reserved word <i>record</i> followed by the
name of the type being defined and then the reserved word <i>where</i>. The
next line specifies the name of the one constructor for values of this
type. The remaining for lines specify both the types and names for the
fields of values of this type. Other than giving names to the fields,
we've said nothing different here than in the earlier type definition.
</p>

<p>
The first&#x2014;and a significant&#x2014;benefit of this notation is that it
makes our code easier to read and understand. The names that we give
the fields provide strong hints as to the intended interpretations of
the fields. It's now clear, for example that the first <i>Nat</i> argument
to the constructor represents an age, and the second, a height. Before
we had to document these intensions in comment and in the names of the
projection functions we wrote.
</p>

<p>
The second benefit of record notation is that we no longer have to
write projection functions ourselves. Rather the names of the fields
are automatically bound to projection functions for the corresponding
fields. The Idris compiler generates those functions automatically. As
an example, we can now apply <i>age</i>, as a projection function, to <i>tom</i>
to get tom's age.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">tAge</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">tAge</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">age</span> <span style="color: #333333; background-color: #FFFFFF;">tom</span>
</pre>
</div>

<p>
Third, Idris generates field override functions. In particular, the
notation <i>record {fieldName = value}</i> names a field override function
that, when given a record, returns a new record with all the same
field values as the original record except for the named field. That
field gets the specified new value.
</p>

<p>
We can use this notation "in line" in our code to perform field
override operations. Here's an example where we change <i>tom's</i> name
to John,
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">tom'</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span>
<span style="color: #333333; background-color: #FFFFFF;">tom'</span> <span style="color: #BA36A5;">=</span> <span style="color: #0000FF;">record</span> {<span style="color: #333333; background-color: #FFFFFF;">name</span> <span style="color: #BA36A5;">=</span> <span style="color: #008000;">"John"</span> } <span style="color: #333333; background-color: #FFFFFF;">tom</span>
</pre>
</div>

<p>
We can also use this notation in explicitly define field override
functions of the sort that we wrote in earlier sections of this
chapter. The benefit of using record notation is that we no longer
have to explicitly write the code to destructure records and copy the
values of fields that are not being updated. For records with many
fields, the benefits in reduced code and reduced opportunities for
errors are real. 
</p>

<p>
The <i>setName</i> function that we defined in the code block above gives
an example of how we can use this record notation to simplify, but not
to entirely obviate the need for, explicit field override functions.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline220" class="outline-2">
<h2 id="orgheadline220"><span class="section-number-2">18</span> Tuples and Relations</h2>
<div class="outline-text-2" id="text-18">
<p>
By a <i>relation</i> we mean a set of values of a given tuple (record)
type. Relations can be visualized as <i>tables</i> of data. Each row of a
table is represented by a tuple value. Each column of a table picks
out a specific field from each tuple in a relation. 
</p>

<p>
Relations are absolutely central in practical computer science and
programming. Much, if not most, of the data that computers process
today in a business setting are stored in relational databases. At an
abstract level, a relational database is simple a sets of relations
for storing data for a given application or enterprise.
</p>

<p>
In this chapter, we will develop a simple way to represent relations
as lists of records. In following chapters we will explore a range of
functions that take relations as arguments and that produce results of
the kind that are often highly valuable in practice. For example, we
might want to compute the average age of a subset of people over some
given height. The methods we will develop will enable us to express
such computations in extremely concise, elegant, understandable, and
easy to modify forms.
</p>
</div>

<div id="outline-container-orgheadline217" class="outline-3">
<h3 id="orgheadline217"><span class="section-number-3">18.1</span> Tabular Representation of a Relation</h3>
<div class="outline-text-3" id="text-18-1">
<p>
As an example of a simple relation, consider the following table.  The
rows (tuples) represent people. The columns represent <i>fields</i> that
record the <i>attributes</i> of any given person: his or her name, age (in
years), height (in inches), and whether or not he or she is female.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">name</th>
<th scope="col" class="org-right">age</th>
<th scope="col" class="org-right">height</th>
<th scope="col" class="org-left">female</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Tom</td>
<td class="org-right">19</td>
<td class="org-right">56</td>
<td class="org-left">false</td>
</tr>

<tr>
<td class="org-left">Mary</td>
<td class="org-right">20</td>
<td class="org-right">59</td>
<td class="org-left">true</td>
</tr>

<tr>
<td class="org-left">Ge</td>
<td class="org-right">21</td>
<td class="org-right">64</td>
<td class="org-left">true</td>
</tr>

<tr>
<td class="org-left">Daryl</td>
<td class="org-right">19</td>
<td class="org-right">71</td>
<td class="org-left">false</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgheadline218" class="outline-3">
<h3 id="orgheadline218"><span class="section-number-3">18.2</span> Representing Relations as Lists of Records</h3>
<div class="outline-text-3" id="text-18-2">
<p>
We can easily represent such relational information in code. We define
a tuple (record) type, the values of which we will use to represent
the rows in the table. The fields of the type will correspond to the
columns of the table, and will record the relevant attributes of the
objects (in this case people) of interest. 
</p>

<p>
With this this tuple type in hand, we will create one value of this
type for each person we wish to represent. Finally we will assemble
these tuples (records) into a list.  Here's code for representing the
preceding relation in Idris.
</p>

<p>
We start by importing our Person type as the required tuple (record)
type, along with the polymorphic list and bool types. Next we create
four values of this type, one for each row. Finally we assemble these
values into a list. That's really all there is to it.
</p>


<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">module</span> <span style="color: #333333; background-color: #FFFFFF;">People</span>

<span style="color: #0000FF;">import</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span>
<span style="color: #0000FF;">import</span> <span style="color: #333333; background-color: #FFFFFF;">list</span>
<span style="color: #0000FF;">import</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>

<span style="color: #8D8D84; font-style: italic;">-- a few Persons</span>

<span style="color: #333333; background-color: #FFFFFF;">tom</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span>
<span style="color: #333333; background-color: #FFFFFF;">tom</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mkPerson</span> <span style="color: #008000;">"Tom"</span> 19 56 <span style="color: #333333; background-color: #FFFFFF;">false</span>

<span style="color: #333333; background-color: #FFFFFF;">mary</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span>
<span style="color: #333333; background-color: #FFFFFF;">mary</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mkPerson</span> <span style="color: #008000;">"Mary"</span> 20 59 <span style="color: #333333; background-color: #FFFFFF;">true</span>

<span style="color: #333333; background-color: #FFFFFF;">ge</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span>
<span style="color: #333333; background-color: #FFFFFF;">ge</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mkPerson</span> <span style="color: #008000;">"Ge"</span> 21 64 <span style="color: #333333; background-color: #FFFFFF;">true</span>

<span style="color: #333333; background-color: #FFFFFF;">daryl</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span> 
<span style="color: #333333; background-color: #FFFFFF;">daryl</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mkPerson</span> <span style="color: #008000;">"Daryl"</span> 19 71 <span style="color: #333333; background-color: #FFFFFF;">false</span>

<span style="color: #8D8D84; font-style: italic;">-- a list of Persons</span>

<span style="color: #333333; background-color: #FFFFFF;">people</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span>
<span style="color: #333333; background-color: #FFFFFF;">people</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">tom</span><span style="color: #BA36A5;">::</span>
         <span style="color: #333333; background-color: #FFFFFF;">mary</span><span style="color: #BA36A5;">::</span>
         <span style="color: #333333; background-color: #FFFFFF;">ge</span><span style="color: #BA36A5;">::</span>
         <span style="color: #333333; background-color: #FFFFFF;">daryl</span><span style="color: #BA36A5;">::</span>
         <span style="color: #333333; background-color: #FFFFFF;">nil</span>
</pre>
</div>

<p>
You should try out this code, or similar code in a domain of interest
to you, in your REPL. Evaluate <i>people</i> for example to see exactly how
Idris presents the list of records. It should be clear that you have
successfully encoded the preceding table as a list of records of type
<i>Person</i>.
</p>
</div>
</div>

<div id="outline-container-orgheadline219" class="outline-3">
<h3 id="orgheadline219"><span class="section-number-3">18.3</span> Conclusion</h3>
<div class="outline-text-3" id="text-18-3">
<p>
The interesting question is what can one do with values of such
<i>relational</i> types? The simple answer is that we can now define
functions that operate on relations! Operating on relational (i.e.,
tabular) data is a <i>huge</i> part of what modern software systems
do. Most business data processing and a great deal of what goes on in
data science involves functions that take relations as arguments.
Developing this idea futher is the subject of the next chapter and
beyond.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline238" class="outline-2">
<h2 id="orgheadline238"><span class="section-number-2">19</span> Higher-Order Functions</h2>
<div class="outline-text-2" id="text-19">
<p>
Suppose that you are given a relation like the one of the 
preceding chapter (but maybe much larger, perhaps involving
millions of records), and you want to calculate the average
age of everyone who is over six feet tall. How would you do
this?
</p>

<p>
One approach to solving this problem would involve four basic
steps. First, <i>filter</i> the relation based on height to leave only
those records for people over six feet tall. Second, <i>map</i> the
resulting list of people to a corresponding list of their ages.
Third, <i>reduce</i> this list of ages to a sum. Finally, divide the result
by the number of ages in the list (the length of the list).
</p>

<p>
The concepts of <i>filter</i>, <i>map</i>, and <i>reduce</i> give rise to a set of
deeply important higher-order polymorphic functions for operating on
lists (and other collections) of data values. Seeing how they arise
naturally and easily from the context of a very simple example is
the task of this chapter.
</p>
</div>

<div id="outline-container-orgheadline221" class="outline-3">
<h3 id="orgheadline221"><span class="section-number-3">19.1</span> Map</h3>
<div class="outline-text-3" id="text-19-1">
<p>
We will actually address the <i>map</i> step first. Here's code to map a
list of people to a list of their ages. In a nutshell, it works by
building a new list whose elements are obtained by applying the <i>age</i>
projection function to each person element of the original list.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">mapAge</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">mapAge</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span>
<span style="color: #333333; background-color: #FFFFFF;">mapAge</span> (<span style="color: #333333; background-color: #FFFFFF;">h</span><span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">t</span>) <span style="color: #BA36A5;">=</span> (<span style="color: #333333; background-color: #FFFFFF;">age</span> <span style="color: #333333; background-color: #FFFFFF;">h</span>)<span style="color: #BA36A5;">::</span>(<span style="color: #333333; background-color: #FFFFFF;">mapAge</span> <span style="color: #333333; background-color: #FFFFFF;">t</span>)
</pre>
</div>

<p>
We now can apply this code to our relation to obtain a list of ages
for the people in the relation. Try it in your REPL!
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">ages</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">ages</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mapAge</span> <span style="color: #333333; background-color: #FFFFFF;">people</span>
</pre>
</div>

<p>
What the <i>mapAge</i> code has done is to take a list of elements of one
type (here a value of type <i>list Person</i>, but let's just call it <i>list
a</i>), and a function from one type to another type (here from <i>Person</i>
to <i>Nat</i>, but let's just call it a function of type \(a \to b\)), and it
has returned as a result a list of that second type (here a <i>list Nat</i>
but let's just call it a value of type <i>list b</i>).
</p>

<p>
These observations and insights lead to an immediate and profound
generalization of our code.  The following <i>polymorphic</i> function
takes as its arguments any <i>function</i> of type \(a \to b\) (for <i>any</i>
types <i>a</i> and <i>b</i>), and a list of values of type <i>a</i>, and it returns a
list of values of type <i>b</i>, namely the list constructed from elements
obtained by applying the given function to each element of the first
list.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">map</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">b</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">b</span>
<span style="color: #333333; background-color: #FFFFFF;">map</span> <span style="color: #333333; background-color: #FFFFFF;">f</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span>
<span style="color: #333333; background-color: #FFFFFF;">map</span> <span style="color: #333333; background-color: #FFFFFF;">f</span> (<span style="color: #333333; background-color: #FFFFFF;">h</span><span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">t</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">?fill_in_this_hold</span>
</pre>
</div>

<p>
Now we can project the <i>age</i> column from our relation using this
generlaized function, as follows.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">ages</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">ages</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">map</span> <span style="color: #333333; background-color: #FFFFFF;">age</span> <span style="color: #333333; background-color: #FFFFFF;">people</span>
</pre>
</div>

<p>
The first argument to <i>map</i> is <i>age</i> which is of type \(Person \to
Nat\). The second argument, <i>people</i>, is of type <i>list Person$. The
result is thus of type /list Nat</i>, and in particular it is the list of
natural numbers obtained by applying the age function to each person
in the original list.
</p>

<p>
The benefit of having generalized the function should immediately be
clear. We can also use it to obtain a list of the <i>name</i> fields or any
other field in the relation. We can in fact use it to transform any
list of values of any type into a list of values of any other type
simply by providing a function that transforms one value of the first
type into a value of the second type. Here, for example, is code to
obtain a list of names for the people in the original relation. 
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">ages</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">String</span>
<span style="color: #333333; background-color: #FFFFFF;">ages</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">map</span> <span style="color: #333333; background-color: #FFFFFF;">name</span> <span style="color: #333333; background-color: #FFFFFF;">people</span>
</pre>
</div>

<p>
Note that our first application of <i>map</i> returned a list of <i>Nat</i>
values but that this application returned a list of <i>Strings</i>. This
<i>map</i> function is very flexible. It is also our first example of a
function that takes another function as an argument, which, as a part
of its operation, it applies to other data. The <i>map</i> function is a
paradigmatic example of a higher-order function.
</p>
</div>
</div>

<div id="outline-container-orgheadline224" class="outline-3">
<h3 id="orgheadline224"><span class="section-number-3">19.2</span> Filter</h3>
<div class="outline-text-3" id="text-19-2">
<p>
In the last section we saw how we can use the very general map
function with an element-wise projection function, such as <i>age</i>, to
project an entire <i>column</i>, such as the age column, from a given
relation. That's fine if we want a list of the ages for everyone in
our relation, but what if we want the ages only for a <i>selected</i>
subset of records: those satisfying some condition, such as having a
height over six feet? 
</p>

<p>
In this section, we introduce a second major higher-order function to
address this problem. It's called <i>filter</i>. The idea is that you give
it a <i>Boolean function</i> that takes a list element and returns <i>true</i>
if it satisfies the condition and <i>false</i> otherwise. The filter
function then constructs a new list from all of the elements of the
original list that satisfy the given condition (for which the Boolean
function evalutes to <i>true</i>).
</p>
</div>

<div id="outline-container-orgheadline222" class="outline-4">
<h4 id="orgheadline222"><span class="section-number-4">19.2.1</span> Decisions and Alternation</h4>
<div class="outline-text-4" id="text-19-2-1">
<p>
The overall strategy in constructing a new list will be this. If the
original list is empty then so is the new list. If the old list is not
empty, then it has an element, <i>h</i>, at the end, and a smaller list as
a tail, <i>t</i>. Here's the key observation: if <i>h</i> passes a test, then we
need to create and return a new list with <i>h</i> at its head, otherwise
we need to return a list without <i>h</i>. In other words, we need to make
a decision and then return one of two different results based on the
outcome of the decision.
</p>
<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">module</span> <span style="color: #333333; background-color: #FFFFFF;">ifThenElse</span>

<span style="color: #0000FF;">import</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>

<span style="color: #333333; background-color: #FFFFFF;">ite</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>
<span style="color: #333333; background-color: #FFFFFF;">ite</span> <span style="color: #333333; background-color: #FFFFFF;">true</span> <span style="color: #333333; background-color: #FFFFFF;">tb</span> <span style="color: #333333; background-color: #FFFFFF;">fb</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">tb</span>
<span style="color: #333333; background-color: #FFFFFF;">ite</span> <span style="color: #333333; background-color: #FFFFFF;">false</span> <span style="color: #333333; background-color: #FFFFFF;">tb</span> <span style="color: #333333; background-color: #FFFFFF;">fb</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">fb</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline223" class="outline-4">
<h4 id="orgheadline223"><span class="section-number-4">19.2.2</span> A simpler example</h4>
<div class="outline-text-4" id="text-19-2-2">
<p>
Let's start with a simple example. Given a list of natural 
numbers, let's compute the sublist of even numbers.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">module</span> <span style="color: #333333; background-color: #FFFFFF;">scratch</span>

<span style="color: #0000FF;">import</span> <span style="color: #333333; background-color: #FFFFFF;">list</span>
<span style="color: #0000FF;">import</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
<span style="color: #0000FF;">import</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #0000FF;">import</span> <span style="color: #333333; background-color: #FFFFFF;">ifThenElse</span>

<span style="color: #333333; background-color: #FFFFFF;">l</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">l</span> <span style="color: #BA36A5;">=</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>)<span style="color: #BA36A5;">::</span>(<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>))<span style="color: #BA36A5;">::</span>(<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>)))<span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>)))))<span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">nil</span>

<span style="color: #333333; background-color: #FFFFFF;">evens</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">evens</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span>
<span style="color: #333333; background-color: #FFFFFF;">evens</span> (<span style="color: #333333; background-color: #FFFFFF;">h</span><span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">t</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">ite</span> (<span style="color: #333333; background-color: #FFFFFF;">evenb</span> <span style="color: #333333; background-color: #FFFFFF;">h</span>) (<span style="color: #333333; background-color: #FFFFFF;">h</span><span style="color: #BA36A5;">::</span>(<span style="color: #333333; background-color: #FFFFFF;">evens</span> <span style="color: #333333; background-color: #FFFFFF;">t</span>)) (<span style="color: #333333; background-color: #FFFFFF;">evens</span> <span style="color: #333333; background-color: #FFFFFF;">t</span>)

<span style="color: #333333; background-color: #FFFFFF;">result</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">result</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">evens</span> <span style="color: #333333; background-color: #FFFFFF;">l</span>
</pre>
</div>

<p>
This function combines conditions and recursions. The base case is
that an empty list of natural numbers filtered for even numbers is
still just the empty list. There are two cases for a non-empty
list. First, if the head of the list is even (this is the condition),
then the result is a list starting with that number and followed by
the result for the rest of the list; otherwise the head of the given
list is left out, and the result is just the filtered version of the
rest of the list. 
</p>

<p>
Of course filtering lists of natural numbers for evenness is not the 
only kind of filtering of lists that we might want to do. Indeed, we
might want to filter lists with many different types of elements; and
we might want to use many different criteria to decide which elements
to include in a filtered result. 
</p>

<p>
We can easily generalize the preceding concrete example by replacing
<i>list nat</i> with <i>list a</i>, where <i>a</i> is any type, and by making <i>evenb</i>
into a function-valued parameter of type $a &rarr; bool$&#x2014;a Boolean
predicate on elements of the kind that appear in the list. The result
is a generalized list filtering function. 
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">filter</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>
<span style="color: #333333; background-color: #FFFFFF;">filter</span> <span style="color: #333333; background-color: #FFFFFF;">f</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span>
<span style="color: #333333; background-color: #FFFFFF;">filter</span> <span style="color: #333333; background-color: #FFFFFF;">f</span> (<span style="color: #333333; background-color: #FFFFFF;">h</span><span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">t</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">ite</span> (<span style="color: #333333; background-color: #FFFFFF;">f</span> <span style="color: #333333; background-color: #FFFFFF;">h</span>) (<span style="color: #333333; background-color: #FFFFFF;">h</span><span style="color: #BA36A5;">::</span>(<span style="color: #333333; background-color: #FFFFFF;">filter</span> <span style="color: #333333; background-color: #FFFFFF;">f</span> <span style="color: #333333; background-color: #FFFFFF;">t</span>)) (<span style="color: #333333; background-color: #FFFFFF;">filter</span> <span style="color: #333333; background-color: #FFFFFF;">f</span> <span style="color: #333333; background-color: #FFFFFF;">t</span>)
</pre>
</div>

<p>
Given this generalized, higher-order function, we can use us to carry
out the same computation as above by passing <i>evenb</i> in as a function
parameter. 
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">result2</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">result2</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">filter</span> <span style="color: #333333; background-color: #FFFFFF;">evenb</span> 
           ((<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>)<span style="color: #BA36A5;">::</span>(<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>))<span style="color: #BA36A5;">::</span>(<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>)))<span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>)))))<span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">nil</span>)
</pre>
</div>

<p>
Given that <i>evenb</i> is known to be of type \(nat \to bool\), Idris uses
type inference to infer that the value of the type argument, <i>a</i>, (the
type of list element in this context) is <i>nat</i>. The overall expression
type checks and <i>result2</i> ends up being the same as <i>result</i> above.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline225" class="outline-3">
<h3 id="orgheadline225"><span class="section-number-3">19.3</span> Reduce (Fold)</h3>
<div class="outline-text-3" id="text-19-3">
<p>
Now we turn to our third and final major higher-order function on
lists. This function is generally called a <i>right fold</i> function, and
is usually named <i>foldr</i>. It is also known as a <i>reduce</i> operation.
</p>

<p>
The basic idea is simple. We're given a list of values and a function
such as addition, and we want to apply the function repeatedly to
reduce the list of values to a single value. Reducing the list <i>[1, 2,
3, 4]</i> using addition, for example, would yield <i>10</i> as a result,
while reducing the same list using multiplication would yield <i>24</i>.
</p>

<p>
Here's a special-purpose, <i>fancy</i> addition, function for reducing a
list of natural numbers using addition. It says that if you do fancy
addition this to the empty list you get zero, and if you do it to a
non-empty list&#x2014;namely a list with a head, <i>h</i>, and a tail <i>t</i>&#x2014;the
result is the ordinary sum of the head and the result of doing fancy
addition on the rest of the list. 
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">fancyplus</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">fancyplus</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>
<span style="color: #333333; background-color: #FFFFFF;">fancyplus</span> (<span style="color: #333333; background-color: #FFFFFF;">h</span><span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">t</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">add</span> <span style="color: #333333; background-color: #FFFFFF;">h</span> (<span style="color: #333333; background-color: #FFFFFF;">fancyplus</span> <span style="color: #333333; background-color: #FFFFFF;">t</span>)
</pre>
</div>

<p>
Here's analogous code for reducing a list of natural numbers to a
product using multiplication. Note carefully the points of variation:
we replaced <i>add</i> with <i>mult</i>, and we replaced the value produced for
the base case. For addition, it was <i>O</i>, but for multiplication is it
<i>(S O)</i> (i.e., one).
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">fancymult</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">fancymult</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span> <span style="color: #BA36A5;">=</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>)
<span style="color: #333333; background-color: #FFFFFF;">fancymult</span> (<span style="color: #333333; background-color: #FFFFFF;">h</span><span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">t</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mult</span> <span style="color: #333333; background-color: #FFFFFF;">h</span> (<span style="color: #333333; background-color: #FFFFFF;">fancymult</span> <span style="color: #333333; background-color: #FFFFFF;">t</span>)
</pre>
</div>

<p>
And here is yet another example. This function reduces a list of Idris
String values to a single String by appending all the strings together
using Idris's infix string append operation, <i>(++)</i>.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">fancyappend</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">String</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">String</span>
<span style="color: #333333; background-color: #FFFFFF;">fancyappend</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span> <span style="color: #BA36A5;">=</span> <span style="color: #008000;">""</span>
<span style="color: #333333; background-color: #FFFFFF;">fancyappend</span> (<span style="color: #333333; background-color: #FFFFFF;">h</span><span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">t</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">h</span> <span style="color: #BA36A5;">++</span> (<span style="color: #333333; background-color: #FFFFFF;">fancyappend</span> <span style="color: #333333; background-color: #FFFFFF;">t</span>)
</pre>
</div>

<p>
Clearly all of these functions share a great deal of commonality. They
vary in just three dimensions: (1) the type of element in the list to
be reduced, (2) the binary function to be used, and (3) the value that
should be returned when reducing the empty list. 
</p>

<p>
We can avoid having to repeat such ourselves in this way by writing
one higher-order, polymorphic function with <i>arguments</i> (parameters)
for these dimensions of variation. The idea is that we can then get
any of the preceding behaviors by calling the generalized function 
with the right arguments. Here's the generalized code.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">foldr</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>
<span style="color: #333333; background-color: #FFFFFF;">foldr</span> <span style="color: #333333; background-color: #FFFFFF;">f</span> <span style="color: #333333; background-color: #FFFFFF;">id</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">id</span>
<span style="color: #333333; background-color: #FFFFFF;">foldr</span> <span style="color: #333333; background-color: #FFFFFF;">f</span> <span style="color: #333333; background-color: #FFFFFF;">id</span> (<span style="color: #333333; background-color: #FFFFFF;">h</span><span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">t</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">f</span> <span style="color: #333333; background-color: #FFFFFF;">h</span> (<span style="color: #333333; background-color: #FFFFFF;">list</span><span style="color: #BA36A5;">.</span><span style="color: #333333; background-color: #FFFFFF;">foldr</span> <span style="color: #333333; background-color: #FFFFFF;">f</span> <span style="color: #333333; background-color: #FFFFFF;">id</span> <span style="color: #333333; background-color: #FFFFFF;">t</span>)
</pre>
</div>

<p>
The code is polymorphic in the type, <i>a</i>, of elements in the list to
be reduced. The function then takes three arguments: a binary function
(such as <i>add</i>) that takes two values of this type and returns another
value of the same type; the specific value of this type that is to be
used as the result for the empty list; and a list of elements of this
type. The function then uses the recursive computation that we saw in
each of the concrete examples to reduce the list of elements of type
<i>a</i> to a result, also of type <i>a</i>.
</p>

<p>
Having defined this general <i>foldr</i> function, we can of course use it
to compute the results computed by any of the specialized versions
that started this section. Here are two examples.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">sum</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">sum</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">list</span><span style="color: #BA36A5;">.</span><span style="color: #333333; background-color: #FFFFFF;">foldr</span> <span style="color: #333333; background-color: #FFFFFF;">add</span> <span style="color: #333333; background-color: #FFFFFF;">O</span> 
        ((<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>)<span style="color: #BA36A5;">::</span>(<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>))<span style="color: #BA36A5;">::</span>(<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>)))<span style="color: #BA36A5;">::</span>
        <span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>)))))<span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">nil</span>)

<span style="color: #333333; background-color: #FFFFFF;">product</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">product</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">list</span><span style="color: #BA36A5;">.</span><span style="color: #333333; background-color: #FFFFFF;">foldr</span> <span style="color: #333333; background-color: #FFFFFF;">mult</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>) 
            ((<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>)<span style="color: #BA36A5;">::</span>(<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>))<span style="color: #BA36A5;">::</span>(<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>)))<span style="color: #BA36A5;">::</span>
            <span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> (<span style="color: #333333; background-color: #FFFFFF;">S</span> <span style="color: #333333; background-color: #FFFFFF;">O</span>)))))<span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">nil</span>)
</pre>
</div>

<p>
As an exercise, the reader should confirm that the function can also
be used to reduce a list of Strings to a single String using the Idris
<i>(++)</i> string append function. Note that one must enclose the <i>++</i> in
parenthesis when passing it as a value, to prevent Idris from trying
to evaluate it immediately.
</p>
</div>
</div>

<div id="outline-container-orgheadline233" class="outline-3">
<h3 id="orgheadline233"><span class="section-number-3">19.4</span> Relational Queries</h3>
<div class="outline-text-3" id="text-19-4">
<p>
At the beginning of this chapter, we observed the need to be able to
compute statistics on data represented in relations. This often
involves at least three steps: (1) select records from a relation
based on some filtering criterion, (20 project out a column (field)
from the result, yielding a list of values for that field, and (3)
reduce the resulting list to a single value, such as a sum.
</p>

<p>
Our <i>filter</i>, <i>map</i>, and <i>foldr</i> functions have provided us the tools
needed to perform these operations in a very general way. Here is
code, for example, where we first filter our list of people to include
only women; where we project the age field; and where we then sum up
the restulting list of ages, as we might do as one step in computing
the average age of women in our database.
</p>
<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">women</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">Person</span>
<span style="color: #333333; background-color: #FFFFFF;">women</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">filter</span> <span style="color: #333333; background-color: #FFFFFF;">gender</span> <span style="color: #333333; background-color: #FFFFFF;">people</span>

<span style="color: #333333; background-color: #FFFFFF;">wAges</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">wAges</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">map</span> <span style="color: #333333; background-color: #FFFFFF;">age</span> <span style="color: #333333; background-color: #FFFFFF;">women</span>

<span style="color: #333333; background-color: #FFFFFF;">years</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">years</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">list</span><span style="color: #BA36A5;">.</span><span style="color: #333333; background-color: #FFFFFF;">foldr</span> <span style="color: #333333; background-color: #FFFFFF;">plus</span> 0 <span style="color: #333333; background-color: #FFFFFF;">wAges</span>
</pre>
</div>

<p>
We start by passing the <i>gender</i> projection function to the filter
operation and then applying the result to our list of people. The
result is a smaller list of people for which the <i>gender</i> function
returned true, which is the case for all and only the women in our
people relation. We then <i>map</i> the <i>age</i> projection function over list
list to obtain a list of ages for the selected people. Finally we fold
this list into a sum.
</p>

<p>
As a next step we observe that we could have written the three steps
in this process in a single, equivalent, line of code. Here it is.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">oneLine</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">oneLine</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">list</span><span style="color: #BA36A5;">.</span><span style="color: #333333; background-color: #FFFFFF;">foldr</span> <span style="color: #333333; background-color: #FFFFFF;">plus</span> 0 (<span style="color: #333333; background-color: #FFFFFF;">map</span> <span style="color: #333333; background-color: #FFFFFF;">age</span> (<span style="color: #333333; background-color: #FFFFFF;">filter</span> <span style="color: #333333; background-color: #FFFFFF;">gender</span> <span style="color: #333333; background-color: #FFFFFF;">people</span>))
</pre>
</div>
</div>

<div id="outline-container-orgheadline226" class="outline-4">
<h4 id="orgheadline226"><span class="section-number-4">19.4.1</span> Generalization</h4>
<div class="outline-text-4" id="text-19-4-1">
<p>
We can see in the preceding example a more general form of <i>query</i>.
Such a query starts with a relation, performs a <i>select</i> operation
using <i>filter</i>, then performs a <i>project</i> operation using <i>map</i>, and
finally performs a <i>reduce</i> operation using <i>foldr</i>. What will vary
from case to case are the relation (here <i>people</i>), the selection
predicate (here <i>gender</i>), the projection operator (here <i>age</i>), and
the reduction operation (here <i>plus</i>) and its associated identity
element.
</p>

<p>
Replacing these concrete values with parameters so that programmers
can performan many different kinds of queries leads to the following
code. (The line breaks and indentation are just for readability.)
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">query</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">value</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">value</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">value</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">value</span> <span style="color: #BA36A5;">-&gt;</span> 
         (<span style="color: #333333; background-color: #FFFFFF;">tuple</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">value</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">tuple</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>) <span style="color: #BA36A5;">-&gt;</span> 
            (<span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">tuple</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">value</span>
<span style="color: #333333; background-color: #FFFFFF;">query</span> <span style="color: #333333; background-color: #FFFFFF;">reduce</span> <span style="color: #333333; background-color: #FFFFFF;">id</span> <span style="color: #333333; background-color: #FFFFFF;">project</span> <span style="color: #333333; background-color: #FFFFFF;">select</span> <span style="color: #333333; background-color: #FFFFFF;">relation</span> <span style="color: #BA36A5;">=</span>
       <span style="color: #333333; background-color: #FFFFFF;">list</span><span style="color: #BA36A5;">.</span><span style="color: #333333; background-color: #FFFFFF;">foldr</span> <span style="color: #333333; background-color: #FFFFFF;">reduce</span> <span style="color: #333333; background-color: #FFFFFF;">id</span> (<span style="color: #333333; background-color: #FFFFFF;">map</span> <span style="color: #333333; background-color: #FFFFFF;">project</span> (<span style="color: #333333; background-color: #FFFFFF;">filter</span> <span style="color: #333333; background-color: #FFFFFF;">select</span> <span style="color: #333333; background-color: #FFFFFF;">relation</span>))
</pre>
</div>

<p>
The following are examples of the use of this query function. Be sure
you see clearly how these function applications are working. Think
about the type inference that Idris must be doing.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">years'</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">years'</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">query</span> <span style="color: #333333; background-color: #FFFFFF;">plus</span> 0 <span style="color: #333333; background-color: #FFFFFF;">age</span> <span style="color: #333333; background-color: #FFFFFF;">gender</span> <span style="color: #333333; background-color: #FFFFFF;">people</span>

<span style="color: #333333; background-color: #FFFFFF;">totalHeight</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #8D8D84; font-style: italic;">--names = "Foo " ++ "Bar"</span>
<span style="color: #333333; background-color: #FFFFFF;">totalHeight</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">query</span> <span style="color: #333333; background-color: #FFFFFF;">plus</span> 0 <span style="color: #333333; background-color: #FFFFFF;">height</span> <span style="color: #333333; background-color: #FFFFFF;">gender</span> <span style="color: #333333; background-color: #FFFFFF;">people</span>

<span style="color: #333333; background-color: #FFFFFF;">names</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">String</span>
<span style="color: #333333; background-color: #FFFFFF;">names</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">query</span> (<span style="color: #BA36A5;">++</span>) <span style="color: #008000;">""</span> <span style="color: #333333; background-color: #FFFFFF;">name</span> <span style="color: #333333; background-color: #FFFFFF;">gender</span> <span style="color: #333333; background-color: #FFFFFF;">people</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline227" class="outline-4">
<h4 id="orgheadline227"><span class="section-number-4">19.4.2</span> Improved Argument Ordering</h4>
<div class="outline-text-4" id="text-19-4-2">
<p>
We can perhaps improve the readability of applications of our query
function by changing the order of the arguments. Here's the same
function, with with the argument ordering.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">query2</span><span style="color: #BA36A5;">:</span>  (<span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">tuple</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">tuple</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">tuple</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">value</span>) <span style="color: #BA36A5;">-&gt;</span>
            (<span style="color: #333333; background-color: #FFFFFF;">value</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">value</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">value</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">value</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">value</span>
<span style="color: #333333; background-color: #FFFFFF;">query2</span> <span style="color: #333333; background-color: #FFFFFF;">relation</span> <span style="color: #333333; background-color: #FFFFFF;">select</span> <span style="color: #333333; background-color: #FFFFFF;">project</span> <span style="color: #333333; background-color: #FFFFFF;">reduce</span> <span style="color: #333333; background-color: #FFFFFF;">id</span> <span style="color: #BA36A5;">=</span>
         <span style="color: #333333; background-color: #FFFFFF;">list</span><span style="color: #BA36A5;">.</span><span style="color: #333333; background-color: #FFFFFF;">foldr</span> <span style="color: #333333; background-color: #FFFFFF;">reduce</span> <span style="color: #333333; background-color: #FFFFFF;">id</span> (<span style="color: #333333; background-color: #FFFFFF;">map</span> <span style="color: #333333; background-color: #FFFFFF;">project</span> (<span style="color: #333333; background-color: #FFFFFF;">filter</span> <span style="color: #333333; background-color: #FFFFFF;">select</span> <span style="color: #333333; background-color: #FFFFFF;">relation</span>))
</pre>
</div>

<p>
Here are examples of uses of this modified query function.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">years''</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">years''</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">query2</span> <span style="color: #333333; background-color: #FFFFFF;">people</span> <span style="color: #333333; background-color: #FFFFFF;">gender</span> <span style="color: #333333; background-color: #FFFFFF;">age</span> <span style="color: #333333; background-color: #FFFFFF;">plus</span> 0

<span style="color: #333333; background-color: #FFFFFF;">totalInches''</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">totalInches''</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">query2</span> <span style="color: #333333; background-color: #FFFFFF;">people</span> <span style="color: #333333; background-color: #FFFFFF;">gender</span> <span style="color: #333333; background-color: #FFFFFF;">height</span> <span style="color: #333333; background-color: #FFFFFF;">mult</span> 1

<span style="color: #333333; background-color: #FFFFFF;">names''</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">String</span>
<span style="color: #333333; background-color: #FFFFFF;">names''</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">query2</span> <span style="color: #333333; background-color: #FFFFFF;">people</span> <span style="color: #333333; background-color: #FFFFFF;">gender</span> <span style="color: #333333; background-color: #FFFFFF;">name</span> (<span style="color: #BA36A5;">++</span>) <span style="color: #008000;">""</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline228" class="outline-4">
<h4 id="orgheadline228"><span class="section-number-4">19.4.3</span> Statistical Queries</h4>
<div class="outline-text-4" id="text-19-4-3">
<p>
We can now build several useful and easy-to-use <i>statistical query</i>
functions, using <i>query2</i> as a helper function, or subroutine. In this
subsection, we present three such queries: one that produces a <i>count</i>
of the number of records in a relation (providing an alternative to
using <i>length</i>), one that produces a sums up the natural numbers in a
column of a relation, and one that combines these two functions to
compute the average (represented as a rational number (fraction) that
we represent, in turn, as a simple pair of natural numbers, and which
we interpret as the numerator and the denominator of a rational
number).
</p>
</div>
</div>

<div id="outline-container-orgheadline229" class="outline-4">
<h4 id="orgheadline229"><span class="section-number-4">19.4.4</span> Count</h4>
<div class="outline-text-4" id="text-19-4-4">
<p>
We have already defined a recursive function to compute the length of
a list. Here we present a different technique using our <i>map-reduce</i>
query approach. The idea is that instead of a mapping a <i>projection</i>
function over a list of selected records we map a function that simply
returns the number <i>1</i> for each record in the list. Here's a function
that given any argument returns <i>1</i>.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">countOne</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">countOne</span> <span style="color: #333333; background-color: #FFFFFF;">v</span> <span style="color: #BA36A5;">=</span> 1
</pre>
</div>

<p>
Mapping this function over any list of length <i>k</i> (of values of any
type) will return a list of ones of length <i>k</i>. By then reducing this
list using addition we compute the length of the original list. We can
implement this idea by passing <i>countOne</i> as an argument to our query
function.
</p>

<p>
Here's an example. Work through the example in detail to be sure that
you understand how it works at each step.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">number</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">number</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">query2</span> <span style="color: #333333; background-color: #FFFFFF;">people</span> <span style="color: #333333; background-color: #FFFFFF;">gender</span> <span style="color: #333333; background-color: #FFFFFF;">countOne</span> <span style="color: #333333; background-color: #FFFFFF;">plus</span> 0
</pre>
</div>

<p>
To avoid having to use the <i>query2</i> argument with a fairly repetitive
list of arguments each time we want to compute the count of elements
in a list, we can write a function, here called <i>count_rel</i> (a name
that reminds us that the function counts the number of records in a
relation), to implement the common pattern, with the variabilities as
parameters. The arguments are a relation and a selection predicate and
the result is the number of records in the resulting relation.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">count_rel</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">tuple</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">tuple</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">count_rel</span> <span style="color: #333333; background-color: #FFFFFF;">rel</span> <span style="color: #333333; background-color: #FFFFFF;">sel</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">query2</span> <span style="color: #333333; background-color: #FFFFFF;">rel</span> <span style="color: #333333; background-color: #FFFFFF;">sel</span> <span style="color: #333333; background-color: #FFFFFF;">countOne</span> <span style="color: #333333; background-color: #FFFFFF;">plus</span> 0
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline230" class="outline-4">
<h4 id="orgheadline230"><span class="section-number-4">19.4.5</span> Sum</h4>
<div class="outline-text-4" id="text-19-4-5">
<p>
We can similarly write a function, here called <i>sum_rel</i>, to compute
the sum of the values in a column of numberic values from a set of
records selected from a relation. The parameters are a relation, a
filtering predicate, and a projection function that produces a natural
number result. The result is the sum of the these numbers.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">sum_rel</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">tuple</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">tuple</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">tuple</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">sum_rel</span> <span style="color: #333333; background-color: #FFFFFF;">rel</span> <span style="color: #333333; background-color: #FFFFFF;">sel</span> <span style="color: #333333; background-color: #FFFFFF;">proj</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">query2</span> <span style="color: #333333; background-color: #FFFFFF;">rel</span> <span style="color: #333333; background-color: #FFFFFF;">sel</span> <span style="color: #333333; background-color: #FFFFFF;">proj</span> <span style="color: #333333; background-color: #FFFFFF;">plus</span> 0
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline231" class="outline-4">
<h4 id="orgheadline231"><span class="section-number-4">19.4.6</span> Mean</h4>
<div class="outline-text-4" id="text-19-4-6">
<p>
We now close the loop on the promise made at the start of this
chapter. Here is code that returns a pair of natural numbers that
we interpret as a fraction. The first number is the total number of
years in the ages of the women in our data set; the second is the
number of women in the data set. The result is the average age,
represented here as a rational number (fraction).
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">aveAge</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">pair</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">aveAge</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mkPair</span> 
           (<span style="color: #333333; background-color: #FFFFFF;">query2</span> <span style="color: #333333; background-color: #FFFFFF;">people</span> <span style="color: #333333; background-color: #FFFFFF;">gender</span> <span style="color: #333333; background-color: #FFFFFF;">age</span> <span style="color: #333333; background-color: #FFFFFF;">plus</span> 0) 
           (<span style="color: #333333; background-color: #FFFFFF;">query2</span> <span style="color: #333333; background-color: #FFFFFF;">people</span> <span style="color: #333333; background-color: #FFFFFF;">gender</span> <span style="color: #333333; background-color: #FFFFFF;">countOne</span> <span style="color: #333333; background-color: #FFFFFF;">plus</span> 0)
</pre>
</div>

<p>
We can of course generalize from the specifics of that query to a
general form. The following <i>ave_rel</i> function thus takes a relation,
a selection predicate, and a projection function (or any function
taking a record and yielding a natural number) and returns a fraction
representing the average of the numbers in the selected set of records.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">ave_rel</span><span style="color: #BA36A5;">:</span>
    (<span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">tuple</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">tuple</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">tuple</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">pair</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">ave_rel</span> <span style="color: #333333; background-color: #FFFFFF;">rel</span> <span style="color: #333333; background-color: #FFFFFF;">sel</span> <span style="color: #333333; background-color: #FFFFFF;">proj</span> <span style="color: #BA36A5;">=</span>
   <span style="color: #333333; background-color: #FFFFFF;">mkPair</span> (<span style="color: #333333; background-color: #FFFFFF;">sum_rel</span> <span style="color: #333333; background-color: #FFFFFF;">rel</span> <span style="color: #333333; background-color: #FFFFFF;">sel</span> <span style="color: #333333; background-color: #FFFFFF;">proj</span>) (<span style="color: #333333; background-color: #FFFFFF;">count_rel</span> <span style="color: #333333; background-color: #FFFFFF;">rel</span> <span style="color: #333333; background-color: #FFFFFF;">sel</span>)
</pre>
</div>

<p>
All of this work we've done makes it possible to compute the average
age of women in our "database" with one simple function application
expression. Moreover, similar code can be written for <i>any</i> relation,
selection predicate, and projection function for a numeric field of
the record type in such a relation.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">aveAge'</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">pair</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span> <span style="color: #333333; background-color: #FFFFFF;">Nat</span>
<span style="color: #333333; background-color: #FFFFFF;">aveAge'</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">ave_rel</span> <span style="color: #333333; background-color: #FFFFFF;">people</span> <span style="color: #333333; background-color: #FFFFFF;">gender</span> <span style="color: #333333; background-color: #FFFFFF;">age</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline232" class="outline-4">
<h4 id="orgheadline232"><span class="section-number-4">19.4.7</span> Summary</h4>
<div class="outline-text-4" id="text-19-4-7">
<p>
This chapter has shown how what seem to be highly abstract and not
obviously useful higher-order functions can be harnessed to develop
concise and general statistical query functions that can operate on
<i>any</i> relation.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline237" class="outline-3">
<h3 id="orgheadline237"><span class="section-number-3">19.5</span> Exercises</h3>
<div class="outline-text-3" id="text-19-5">
</div><div id="outline-container-orgheadline234" class="outline-4">
<h4 id="orgheadline234"><span class="section-number-4">19.5.1</span> DNA</h4>
<div class="outline-text-4" id="text-19-5-1">
<p>
A DNA molecule is a sequence of base pairs. A base pair is one
of <i>AT</i>, <i>TA</i>, <i>CG</i>, or <i>GC</i>. We can represent a DNA molecule
as a <i>list</i> of basepairs. An example is <i>[AT,TA,CG,AT]</i>.
</p>

<p>
A DNA molecule can be split into two strands of bases. A base is one
of <i>A</i>, <i>T</i>, <i>C</i>, or <i>G</i>. We can represent a strand as a <i>list</i> of
bases. For example, the DNA molecule [AT,TA,CG,AT] splits into the two
strands [A,T,C,A] and [T,A,G,T]. The first strand is obtained by
taking the first base from each base pair in the DNA molecule, and the
second strand by taking the second base in each base pair.
</p>

<p>
In a file called dna.idr, define a <i>base</i> data type with values <i>A</i>,
<i>T</i>, <i>C</i>, and <i>G</i>. For purposes of this assignment, you can represent
a base pair as value of type <i>pair base base</i>. You must be careful
always to create base pairs from <i>complementary</i> bases: <i>A</i> and <i>T</i>,
and <i>C</i> and <i>G</i>, respectively.
</p>

<p>
Write a function called complement_base that takes a base and returns
the base that is its complement. Write test code for this function in
a separate dnaTest.idr file.
</p>

<p>
Write a function called complement_strand that takes a <i>list base</i>
(representing a DNA strand) and that returns the complementary strand
(the strand of bases complementary to those in the given list). Your
function <b>must</b> work by using <i>map</i> and <i>complement_base</i>.
</p>

<p>
Write a function called <i>strand1</i> that takes a <i>list (pair base base)</i>
representing a DNA molecule and that returns a value of type <i>list
base</i> representing the first strand of the given DNA molecule. Write
an analogous <i>strand2</i> function to return the second strand of a given
DNA molecule.
</p>

<p>
Write a function called complete that takes a <i>list base</i> representing
a strand of DNA and that returns a <i>list (pair base base)</i>
representing a DNA molecule, such that the first strand of the DNA
molecule is the given list of bases and the second strand is its
complementary strand. You must use <i>map</i> to implement this function.
</p>

<p>
Write a function called countBase that takes both a <i>list base</i>,
representing a strand of DNA, and a particular base, and that returns
the number of occurrences of that base in the given strand (as a
natural number). Your function must use <i>map</i> and <i>foldr</i>. Hint, use a
function that converts the list of bases into a list of zeros and ones
dependending on whether bases in the list match the given base, then
use <i>foldr</i> to reduce the resulting list by summing up all the ones
and zeros.
</p>
</div>
</div>

<div id="outline-container-orgheadline235" class="outline-4">
<h4 id="orgheadline235"><span class="section-number-4">19.5.2</span> Create a relation module</h4>
<div class="outline-text-4" id="text-19-5-2">
<p>
Create a new Idris module called <i>relation</i> in a file called
relation.idr. Add the general relation query functions defined above
to this file. Develop a separate relationTest.idr file and put the
demonstration and test cases above in that file. Add some tests of
your own. Make sure that all of this code actually works.
</p>
</div>
</div>

<div id="outline-container-orgheadline236" class="outline-4">
<h4 id="orgheadline236"><span class="section-number-4">19.5.3</span> Demonstrate application in your domain</h4>
<div class="outline-text-4" id="text-19-5-3">
<p>
Demonstrate the application of these functions to relations in <i>your</i>
domain. Do this by importing the <i>relation</i> module into the file in
which are are developing your application, and into corresponding test
file, and write some code that performs statistical queries on your
relation. Test your code to be sure it produces the expected results.
It will be helpful if your records contain a <i>Boolean</i> field, since
you will then have a ready-made selection predicate.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline244" class="outline-2">
<h2 id="orgheadline244"><span class="section-number-2">20</span> Specifications</h2>
<div class="outline-text-2" id="text-20">
<p>
Software systems are made of <i>specifications</i>, <i>interpretations</i>, and
<i>implementations</i>. In this chapter we introduce the idea that software
designers can and often should design specifications and
interpretations separately from implementations. We will illustate by
designing a specification that we will interpret as representing a
<i>set</i> abstract data type, with set operations such as intersection,
union, and difference.
</p>
</div>

<div id="outline-container-orgheadline239" class="outline-3">
<h3 id="orgheadline239"><span class="section-number-3">20.1</span> Specifications</h3>
<div class="outline-text-3" id="text-20-1">
<p>
By a <i>specification</i> we mean a computational model of entities and
relationships and processes in other domains, expressed in terms of
types and values.  <i>Interpretations</i> explain how specifications
represent given domains. <i>Implementations</i> are programs that, when
evaluated, produce computational processes that simulate the things
and processes modeled in corresponding specifications.
</p>

<p>
Specifications comprise the names of, types of, and constraints on
values and functions that are meant for use by clients of a given
module. For example, in our <i>nat</i> module, the <i>nat</i> type along with
the names, types, and required behaviors of functions such as <i>add</i>
and <i>mult</i> constitute a <i>specification</i>. 
</p>

<p>
A key idea is that a client of the module can understand and use the
module based only on the specification it presents, without having to
see or understand how it implements that abstraction. For example, it
is generally not necessary for clients of a module to understand how
given functions are implemented with recursive definitions.
</p>
</div>
</div>

<div id="outline-container-orgheadline240" class="outline-3">
<h3 id="orgheadline240"><span class="section-number-3">20.2</span> Interpretations</h3>
<div class="outline-text-3" id="text-20-2">
<p>
In our practice to date, we have been documenting interpretations by
using descriptive names (such as <i>plus</i>) for types and values, and by
embedding comments and documentation strings in our code. For example,
we interpret the terms of our <i>nat</i> type as representing the natural
numbers of everyday arithmetic, and functions that manipulate these
terms as representing arithmetic operations on such numbers.
</p>
</div>
</div>

<div id="outline-container-orgheadline241" class="outline-3">
<h3 id="orgheadline241"><span class="section-number-3">20.3</span> Implementations</h3>
<div class="outline-text-3" id="text-20-3">
<p>
Implementations include the actual values of functions and data that
our programs define in order satify the given specifications. As an
example, we provided one of several possible functions for evaluating
applications of the <i>add</i> function to arguments. The one we choose
need only meets the constraints imposed by the (explicit or tacitly
understood) specification, e.g., that it really simulate the addition
of natural numbers using values of type <i>nat</i>.
</p>
</div>
</div>

<div id="outline-container-orgheadline242" class="outline-3">
<h3 id="orgheadline242"><span class="section-number-3">20.4</span> Separation of Concerns</h3>
<div class="outline-text-3" id="text-20-4">
<p>
Separating the design of specifications and their interpretations from
the design of implementations is one of the most important principles
and practices of software design and development. It provides enormous
intellectual leverage by enabling the designer to consider what is to
be represented and how it is to be represented <i>abstractly</i> without
getting enmeshed in details of ant particular concrete implementation.
</p>

<p>
One a specification and interpretation have been constructed, one can
then turn to the problem of producing an implementation. We often use
the term <i>interface</i> to refer to a specification and <i>implementation</i>
to refer to a realization of the interface.
</p>

<p>
Until now, we have been writing our code in a way that has not made
this separation clear.  That is, we have intermingled the design of
the specifications and implementations of our programs. 
</p>
</div>
</div>

<div id="outline-container-orgheadline243" class="outline-3">
<h3 id="orgheadline243"><span class="section-number-3">20.5</span> Example: A Set ADT</h3>
<div class="outline-text-3" id="text-20-5">
<p>
In this section, we present a specification and an interpretation of
the specification as representing a <i>set</i> abstract data type. Recall
that an ADT comprises a set of values of some type along with a set of
operations involving those values.
</p>

<p>
We have placed the code below in a file called set_adt.idr.
</p>

<p>
After the requisite imports, we start with a type constructor. Until
now, you have seen data type definitions that combine elements of
specification and implementation.  For example, we could write <i>data
set a = mkSet (list a)</i> to define a set of terms that we will
interpret as representing sets. Each term is like a ``box with a list
of values of type a'' inside. You will recall that the type of <i>set</i>
in this case is \(Type \to Type\).
</p>

<p>
The name, set, and that fact that it is a type constructor&#x2014;taking a
type parameter, <i>a</i>, stating the type of set elements&#x2014;constitutes
the specification part of the definition. We will consider both the
name of the constructor, <i>mkSet</i>, and the fact that it takes a value
of type <i>list a</i> as an argument, to be implementation elements.
</p>

<p>
To write the specification without those implementation details, we
could simply write the following code, which declares <i>set</i> to be of
type \(Type \to Type\). Thus <i>set</i> is a polymorphic type. In order to
make this purely logical specification meaningful, we document what
this element is meant to represent in both the name, <i>set</i>, and in
explanatory prose, here in the form of an Idris documentation string.
</p>

<p>
In this chapter we introduce a new feature of Idris, which you can
see used in the following code: We can give names to the arguments
in a function type declaration. It's often useful to do so. Having
names for arguments makes it easier to describe what a function is
meant to do. 
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #8D8D84; font-style: italic;">-- A polymorphic set type. We interpret values of type (set a) as</span>
<span style="color: #8D8D84; font-style: italic;">-- representing sets of values of type a.</span>
  <span style="color: #0000FF;">data</span> <span style="color: #333333; background-color: #FFFFFF;">set</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">a</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">Type</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">Type</span>
</pre>
</div>

<p>
To provide clients with the ability to obtain a representation of an
empty set, we provide the empty set value as part of the public 
"interface" that this module presents to its clients. 
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #8D8D84; font-style: italic;">-- The empty set of a</span>
<span style="color: #333333; background-color: #FFFFFF;">emptySet</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>
</pre>
</div>

<p>
Next we specify a function for asking whether a set, <i>s</i>, is empty.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #8D8D84; font-style: italic;">-- If s is empty then true, otherwise false</span>
<span style="color: #333333; background-color: #FFFFFF;">isEmpty</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">s</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
</pre>
</div>

<p>
The insert operation models the addition of an element, v, to a set,
s, yielding a new set. If v was already in s, the new set is the same
as s.
</p>
<div class="org-src-container">

<pre class="src src-idris"><span style="color: #8D8D84; font-style: italic;">-- Return the set, s union {v}</span>
<span style="color: #333333; background-color: #FFFFFF;">set_insert</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">eq</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">=&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">v</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">s</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>
</pre>
</div>

<p>
The <i>remove</i> function models the removal of a specified element from a 
set. If the element was not in the set, the new set is the same as the
original.
</p>
<div class="org-src-container">

<pre class="src src-idris"><span style="color: #8D8D84; font-style: italic;">-- Return the set, s - {v}</span>
<span style="color: #333333; background-color: #FFFFFF;">set_remove</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">eq</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">=&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">v</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">s</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>
</pre>
</div>

<p>
The <i>cardinality</i> function returns the number of elements in the
given set.  This function is required to return zero for the empty
set, of course.
</p>
<div class="org-src-container">

<pre class="src src-idris"><span style="color: #8D8D84; font-style: italic;">-- Return the number of elements in s</span>
<span style="color: #333333; background-color: #FFFFFF;">set_cardinality</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">s</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
</pre>
</div>

<p>
The <i>member</i> function is the ndicator function for the set.  That it,
it is a predicate that answers whether the given element is in the set
(true) or not (false).
</p>
<div class="org-src-container">

<pre class="src src-idris"><span style="color: #8D8D84; font-style: italic;">-- If v is in s return true, otherwise false</span>
<span style="color: #333333; background-color: #FFFFFF;">set_member</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">eq</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">=&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">v</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">s</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
</pre>
</div>

<p>
The <i>union</i>, <i>intersection</i>, and <i>difference</i> operations each take two
set arguments and return their union, intersection, and difference, as
the names suggest.
</p>
<div class="org-src-container">

<pre class="src src-idris"><span style="color: #8D8D84; font-style: italic;">-- Return union of s1 and s2</span>
<span style="color: #333333; background-color: #FFFFFF;">set_union</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">eq</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">=&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">s1</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">s2</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>

<span style="color: #8D8D84; font-style: italic;">-- Return the intersection of s1 and s2</span>
<span style="color: #333333; background-color: #FFFFFF;">set_intersection</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">eq</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">=&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">s1</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">s2</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>

<span style="color: #8D8D84; font-style: italic;">-- Return the set difference, s1 minus s2</span>
<span style="color: #333333; background-color: #FFFFFF;">set_difference</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">eq</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">=&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">s1</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">s2</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #8D8D84; font-style: italic;">-- Return true p is true for every v in s, otherwise false</span>
<span style="color: #333333; background-color: #FFFFFF;">set_forall</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">p</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">s</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>


<span style="color: #8D8D84; font-style: italic;">-- Return true if p is true for some v in s, otherwise else false</span>
<span style="color: #333333; background-color: #FFFFFF;">set_exists</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">p</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">s</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>


<span style="color: #8D8D84; font-style: italic;">-- If (set_exists p s), return (some v) such that (p v) is true, else</span>
<span style="color: #8D8D84; font-style: italic;">-- return none. We need to return an option because there might not be</span>
<span style="color: #8D8D84; font-style: italic;">-- an element in s with property p.  If there is such an element, we</span>
<span style="color: #8D8D84; font-style: italic;">-- call it a "witness to the property p."</span>
<span style="color: #333333; background-color: #FFFFFF;">set_witness</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">p</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">s</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">option</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>
</pre>
</div>

<p>
The <i>set_product</i> function takes two sets of elements (or possible
different types) and returns product set: i.e., that set of all pairs
of elements, where the first element in each pair comes from s1 and
the second comes from s2. For example, the product of the &#x2013; sets {1,
2} and {a, b} is { (1, a), (1, b), (2, a), (2, b) }.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #8D8D84; font-style: italic;">-- Return the cartesian product of s1 and s2. </span>
<span style="color: #333333; background-color: #FFFFFF;">set_product</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">s1</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">s2</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">b</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> (<span style="color: #333333; background-color: #FFFFFF;">pair</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #333333; background-color: #FFFFFF;">b</span>)
</pre>
</div>

<p>
The powerset of a given set is the set of all subsets of that set.
For example, the powerset of {1, 2, 3} is the set, { {}, {1}, {2},
{3}, {1, 2}, {1, 3}, {2, 3}, {1, 2, 3} }. The cardinality of the
powerset of a set of cardinality n is 2^n.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #8D8D84; font-style: italic;">-- Extra credit: Return the set of all sets of elements of s.</span>
<span style="color: #333333; background-color: #FFFFFF;">set_powerset</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">s</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> (<span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>)
</pre>
</div>


<p>
These functions provide implementations of set equality and set
serialization to a string form. They're implemented in typeclass
instances.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #8D8D84; font-style: italic;">-- return true if s1 and s2 are equal, else false</span>
<span style="color: #333333; background-color: #FFFFFF;">set_eql</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">eq</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">=&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">s1</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">s2</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>

<span style="color: #8D8D84; font-style: italic;">-- Return a string representation of s</span>
<span style="color: #333333; background-color: #FFFFFF;">set_toString</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">Serialize</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">=&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">String</span>
</pre>
</div>

<p>
These typeclass instances delegate their overloaded functions
to the <i>set_eql</i> and <i>toString</i> functions that we just defined.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">instance</span> (<span style="color: #333333; background-color: #FFFFFF;">eq</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">=&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">eq</span> (<span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #0000FF;">where</span>
  <span style="color: #333333; background-color: #FFFFFF;">eql</span> <span style="color: #333333; background-color: #FFFFFF;">s1</span> <span style="color: #333333; background-color: #FFFFFF;">s2</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">set_eql</span> <span style="color: #333333; background-color: #FFFFFF;">s1</span> <span style="color: #333333; background-color: #FFFFFF;">s2</span>

<span style="color: #0000FF;">instance</span> (<span style="color: #333333; background-color: #FFFFFF;">Serialize</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">=&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">Serialize</span> (<span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #0000FF;">where</span>
  <span style="color: #333333; background-color: #FFFFFF;">toString</span> <span style="color: #333333; background-color: #FFFFFF;">s</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">set_toString</span> <span style="color: #333333; background-color: #FFFFFF;">s</span>
</pre>
</div>
</div>
</div>
</div>



<div id="outline-container-orgheadline251" class="outline-2">
<h2 id="orgheadline251"><span class="section-number-2">21</span> Representation</h2>
<div class="outline-text-2" id="text-21">
<p>
As the first step in implementing our set ADT specification, we need
to make a very important design decision. We need to decide how we're
going to <i>represent</i> set values. This decision will have significant
ramifications for our software. It will determine how hard it will be
to implement the set functions, and it will have a major influence on
how fast those functions run as we scale up the sizes of sets.
</p>

<p>
Indeed, we might eventually find, that our initial design decision is
no longer adequate. At that point, we might want to change it. What we
want to avoid if we do change it is having to rewrite all the code
that <i>uses</i> our <i>set</i> module. 
</p>

<p>
The trick is to restrict clients to relying only on the specification,
and not on the the representation details. In a sense, we want to keep
them as <i>secrets</i> of our set module. Then we'll be able to change the
secrets without having the change the programs that use the module, as
they will rely only on the <i>public</i> specification. The module will be
said to <i>encapsulate</i> its implementation details, i.e., to prevent its
clients from coming to rely upon them.
</p>
</div>

<div id="outline-container-orgheadline250" class="outline-3">
<h3 id="orgheadline250"><span class="section-number-3">21.1</span> Representing sets as lists</h3>
<div class="outline-text-3" id="text-21-1">
<p>
There are many ways to represent sets. Here we will illustrate one
such implementation strategy: we will represent sets as lists subject
to a constraint that they contain <i>no duplicate elements</i>. 
</p>

<p>
The code that implements specified set operations will do so by
manipulating lists while preserving this <i>representation invariant</i>.
Any list that satisfies this invariant in this context can then be
taken as representing a set. The relationship between such a list and
the corresponding set is called an <i>abstraction function</i>. Given a
representation that satisfies its invariants, an abstraction function
explains what value it represents. Here for example, $[v_1, \ldots,
v_n],$ represents exactly the set \(\{ v_1, \ldots, v_n \}\).
</p>

<p>
The verb, to abstract, means to ignore details. What is ignored here
in the mapping from a list to set is the order of the elements in the
list.
</p>
</div>

<div id="outline-container-orgheadline245" class="outline-4">
<h4 id="orgheadline245"><span class="section-number-4">21.1.1</span> Importing the Specification and Implementation Types</h4>
<div class="outline-text-4" id="text-21-1-1">
<p>
We placed our set specification in a file called <i>set.idr</i>. We place
our list-based implementation of the set specification in a separate
file called <i>set_list_impl.idr.</i> This file imports the specification,
along with the list module.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">module</span> <span style="color: #333333; background-color: #FFFFFF;">set_list_impl</span>
<span style="color: #0000FF;">import</span> <span style="color: #0000FF;">public</span> <span style="color: #333333; background-color: #FFFFFF;">set</span>
<span style="color: #0000FF;">import</span> <span style="color: #333333; background-color: #FFFFFF;">list</span>
</pre>
</div>

<p>
The rest of the file provides a list-based implementation for each
element of the <i>set</i> specification. It's worth emphasizing again that
the set specification did <i>not</i> make a commitment to any particular
representation of sets. That leaves us to decide whether we want to
represent them as lists, trees, arrays (whatever they are), products
of prime numbers, tables in database, or in some other way.
</p>
</div>
</div>

<div id="outline-container-orgheadline246" class="outline-4">
<h4 id="orgheadline246"><span class="section-number-4">21.1.2</span> Design Decisions and Tradeoffs</h4>
<div class="outline-text-4" id="text-21-1-2">
<p>
In general, the choice of a representation for a given specification
involves complex tradeoffs. One representation might make it easier
and faster write the code for the specified operations, for example,
but at the cost of worse runtime speed and memory utilization, while a
different representation might run much faster but at the cost of more
complex code and increased risks of bugs that compromise reliability.
</p>

<p>
Our choice of a list implementation for sets trades away performance
at runtime (list representations are slow) for ease of implementation.
As a small compromise for efficiency, we constrain lists representing
sets not to have duplicate elements. The cost is a small increase in
the difficulty of implementing the code. 
</p>

<p>
Indeed, as we will see, the challenges created by the requirement to
preserve the <i>no duplicates</i> invariant will lead us down several new
paths, which we will explore in this chapter and the next two.
</p>
</div>
</div>

<div id="outline-container-orgheadline247" class="outline-4">
<h4 id="orgheadline247"><span class="section-number-4">21.1.3</span> Implementing the <i>set</i> Data Type</h4>
<div class="outline-text-4" id="text-21-1-3">
<p>
We now write the Idris code that commits us (in this file) to
represent sets as lists. Compare this data type definition with
our <i>Box</i> type. In essence, a <i>set</i> is represented here as what
amounts to ``a list in a box.''
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">data</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">=</span>
<span style="color: #8D8D84;">|||</span><span style="color: #036A07;"> we represent a (set a) as a (list a) subject to</span>
<span style="color: #8D8D84;">|||</span><span style="color: #036A07;"> the constraint that it contain no duplicate values</span>
<span style="color: #333333; background-color: #FFFFFF;">mkSet</span> (<span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>)
</pre>
</div>

<p>
A crucial observation is that no mechanism is provided here to prevent
the <i>mkBox</i> constructor from being applied to a list with duplicates.
The result would be a value that the compiler would accept as being of
type <i>set</i>, but the object would not be a properly represent a set.
</p>

<p>
In this class, we won't explore machinery for enforcing constraints of
this kind.  Rather, we will declare that the <i>mkSet</i> constructor is to
be treated as a secret of this module, and is thus never to be used by
clients of this module. We will put responsibility on the implementor
of this module to ensure that the constructor is only applied to lists
without duplicates. 
</p>
</div>
</div>

<div id="outline-container-orgheadline248" class="outline-4">
<h4 id="orgheadline248"><span class="section-number-4">21.1.4</span> Encapsulating the type constructor behind an initial value</h4>
<div class="outline-text-4" id="text-21-1-4">
<p>
Given that the <i>mkSet</i> constructor is no longer usable by clients of
this module, we need to provide clients with another way to obtain a
set value. We thus made the <i>empty_set</i> value a part of the <i>public</i>
specification of the set type. The <i>empty_set</i> value is provided as a
sort of pseudo-constructor: a initial value of the set type available
to any client as a starting point for building larger sets.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">set_empty</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>
<span style="color: #333333; background-color: #FFFFFF;">set_empty</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mkSet</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline249" class="outline-4">
<h4 id="orgheadline249"><span class="section-number-4">21.1.5</span> Implementing the insert operation (badly)</h4>
<div class="outline-text-4" id="text-21-1-5">
<p>
Finally we come to the insert operator. Once we have this operation
implemented, we'll be able to create sets of any size by starting with
<i>empty_set</i> and repeatedly applying <i>set_insert</i> to obtain the desired
value.
</p>

<p>
We might be tempted to implement <i>set_insert</i> as a simple <i>list cons</i>.
Here's the code.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">set_insert</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">v</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> (<span style="color: #333333; background-color: #FFFFFF;">s</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>
<span style="color: #333333; background-color: #FFFFFF;">set_insert</span> <span style="color: #333333; background-color: #FFFFFF;">v</span> (<span style="color: #333333; background-color: #FFFFFF;">mkSet</span> <span style="color: #333333; background-color: #FFFFFF;">l</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">mkSet</span> (<span style="color: #333333; background-color: #FFFFFF;">v</span><span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">l</span>)
</pre>
</div>

<p>
The problem, of course, is that this implementation does not guarantee
that the representation invariant is preserved. It's clear. If we
apply this definition of <i>set_insert</i> twice using the same value each
time, we'll end up with a list with duplicate elements, violating our
representation invariant. The following code illustrates the problem.
In your REPL, you can easily confirm that the compiler considers <i>s2</i>
to be a value of type <i>set</i>, yet it is based on a list containing <i>O</i>
twice.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">module</span> <span style="color: #333333; background-color: #FFFFFF;">foo_impl_test</span>
<span style="color: #0000FF;">import</span> <span style="color: #333333; background-color: #FFFFFF;">foo_impl</span>
<span style="color: #0000FF;">import</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>

<span style="color: #333333; background-color: #FFFFFF;">s0</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">s0</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">set_empty</span>
<span style="color: #8D8D84; font-style: italic;">-- expect: mkSet nil</span>

<span style="color: #333333; background-color: #FFFFFF;">s1</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">s1</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">set_insert</span> <span style="color: #333333; background-color: #FFFFFF;">O</span> <span style="color: #333333; background-color: #FFFFFF;">s0</span>
<span style="color: #8D8D84; font-style: italic;">-- expect: mkSet (O :: nil)</span>

<span style="color: #333333; background-color: #FFFFFF;">s2</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
<span style="color: #333333; background-color: #FFFFFF;">s2</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">set_insert</span> <span style="color: #333333; background-color: #FFFFFF;">O</span> <span style="color: #333333; background-color: #FFFFFF;">s1</span>
<span style="color: #8D8D84; font-style: italic;">-- expect: mkSet (O :: nil)</span>
</pre>
</div>

<p>
Here's what you will see when inspecting <i>s2</i> in the REPL.
</p>

<div class="org-src-container">

<pre class="src src-idris">&#955;&#928;<span style="color: #BA36A5;">&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">s2</span>
<span style="color: #333333; background-color: #FFFFFF;">mkSet</span> (<span style="color: #333333; background-color: #FFFFFF;">O</span> <span style="color: #BA36A5;">::</span> <span style="color: #333333; background-color: #FFFFFF;">O</span> <span style="color: #BA36A5;">::</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span>) <span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">set</span> <span style="color: #333333; background-color: #FFFFFF;">nat</span>
</pre>
</div>

<p>
The price of the representation invariant is a somewhat more complex
implementation. Here is a new version of insert that uses a function,
<i>member</i>, that we haven't yet written! We're using it <i>assuming</i> that
it exists and works as desired. What does <i>(member v l)</i> do (at least
in our imaginations)? It returns <i>true</i> if the value, <i>v</i>, is in the
list, <i>l</i>, otherwise it returns <i>false</i>.
</p>

<p>
With this list membership test in hand, it is now easy to write the
code using a conditional. <i>If</i> the value being inserted into the set
is already in the list representing the set, <i>then</i> we return a set
represented by the list with modification, <i>otherwise</i> we return a set
represented by a list with the new element added at the front. In both
cases we can confirm that the result represents the union of the given
list and the singleton set containing the given element.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">set_insert</span> <span style="color: #333333; background-color: #FFFFFF;">v</span> (<span style="color: #333333; background-color: #FFFFFF;">mkSet</span> <span style="color: #333333; background-color: #FFFFFF;">l</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">ite</span> (<span style="color: #333333; background-color: #FFFFFF;">member</span> <span style="color: #333333; background-color: #FFFFFF;">v</span> <span style="color: #333333; background-color: #FFFFFF;">l</span>) 
                             (<span style="color: #333333; background-color: #FFFFFF;">mkSet</span> <span style="color: #333333; background-color: #FFFFFF;">l</span>) 
                             (<span style="color: #333333; background-color: #FFFFFF;">mkSet</span> (<span style="color: #333333; background-color: #FFFFFF;">v</span><span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">l</span>))
</pre>
</div>

<p>
The remaining challenge now is to implement the list membership test,
<i>member</i>.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline252" class="outline-2">
<h2 id="orgheadline252"><span class="section-number-2">22</span> Top-down Design</h2>
<div class="outline-text-2" id="text-22">
<p>
The <i>design move</i> that we just made exemplifies one of the fundamental
problem-solving methods in software development. When we're faced with
a complex programming task, it can be incredibly useful to implement
it using <i>imagined</i> functions that make coding easy. One has thereby
reduced the problem to one of implementing these lesser functions.
</p>

<p>
In this case, the problem of implementing <i>set_insert</i> has been
reduced to that of implementing a list membership test.  A standard
recursive approach should do. No element is a member of the empty
list, so the result for an empty list should always be <i>false</i>.  If
the element being tested is <i>equal to</i> the one at the head of the
list, then the list contains the element and the result should be
true. Otherwise one should return the answer obtained by checking the
rest of the list, which can be done with a recursive application of
the function to the tail of the list.
</p>

<p>
There is only one problem: We don't yet have an equality testing
function that we can use here. No problem, you say, we can just use
top-down decomposition, wish for an <i>eql</i> operator, and write the
code, filling in the implementation of <i>eql</i> as a next step in our
top-down design method. Here's the code.
</p>

<p>
#+BEGIN_SRC idris :exports code
member: a -&gt; list a -&gt; bool
member v nil = false
member v (h::t) = ite (eql v h)
                      true
                      (member v t)
#+END_SRC idris
</p>


<p>
Unfortunately we now hit a major roadblock. Here's the code that one
would be inclined to write to implement <i>eql</i>.
</p>

<p>
#+BEGIN_SRC idris :exports code
eql: a -&gt; a -&gt; bool
eql a1 a2 = ?Wat
#+END_SRC idris
</p>

<p>
We have no idea what type <i>a</i> will be! If we're checking membership in
a list of <i>nat</i>, it will be <i>nat</i>; for <i>bool</i>, it will be <i>bool; for
/Person</i> it will be <i>Person</i>; etc. There's simply no common code that
we can write to <i>decide equality</i> for the entire range of types that
we migth see. Thus, Wat. (Wat means, roughly, ``what the heck.'') We
have come to the end of the road, and we badly need rescuing.
</p>
</div>
</div>

<div id="outline-container-orgheadline257" class="outline-2">
<h2 id="orgheadline257"><span class="section-number-2">23</span> Typeclasses</h2>
<div class="outline-text-2" id="text-23">
<p>
Our hero is called the <i>typeclass</i>. A typeclass is a special record
type. As such (please review the chapter on records), a typeclass
specifies one or more namd fields. A typeclass <i>instance</i> will have
<i>values</i> for these fields. These fields can and generally do have
<i>function</i> types. A typeclass instance thus carries implementations
of the functions that its field(s) specify.
</p>

<p>
The key characteristic of a typeclass is that its instances are tied
to other types. Each type with an associated instance of a partiular
typeclass will thus be given an <i>implementation</i> of the function(s)
specified in the typeclass.
</p>

<p>
The solution to the problem that we ended on in the last chapter is
has three parts. First, we need to define a typeclass, the instances
of which will provide implementations of <i>eql</i> for whatever types we
want to compare using <i>eql</i>. Second, we need to ensure that <i>member</i>
is applied only to types that have an associated typeclass instance.
</p>
</div>

<div id="outline-container-orgheadline253" class="outline-3">
<h3 id="orgheadline253"><span class="section-number-3">23.1</span> The Eq Typeclass</h3>
<div class="outline-text-3" id="text-23-1">
<p>
We define the <i>eq</i> typeclass in its own file and module. 
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">module</span> <span style="color: #333333; background-color: #FFFFFF;">eq</span>
<span style="color: #0000FF;">import</span> <span style="color: #0000FF;">public</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
</pre>
</div>

<p>
The eq typeclass that we define here has just one field, name <i>eql</i>,
of type \(a \to a \to bool\). When code uses eql, Idris checks the types
of the arguments and uses type inference to figure out which typeclass
instance to use to find the right implementation of <i>eql</i>.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">class</span> <span style="color: #333333; background-color: #FFFFFF;">eq</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #0000FF;">where</span>
  <span style="color: #333333; background-color: #FFFFFF;">eql</span> <span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
</pre>
</div>

<p>
As an example, we define an instance of the eq typeclass for the bool
type, in the <i>eq.idr</i> file. We do so in this file to avoid a circular
import. If we put the instance in <i>bool.idr</i>, it would import <i>eq</i>,
and <i>eq</i> has to import <i>bool</i> because <i>bool</i> appears in the type of
<i>eql</i>. Typeclass instances for all other types can and should be put
in the files for those types. 
</p>
</div>
</div>

<div id="outline-container-orgheadline254" class="outline-3">
<h3 id="orgheadline254"><span class="section-number-3">23.2</span> Typeclass Instances</h3>
<div class="outline-text-3" id="text-23-2">
<p>
We construct an instance of a typeclass using the <i>instance</i>
keyword. It's followed by the name of the typeclass, then the type for
which a record is being constructed, then the keyword <i>where</i>, and
finally values for each field of the typeclass. 
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">instance</span> <span style="color: #333333; background-color: #FFFFFF;">eq</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span> <span style="color: #0000FF;">where</span>
  <span style="color: #333333; background-color: #FFFFFF;">eql</span> <span style="color: #333333; background-color: #FFFFFF;">b1</span> <span style="color: #333333; background-color: #FFFFFF;">b2</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">eql_bool</span> <span style="color: #333333; background-color: #FFFFFF;">b1</span> <span style="color: #333333; background-color: #FFFFFF;">b2</span>
</pre>
</div>

<p>
In this case, we give a value for the <i>eql</i> field of the typeclass by
giving a usual function evaluation rule: one that evaluates eql b1 b1
by "delegating" to an implementation of bool equality comparison. The
code for <i>eql_bool</i> is simple:
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #333333; background-color: #FFFFFF;">eql_bool</span><span style="color: #BA36A5;">:</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
<span style="color: #333333; background-color: #FFFFFF;">eql_bool</span> <span style="color: #333333; background-color: #FFFFFF;">true</span> <span style="color: #333333; background-color: #FFFFFF;">true</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">true</span>
<span style="color: #333333; background-color: #FFFFFF;">eql_bool</span> <span style="color: #333333; background-color: #FFFFFF;">false</span> <span style="color: #333333; background-color: #FFFFFF;">false</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">true</span>
<span style="color: #333333; background-color: #FFFFFF;">eql_bool</span> <span style="color: #333333; background-color: #FFFFFF;">_</span> <span style="color: #333333; background-color: #FFFFFF;">_</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">false</span>
</pre>
</div>

<p>
One can also write function application evaluation rules as part of 
a typeclass definition. Here's an example.
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #0000FF;">instance</span> <span style="color: #333333; background-color: #FFFFFF;">eq</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span> <span style="color: #0000FF;">where</span>
  <span style="color: #333333; background-color: #FFFFFF;">eql</span> <span style="color: #333333; background-color: #FFFFFF;">true</span> <span style="color: #333333; background-color: #FFFFFF;">true</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">true</span>
  <span style="color: #333333; background-color: #FFFFFF;">eql</span> <span style="color: #333333; background-color: #FFFFFF;">false</span> <span style="color: #333333; background-color: #FFFFFF;">false</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">true</span>
  <span style="color: #333333; background-color: #FFFFFF;">eql</span> <span style="color: #333333; background-color: #FFFFFF;">_</span> <span style="color: #333333; background-color: #FFFFFF;">_</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">false</span>
</pre>
</div>

<p>
With this code written and the <i>eq</i> module imported, one can compare
Boolean values for equality using <i>eql</i>. For example, <i>(eql false
true)</i> evaluates to false. Defining <i>eq</i> instances for types such as
<i>nat</i>, <i>pair a b</i>, <i>list a</i>, <i>set a</i>, and other types will allow all
of them to be compared for equality using <i>eql</i>. We say that <i>eql</i> is
an <i>overloaded</i> operator. Based on the types of the arguments to which
it is applied, the compiler determines which implementation to use (by
finding and accessing the function value (implementation) stored in
the appropriate typeclass instance.
</p>
</div>
</div>

<div id="outline-container-orgheadline255" class="outline-3">
<h3 id="orgheadline255"><span class="section-number-3">23.3</span> Typeclass Constraints</h3>
<div class="outline-text-3" id="text-23-3">
<p>
The final piece of the puzzle is to modify our list <i>member</i> function
so that it can only be applied to values and lists of values of types
for which definitions of <i>eql</i> are available. Here's the code. .
</p>

<div class="org-src-container">

<pre class="src src-idris"><span style="color: #8D8D84;">|||</span><span style="color: #036A07;"> membership predicate</span>
<span style="color: #333333; background-color: #FFFFFF;">member</span><span style="color: #BA36A5;">:</span> (<span style="color: #333333; background-color: #FFFFFF;">eq</span> <span style="color: #333333; background-color: #FFFFFF;">a</span>) <span style="color: #BA36A5;">=&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">list</span> <span style="color: #333333; background-color: #FFFFFF;">a</span> <span style="color: #BA36A5;">-&gt;</span> <span style="color: #333333; background-color: #FFFFFF;">bool</span>
<span style="color: #333333; background-color: #FFFFFF;">member</span> <span style="color: #333333; background-color: #FFFFFF;">v</span> <span style="color: #333333; background-color: #FFFFFF;">nil</span> <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">false</span>
<span style="color: #333333; background-color: #FFFFFF;">member</span> <span style="color: #333333; background-color: #FFFFFF;">v</span> (<span style="color: #333333; background-color: #FFFFFF;">h</span><span style="color: #BA36A5;">::</span><span style="color: #333333; background-color: #FFFFFF;">t</span>) <span style="color: #BA36A5;">=</span> <span style="color: #333333; background-color: #FFFFFF;">ite</span> (<span style="color: #333333; background-color: #FFFFFF;">eql</span> <span style="color: #333333; background-color: #FFFFFF;">v</span> <span style="color: #333333; background-color: #FFFFFF;">h</span>)
                      <span style="color: #333333; background-color: #FFFFFF;">true</span>
                      (<span style="color: #333333; background-color: #FFFFFF;">member</span> <span style="color: #333333; background-color: #FFFFFF;">v</span> <span style="color: #333333; background-color: #FFFFFF;">t</span>)
</pre>
</div>

<p>
Note the new syntax: <i>(eq a) =&gt; a -&gt; list a -&gt; bool</i>. The way to read
this code is as saying, "As long as <i>a</i> has an <i>eq</i> instance (and thus
an implementation of <i>eql</i>), the function, <i>member</i>, is of type \(a \to
list a -> bool\).
</p>
</div>
</div>

<div id="outline-container-orgheadline256" class="outline-3">
<h3 id="orgheadline256"><span class="section-number-3">23.4</span> Exercises</h3>
<div class="outline-text-3" id="text-23-4">
<p>
Define <i>eq</i> typeclass instances for all of the types that we have
developed, including pair, option, list, and set. Note that for set it
will not be sufficient simply to compare the list representations for
equality, because different lists can represent the same set, up to
differences in ordering.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline259" class="outline-2">
<h2 id="orgheadline259"><span class="section-number-2">24</span> Serialization</h2>
<div class="outline-text-2" id="text-24">
<p>
The Serialization typeclass overloads the toString operator, a
function for converting values of supported types to strings for
printing, storing in files, and sending over networks.
</p>

<p>
To do.
</p>
</div>

<div id="outline-container-orgheadline258" class="outline-3">
<h3 id="orgheadline258"><span class="section-number-3">24.1</span> Exercises</h3>
<div class="outline-text-3" id="text-24-1">
<p>
Develop a dictionary implementation based on a specification that your
instructor will provide, including <i>empty, insert, lookup, remove,/
and /override</i> functions, as well as overloaded <i>eql</i> and <i>toString</i>
operators.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline277" class="outline-2">
<h2 id="orgheadline277"><span class="section-number-2">25</span> Future (Tentative)</h2>
<div class="outline-text-2" id="text-25">
</div><div id="outline-container-orgheadline262" class="outline-3">
<h3 id="orgheadline262"><span class="section-number-3">25.1</span> Processes (Termination, Coinduction)</h3>
<div class="outline-text-3" id="text-25-1">
</div><div id="outline-container-orgheadline260" class="outline-4">
<h4 id="orgheadline260"><span class="section-number-4">25.1.1</span> Simulation</h4>
</div>
<div id="outline-container-orgheadline261" class="outline-4">
<h4 id="orgheadline261"><span class="section-number-4">25.1.2</span> Games</h4>
</div>
</div>
<div id="outline-container-orgheadline263" class="outline-3">
<h3 id="orgheadline263"><span class="section-number-3">25.2</span> Effects (I/O and State)</h3>
</div>
<div id="outline-container-orgheadline272" class="outline-3">
<h3 id="orgheadline272"><span class="section-number-3">25.3</span> Procedural Programming</h3>
<div class="outline-text-3" id="text-25-3">
</div><div id="outline-container-orgheadline264" class="outline-4">
<h4 id="orgheadline264"><span class="section-number-4">25.3.1</span> Environment</h4>
</div>
<div id="outline-container-orgheadline269" class="outline-4">
<h4 id="orgheadline269"><span class="section-number-4">25.3.2</span> Commands</h4>
<div class="outline-text-4" id="text-25-3-2">
</div><ol class="org-ol"><li><a id="orgheadline265"></a>assignment<br  /></li>
<li><a id="orgheadline266"></a>sequential composition<br  /></li>
<li><a id="orgheadline267"></a>iteration (for and while, including nested loops)<br  /></li>
<li><a id="orgheadline268"></a>alternation (if/then/else)<br  /></li></ol>
</div>
<div id="outline-container-orgheadline270" class="outline-4">
<h4 id="orgheadline270"><span class="section-number-4">25.3.3</span> Procedures</h4>
</div>
<div id="outline-container-orgheadline271" class="outline-4">
<h4 id="orgheadline271"><span class="section-number-4">25.3.4</span> Classes</h4>
</div>
</div>
<div id="outline-container-orgheadline273" class="outline-3">
<h3 id="orgheadline273"><span class="section-number-3">25.4</span> Libraries</h3>
</div>
<div id="outline-container-orgheadline274" class="outline-3">
<h3 id="orgheadline274"><span class="section-number-3">25.5</span> Algorithms</h3>
</div>
<div id="outline-container-orgheadline275" class="outline-3">
<h3 id="orgheadline275"><span class="section-number-3">25.6</span> Complexity</h3>
</div>
<div id="outline-container-orgheadline276" class="outline-3">
<h3 id="orgheadline276"><span class="section-number-3">25.7</span> Debugging</h3>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Kevin Sullivan</p>
<p class="date">Created: 2015-10-27 Tue 02:02</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
